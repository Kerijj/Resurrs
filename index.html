<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞—Ä—Å–∏–∞–Ω–∏–Ω: –≠–∫–æ–Ω–æ–º–∏–∫–∞ –í—ã–∂–∏–≤–∞–Ω–∏—è (–ê—Ä–µ—Å 7)</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* –ë–∞–∑–æ–≤—ã–π —Å—Ç–∏–ª—å */
        body { 
            font-family: 'Roboto', sans-serif; 
            background: #000c19; /* –¢–µ–º–Ω—ã–π –∫–æ—Å–º–æ—Å */
            color: #d8e2f0; /* –°–≤–µ—Ç–ª—ã–π —Ç–µ–∫—Å—Ç */
            padding: 25px; 
            line-height: 1.6;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 35px; 
            background: #0f1c2c; /* –û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ */
            border-radius: 18px; 
            border: 3px solid #e74c3c; /* –ö—Ä–∞—Å–Ω–∞—è –ª–∏–Ω–∏—è –ú–∞—Ä—Å–∞ */
            box-shadow: 0 10px 40px rgba(231, 76, 60, 0.3); 
        }
        
        /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
        h1 { color: #f1c40f; margin-top: 0; text-align: center; text-shadow: 0 0 5px rgba(241, 196, 15, 0.5); }
        h2 { color: #3498db; border-bottom: 2px solid #3e4451; padding-bottom: 15px; margin-top: 30px; }
        h3 { color: #e74c3c; }
        
        /* –û—Å–Ω–æ–≤–Ω—ã–µ –±–ª–æ–∫–∏ */
        .intro, .round-content, #trade-dialogue, #communication-panel { 
            margin-bottom: 25px; 
            padding: 25px; 
            border: 1px solid #3e4451; 
            border-radius: 12px; 
            background: #1e2127; 
        }
        
        /* –î–∏—Å–ø–ª–µ–π —Ä–µ—Å—É—Ä—Å–æ–≤ */
        .resources-display { 
            background: #282c34; 
            padding: 20px; 
            border-radius: 12px; 
            margin-top: 25px; 
            display: flex; 
            justify-content: space-between;
            align-items: center;
        }
        .status-info { flex: 1; margin-right: 30px;}
        .resources-display h3 { color: #2ecc71; margin-top: 0; }
        .hp-bar { color: #e74c3c; font-weight: bold; font-size: 1.3em; }
        .actions-count { color: #f1c40f; font-weight: bold; font-size: 1.3em; }

        /* –ñ—É—Ä–Ω–∞–ª */
        .log-box { 
            margin-top: 20px; 
            background: #0f1c2c; 
            padding: 15px; 
            height: 180px; 
            overflow-y: scroll; 
            border-radius: 10px; 
            font-size: 0.9em; 
            border: 1px solid #3e4451;
        }
        .log-box p { margin: 2px 0; }
        .log-box span { color: #e74c3c; } 
        
        /* –ö–Ω–æ–ø–∫–∏ */
        button { 
            padding: 12px 20px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 6px; 
            font-weight: bold; 
            background: #3498db; 
            color: white; 
            transition: background 0.2s, opacity 0.2s; 
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
        }
        button:hover:not(:disabled) { background: #2980b9; }
        button:disabled { background: #555; cursor: not-allowed; opacity: 0.6; }
        
        .group-select button { width: 30%; min-width: 200px; }

        /* –ü–∞–Ω–µ–ª—å –í–µ–¥—É—â–µ–≥–æ */
        .mod-panel { 
            margin-top: 30px; 
            padding: 20px; 
            background: #282c34; 
            border-radius: 10px; 
            display: flex;
            align-items: center;
            border: 1px solid #3498db;
        }
        #mod-input { 
            flex-grow: 1;
            padding: 10px; 
            border-radius: 6px; 
            border: 1px solid #3498db; 
            margin-right: 15px; 
            background: #0f1c2c; 
            color: #d8e2f0; 
        }
        
        /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
        .inventory-list { 
            margin-top: 10px; 
            list-style-type: none; 
            padding: 0; 
            display: flex; 
            flex-wrap: wrap; 
            gap: 15px;
        }
        .inventory-item { 
            padding: 10px 15px; 
            border-radius: 8px; 
            background: #1e2127;
            border: 1px solid #4b5263;
            font-size: 1em;
            box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
        }

        /* –ü–∞–Ω–µ–ª—å —Å–≤—è–∑–∏ */
        #communication-panel p { color: #98c379; font-weight: bold; margin: 0; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üöÄ –ú–ê–†–°–ò–ê–ù–ò–ù: –≠–ö–û–ù–û–ú–ò–ö–ê –í–´–ñ–ò–í–ê–ù–ò–Ø</h1>
        <div id="game-area">
            
            <div class="intro" id="intro-screen">
                <h2>–í—ã–±–æ—Ä –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</h2>
                <p>–í–∞—à–∞ –≥—Ä—É–ø–ø–∞ - –ø–æ—Å–ª–µ–¥–Ω—è—è –Ω–∞–¥–µ–∂–¥–∞. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –∏ –±–æ–Ω—É—Å—ã.</p>
                
                <div class="group-select" style="display: flex; justify-content: space-around; flex-wrap: wrap;">
                    <button onclick="startGame('Technocrats')">üõ†Ô∏è –¢–µ—Ö–Ω–æ–∫—Ä–∞—Ç—ã (–≠–Ω–µ—Ä–≥–∏—è –∏ –õ–æ–≥–∏—Å—Ç–∏–∫–∞)</button>
                    <button onclick="startGame('Bioengineers')">üß™ –ë–∏–æ–∏–Ω–∂–µ–Ω–µ—Ä—ã (–í–æ–¥–∞ –∏ –ü–∏—â–∞)</button>
                    <button onclick="startGame('Constructors')">üß± –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã (–ñ–∏–ª—å–µ –∏ –ó–∞—â–∏—Ç–∞)</button>
                </div>
            </div>

            <div id="game-round" style="display:none;">
                <h2 class="current-round-title" id="round-title"></h2>
                
                <div class="round-content" id="round-description"></div>

                <div class="resources-display">
                    <div class="status-info">
                        <h3>–ì—Ä—É–ø–ø–∞: <span id="player-group-name"></span></h3>
                        <p>–ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ (HP): <span id="res-hp" class="hp-bar"></span></p>
                        <p>–î–µ–π—Å—Ç–≤–∏–π –æ—Å—Ç–∞–ª–æ—Å—å: <span id="actions-remaining" class="actions-count"></span> / 3</p>
                        <p id="group-status"></p>
                    </div>
                    <ul class="inventory-list" id="inventory-list-display"></ul>
                </div>
                
                <div id="communication-panel">
                    <h3>üì¢ –û–±—â–∏–π –∫–∞–Ω–∞–ª —Å–≤—è–∑–∏</h3>
                    <p id="communication-message">–ö–∞–Ω–∞–ª —á–∏—Å—Ç. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç —Å –¥—Ä—É–≥–∏–º–∏ –≥—Ä—É–ø–ø–∞–º–∏...</p>
                    <button onclick="simulateConversation()" style="background: #e74c3c;">–ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –û–±–º–µ–Ω</button>
                    
                    <div id="trade-dialogue" style="display:none; margin-top: 15px; padding: 15px; background: #3e4451;">
                        <p style="color: #f1c40f;">**–í–µ–¥—É—â–µ–º—É:** –í–≤–µ–¥–∏—Ç–µ: **–û–¢–î–ê–¢–¨ [–∫–æ–¥] [–∫–æ–ª-–≤–æ]** –∏ **–ü–û–õ–£–ß–ò–¢–¨ [–∫–æ–¥] [–∫–æ–ª-–≤–æ]**</p>
                    </div>
                </div>


                <div class="action-area" id="action-area"></div>
                
                <div class="log-box">
                    **–ñ—É—Ä–Ω–∞–ª –ë–æ—Ä—Ç–∞ (–í–µ–¥—É—â–µ–≥–æ –∏ –ò–≥—Ä–æ–∫–∞)**
                    <div id="game-log"></div>
                </div>

                <div class="mod-panel">
                    <h4 style="margin: 0; color: #3498db;">‚öôÔ∏è –ö–û–ù–°–û–õ–¨ –í–ï–î–£–©–ï–ì–û:</h4>
                    <input type="text" id="mod-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É (–ö–†–ê–§–¢, –ó–ê–î–ê–ù–ò–ï, –°–ë–û–†, –û–¢–î–ê–¢–¨/–ü–û–õ–£–ß–ò–¢–¨)">
                    <button onclick="processModCommand()" style="background: #2ecc71;">–í–≤–æ–¥ –ö–æ–º–∞–Ω–¥—ã</button>
                    <button onclick="checkNextRound()" style="background: #e74c3c;">–ó–∞–≤–µ—Ä—à–∏—Ç—å –†–∞—É–Ω–¥</button>
                </div>
            </div>
            
            <div id="game-over" style="display:none; text-align: center;">
                 <h2 style="color: #e74c3c;">üî¥ –ú–ò–°–°–ò–Ø –ü–†–û–í–ê–õ–ï–ù–ê</h2>
                 <p id="game-over-message" style="font-size: 1.5em;"></p>
            </div>
        </div>
    </div>

    <script>
        // --- –î–ê–ù–ù–´–ï –ò–ì–†–´ ---
        const RESOURCES = {
            // –ë–∞–∑–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã (5 —à—Ç)
            E: { name: '–≠–Ω–µ—Ä–≥–æ—è—á–µ–π–∫–∞', code: 'E', icon: '‚ö°' },
            W: { name: '–í–æ–¥–∞ (–õ)', code: 'W', icon: 'üíß' },
            T: { name: '–ü–æ—á–≤–∞ (–ö–≥)', code: 'T', icon: '‚õ∞Ô∏è' },
            M: { name: '–ú–µ—Ç–∞–ª–ª–æ–ª–æ–º', code: 'M', icon: 'üî©' },
            K: { name: '–ü—Ä–æ–≤–æ–¥–∞/–ö–∞–±.', code: 'K', icon: 'üîó' },
            
            // –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–¥–ª—è –≤—ã–∂–∏–≤–∞–Ω–∏—è)
            P: { name: '–ú–∏–∫—Ä–æ-–ü–æ–ª–∏–≤', code: 'P', icon: 'üíßüå±' }, 
            G: { name: '–¢–µ—Ä–º–æ-–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä', code: 'G', icon: '‚òÄÔ∏è' }, 
            C: { name: '–ì–µ—Ä–º–æ-–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä', code: 'C', icon: 'üì¶' }, 
            
            // –§–∏–Ω–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
            S: { name: '–ú–∞—è–∫ –°–ø–∞—Å–µ–Ω–∏—è', code: 'S', icon: ' –º–∞—è–∫' },
            HP: { name: '–ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ', code: 'HP', icon: 'üíî' }
        };
        
        const GROUP_BONUSES = {
            Technocrats: 'E', // –≠–Ω–µ—Ä–≥–æ—è—á–µ–π–∫–∏
            Bioengineers: 'T', // –ü–æ—á–≤–∞
            Constructors: 'M' // –ú–µ—Ç–∞–ª–ª–æ–ª–æ–º
        };

        const GROUP_NAMES = {
            Technocrats: 'üõ†Ô∏è –¢–µ—Ö–Ω–æ–∫—Ä–∞—Ç—ã', 
            Bioengineers: 'üß™ –ë–∏–æ–∏–Ω–∂–µ–Ω–µ—Ä—ã', 
            Constructors: 'üß± –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã'
        };

        const ROUND_TITLES = [
            "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ú–∏—Å—Å–∏–∏",
            "–†–∞—É–Ω–¥ 1: –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –°–±–æ—Ä (–ó–∞–¥–∞–Ω–∏—è)",
            "–†–∞—É–Ω–¥ 2: –°–≤–æ–±–æ–¥–Ω—ã–π –°–±–æ—Ä (–õ–∏–º–∏—Ç –≤–µ—Å–∞)",
            "–†–∞—É–Ω–¥ 3: –û–±—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ñ–∏–∑–Ω–∏ (–ö—Ä–∞—Ñ—Ç)",
            "–†–∞—É–Ω–¥ 4: –†–∏—Å–∫ –∏ –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ",
            "–†–∞—É–Ω–¥ 5: –®—Ç–æ—Ä–º –∏ –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ",
            "–†–∞—É–Ω–¥ 6: –§–∏–Ω–∞–ª—å–Ω–∞—è –¢–æ—Ä–≥–æ–≤–ª—è",
            "–†–∞—É–Ω–¥ 7: –°–±–æ—Ä–∫–∞ –ú–∞—è–∫–∞ –∏ –§–∏–Ω–∞–ª"
        ];
        
        // –°—Ç–æ–∏–º–æ—Å—Ç—å —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫—Ä–∞—Ñ—Ç–∞
        const CRAFT_COSTS = {
            P: { T: 8, W: 5, K: 3 }, // –ú–∏–∫—Ä–æ-–ü–æ–ª–∏–≤: –ü–æ—á–≤–∞ + –í–æ–¥–∞ + –ö–∞–±–µ–ª–∏
            G: { E: 8, M: 5, K: 3 }, // –¢–µ—Ä–º–æ-–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä: –≠–Ω–µ—Ä–≥–æ—è—á–µ–π–∫–∞ + –ú–µ—Ç–∞–ª–ª + –ö–∞–±–µ–ª–∏
            C: { M: 8, E: 5, T: 3 }  // –ì–µ—Ä–º–æ-–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: –ú–µ—Ç–∞–ª–ª + –≠–Ω–µ—Ä–≥–∏—è + –ü–æ—á–≤–∞ (–¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏)
        };

        let gameState = {
            group: null,
            inventory: { E: 3, W: 0, T: 3, M: 3, K: 0, P: 0, G: 0, C: 0, S: 0, HP: 15 }, 
            currentRound: 0,
            actionsTaken: 0,
            maxActions: 3,
            status: "–û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –≥—Ä—É–ø–ø—ã...",
            historyLog: [],
            conversationHistory: 0 // –°—á—ë—Ç—á–∏–∫ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –æ–±—â–µ–Ω–∏—è
        };

        // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ô ---

        function updateLog(message, isError = false) {
            const logBox = document.getElementById('game-log');
            const prefix = isError ? '<span style="color: #e74c3c;">[–û–®–ò–ë–ö–ê]</span> ' : '';
            logBox.innerHTML += `<p>${prefix}${message}</p>`;
            logBox.scrollTop = logBox.scrollHeight;
        }

        function takeAction() {
            if (gameState.actionsTaken >= gameState.maxActions) {
                updateLog("üõë –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π (3) –≤ —ç—Ç–æ–º —Ä–∞—É–Ω–¥–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ.", true);
                return false;
            }
            gameState.actionsTaken++;
            document.getElementById('actions-remaining').textContent = gameState.maxActions - gameState.actionsTaken;
            return true;
        }

        function checkNextRound() {
            if (document.getElementById('trade-dialogue').style.display === 'block') {
                updateLog("üõë –°–Ω–∞—á–∞–ª–∞ –∑–∞–≤–µ—Ä—à–∏—Ç–µ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã.", true);
                return;
            }
            if (gameState.currentRound !== 7 && gameState.actionsTaken < gameState.maxActions) {
                updateLog("üõë –í—ã –µ—â–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –≤—Å–µ 3 –¥–µ–π—Å—Ç–≤–∏—è —ç—Ç–æ–≥–æ —Ä–∞—É–Ω–¥–∞.", true);
                return;
            }
            if (gameState.currentRound === 7) return; 

            // –°–ø–∏—Å–∞–Ω–∏–µ HP 
            const hpLoss = 3; 
            gameState.inventory.HP -= hpLoss;
            updateLog(`--- –ï–ñ–ï–î–ù–ï–í–ù–´–ô –†–ê–°–•–û–î ---`);
            updateLog(`üíî –ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ -${hpLoss} HP. –¢–µ–∫—É—â–∏–π HP: ${gameState.inventory.HP}`);

            if (gameState.inventory.HP <= 0) {
                gameOver("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ–π —Å–∏—Å—Ç–µ–º –∂–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è. –ú–∏—Å—Å–∏—è –æ–∫–æ–Ω—á–µ–Ω–∞.");
                return;
            }
            
            gameState.currentRound++;
            gameState.actionsTaken = 0; 
            document.getElementById('trade-dialogue').style.display = 'none';
            updateLog(`=== –ü–µ—Ä–µ—Ö–æ–¥ –≤ ${ROUND_TITLES[gameState.currentRound]} ===`, true);
            gameState.status = "–†–∞—É–Ω–¥ –Ω–∞—á–∞—Ç. –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ.";
            loadRound(gameState.currentRound);
            updateUI();
        }

        function gameOver(message) {
            document.getElementById('game-round').style.display = 'none';
            document.getElementById('game-over').style.display = 'block';
            document.getElementById('game-over-message').textContent = message;
        }

        function startGame(groupName) {
            gameState.group = groupName;
            gameState.currentRound = 1;
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('game-round').style.display = 'block';
            
            updateLog(`–ì—Ä—É–ø–ø–∞ –≤—ã–±—Ä–∞–Ω–∞ **${GROUP_NAMES[groupName]}**. –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è ${ROUND_TITLES[gameState.currentRound]}`);
            gameState.status = `–í–∞—à –±–æ–Ω—É—Å–Ω—ã–π —Ä–µ—Å—É—Ä—Å: ${RESOURCES[GROUP_BONUSES[groupName]].name}.`;
            updateUI();
            loadRound(1);
        }
        
        // --- UI –∏ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å ---

        function updateUI() {
            document.getElementById('player-group-name').textContent = GROUP_NAMES[gameState.group];
            const hpElement = document.getElementById('res-hp');
            hpElement.textContent = gameState.inventory.HP;
            
            if (gameState.inventory.HP <= 6) hpElement.style.color = '#e74c3c';
            else if (gameState.inventory.HP > 12) hpElement.style.color = '#2ecc71';
            else hpElement.style.color = '#f1c40f';
            
            document.getElementById('actions-remaining').textContent = gameState.maxActions - gameState.actionsTaken;
            document.getElementById('group-status').innerHTML = gameState.status;
            document.getElementById('round-title').textContent = ROUND_TITLES[gameState.currentRound];
            
            // –°–ø–∏—Å–æ–∫ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            const inventoryList = document.getElementById('inventory-list-display');
            let html = '';
            const orderedKeys = Object.keys(RESOURCES).filter(k => gameState.inventory[k] > 0 && k !== 'HP' && k !== 'S');
            
            orderedKeys.forEach(code => {
                const count = gameState.inventory[code];
                const res = RESOURCES[code];
                const isBonusGroup = GROUP_BONUSES[gameState.group] === code;
                
                html += `<li class="inventory-item">${res.icon} ${res.name}: ${count} ${isBonusGroup ? 'üåü' : ''}</li>`;
            });
            inventoryList.innerHTML = html || '<li class="inventory-item">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</li>';
        }
        
        // --- –õ–û–ì–ò–ö–ê –ö–û–ú–ê–ù–î –í–ï–î–£–©–ï–ì–û ---

        function processModCommand() {
            const input = document.getElementById('mod-input').value.trim().toLowerCase();
            const words = input.split(' ');
            document.getElementById('mod-input').value = '';

            // 1. –ö–†–ê–§–¢ [–∫–æ–¥]
            if (words[0] === '–∫—Ä–∞—Ñ—Ç' && words.length === 2 && [3, 4, 5].includes(gameState.currentRound)) {
                const resCode = words[1].toUpperCase();
                if (['P', 'G', 'C'].includes(resCode)) {
                    craftComponent(resCode);
                    return;
                }
            }
            
            // 2. –ó–ê–î–ê–ù–ò–ï [–∫–æ–¥ —Ä–µ—Å—É—Ä—Å–∞] (–†1)
            if (words[0] === '–∑–∞–¥–∞–Ω–∏–µ' && words.length === 2 && gameState.currentRound === 1) {
                const resCode = words[1].toUpperCase();
                if (['E', 'W', 'T', 'M', 'K'].includes(resCode)) {
                    if (takeAction()) {
                        const isBonus = resCode === GROUP_BONUSES[gameState.group];
                        const gain = isBonus ? 10 : 5;
                        gameState.inventory[resCode] += gain;
                        updateLog(`üéâ –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! –î–æ–±—ã—Ç–æ **+${gain} ${RESOURCES[resCode].name}**. ${isBonus ? "–ë–æ–Ω—É—Å üåü" : ""}`);
                        updateUI();
                    }
                    return;
                }
            }

            // 3. –°–ë–û–† [–∫–æ–¥ —Ä–µ—Å—É—Ä—Å–∞] [–∫–æ–ª-–≤–æ] (–†2)
            if (words[0] === '—Å–±–æ—Ä' && words.length === 3 && gameState.currentRound === 2) {
                const resCode = words[1].toUpperCase();
                const amount = parseInt(words[2]);
                const MAX_COLLECT = 15; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —Å–æ–±—Ä–∞—Ç—å –∑–∞ 1 –¥–µ–π—Å—Ç–≤–∏–µ
                
                if (['W', 'T', 'E', 'M', 'K'].includes(resCode) && !isNaN(amount) && amount > 0 && amount <= MAX_COLLECT) {
                    if (takeAction()) {
                        gameState.inventory[resCode] += amount;
                        updateLog(`‚õèÔ∏è –°–±–æ—Ä: **+${amount} ${RESOURCES[resCode].name}**.`);
                        updateUI();
                    }
                    return;
                } else if (!isNaN(amount) && amount > MAX_COLLECT) {
                    updateLog(`üõë –ù–µ–ª—å–∑—è —Å–æ–±—Ä–∞—Ç—å –±–æ–ª–µ–µ ${MAX_COLLECT} –µ–¥–∏–Ω–∏—Ü –∑–∞ —Ä–∞–∑.`, true);
                    return;
                }
            }

            // 4. –û–¢–î–ê–¢–¨ / –ü–û–õ–£–ß–ò–¢–¨ [–∫–æ–¥] [–∫–æ–ª-–≤–æ] (–û–±–º–µ–Ω)
            if ((words[0] === '–æ—Ç–¥–∞—Ç—å' || words[0] === '–ø–æ–ª—É—á–∏—Ç—å') && words.length === 3 && [6, 7].includes(gameState.currentRound)) {
                const action = words[0];
                const resCode = words[1].toUpperCase();
                const amount = parseInt(words[2]);

                if (RESOURCES[resCode] && !isNaN(amount) && amount > 0 && document.getElementById('trade-dialogue').style.display === 'block') {
                    if (action === '–æ—Ç–¥–∞—Ç—å') {
                        if (gameState.inventory[resCode] >= amount) {
                            gameState.inventory[resCode] -= amount;
                            updateLog(`[–û–ë–ú–ï–ù] –ì—Ä—É–ø–ø–∞ ${GROUP_NAMES[gameState.group]} –æ—Ç–¥–∞–ª–∞ **-${amount} ${RESOURCES[resCode].name}**`);
                        } else {
                            updateLog(`üõë –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ${RESOURCES[resCode].name} –¥–ª—è –æ—Ç–¥–∞—á–∏.`, true);
                        }
                    } else if (action === '–ø–æ–ª—É—á–∏—Ç—å') {
                        gameState.inventory[resCode] += amount;
                        updateLog(`[–û–ë–ú–ï–ù] –ì—Ä—É–ø–ø–∞ ${GROUP_NAMES[gameState.group]} –ø–æ–ª—É—á–∏–ª–∞ **+${amount} ${RESOURCES[resCode].name}**`);
                    }
                    updateUI();
                    return;
                }
            }
            
            if (input) updateLog("–ù–µ–≤–µ—Ä–Ω–∞—è –∏–ª–∏ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–∞—è –∫–æ–º–∞–Ω–¥–∞ –í–µ–¥—É—â–µ–≥–æ. –î–æ—Å—Ç—É–ø–Ω—ã: –ö–†–ê–§–¢, –ó–ê–î–ê–ù–ò–ï/–°–ë–û–†, –û–¢–î–ê–¢–¨/–ü–û–õ–£–ß–ò–¢–¨.", true);
        }

        // --- –õ–û–ì–ò–ö–ê –î–ï–ô–°–¢–í–ò–ô ---

        function craftComponent(resCode) {
            const cost = CRAFT_COSTS[resCode];
            let canCraft = true;

            for (const res in cost) {
                if (gameState.inventory[res] < cost[res]) {
                    updateLog(`üõë –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ${RESOURCES[res].name}. –¢—Ä–µ–±—É–µ—Ç—Å—è ${cost[res]}. –ö—Ä–∞—Ñ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.`, true);
                    canCraft = false;
                    break;
                }
            }

            if (canCraft) {
                for (const res in cost) {
                    gameState.inventory[res] -= cost[res];
                }
                gameState.inventory[resCode]++;
                updateLog(`üéâ –£—Å–ø–µ—à–Ω—ã–π –ö—Ä–∞—Ñ—Ç! –°–æ–∑–¥–∞–Ω **1 ${RESOURCES[resCode].name}**.`);
            }
            updateUI();
        }

        function simulateConversation() {
            const messages = [
                "–ì—Ä—É–ø–ø–∞ 1: '–£ –Ω–∞—Å –¥–µ—Ñ–∏—Ü–∏—Ç –í–æ–¥—ã –∏ –ü–æ—á–≤—ã! –ö—Ç–æ –º–æ–∂–µ—Ç –æ–±–º–µ–Ω—è—Ç—å –≠–Ω–µ—Ä–≥–æ—è—á–µ–π–∫–∏?'",
                "–ì—Ä—É–ø–ø–∞ 2: '–ù–∞—à–∏ –∑–∞–ø–∞—Å—ã –ú–µ—Ç–∞–ª–ª–æ–ª–æ–º–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏. –ò—â–µ–º –í–æ–¥—É –∏–ª–∏ –ü–æ—á–≤—É!'",
                "–ì—Ä—É–ø–ø–∞ 3: '–ì–æ—Ç–æ–≤—ã –ø—Ä–æ–¥–∞—Ç—å –∏–∑–ª–∏—à–∫–∏ –ö–∞–±–µ–ª–µ–π –∑–∞ –¢–µ—Ä–º–æ-–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä (G). –°—Ä–æ—á–Ω–æ!'",
                "–ì—Ä—É–ø–ø–∞ 1: '–£ –Ω–∞—Å –µ—Å—Ç—å 5M –∏ 5K, –∏—â–µ–º T. –î–∞–≤–∞–π—Ç–µ –æ–±—Å—É–¥–∏–º –æ–±–º–µ–Ω!'",
                "–ì—Ä—É–ø–ø–∞ 2: '–ü–æ–Ω—è–ª, —Å–≤—è–∂–µ–º—Å—è. –£ –Ω–∞—Å –µ—Å—Ç—å 10T. –ù—É–∂–Ω—ã 2E.'"
            ];
            
            const message = messages[gameState.conversationHistory % messages.length];
            document.getElementById('communication-message').textContent = message;
            
            if (gameState.currentRound === 6 || gameState.currentRound === 7) {
                 document.getElementById('trade-dialogue').style.display = 'block';
                 updateLog(`üì¢ –û–¢–ö–†–´–¢–û –û–ö–ù–û –û–ë–ú–ï–ù–ê. –ò–≥—Ä–æ–∫: –≤–≤–µ–¥–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å –í–µ–¥—É—â–µ–≥–æ —Å–≤–æ—é —Å–¥–µ–ª–∫—É.`, true);
            }
            
            // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É –æ–±–º–µ–Ω–∞ –≤ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ä–∞—É–Ω–¥
            if (gameState.currentRound < 6) {
                 updateLog(`–ö–∞–Ω–∞–ª —Å–≤—è–∑–∏: "–û–±–º–µ–Ω —Å–µ–π—á–∞—Å –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω. –î–æ–∂–¥–∏—Ç–µ—Å—å –†–∞—É–Ω–¥–∞ 6."`, true);
            }

            gameState.conversationHistory++;
        }


        function applyRoundAction(actionCode) {
            if (!takeAction()) return; 
            
            let statusChange = 0;
            let message = "";

            if (gameState.currentRound === 3) { // –û–±—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ)
                const costMap = {
                    'P': { T: 3, W: 3 }, // –ë–∞–∑–æ–≤–∞—è –ø–∏—â–∞
                    'G': { E: 3, K: 3 }, // –ë–∞–∑–æ–≤–æ–µ —Ç–µ–ø–ª–æ
                    'C': { M: 3, T: 3 }  // –ë–∞–∑–æ–≤–æ–µ —É–±–µ–∂–∏—â–µ
                };
                
                const component = costMap[actionCode];
                let canBuild = true;

                if (component) {
                    for (const res in component) {
                        if (gameState.inventory[res] < component[res]) {
                            updateLog(`üõë –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ${RESOURCES[res].name} –¥–ª—è ${RESOURCES[actionCode].name}.`, true);
                            canBuild = false;
                            break;
                        }
                    }

                    if (canBuild) {
                        for (const res in component) {
                            gameState.inventory[res] -= component[res];
                        }
                        statusChange = 1;
                        message = `–°–æ–∑–¥–∞–Ω –±–∞–∑–æ–≤—ã–π **${RESOURCES[actionCode].name}**. +1 –∫ —Å—Ç–∞—Ç—É—Å—É –≤—ã–∂–∏–≤–∞–Ω–∏—è.`;
                    } else {
                        statusChange = -1; message = "–ü–æ–ø—ã—Ç–∫–∞ –ø—Ä–æ–≤–∞–ª–µ–Ω–∞. –ó–∞—Ç—Ä–∞—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ –∏ —ç–Ω–µ—Ä–≥–∏–∏. **-1 –∫ —Å—Ç–∞—Ç—É—Å—É**.";
                    }
                }
            } else if (gameState.currentRound === 4) { // –†–∏—Å–∫ –∏ –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
                if (actionCode === 'RiskHP') {
                    if (gameState.inventory.HP > 3) {
                        gameState.inventory.HP -= 3;
                        statusChange = 2; 
                        message = "–†–∏—Å–∫–æ–≤–∞–Ω–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: **-3 HP**, –Ω–æ **+2 –∫ —Å—Ç–∞—Ç—É—Å—É**. –ù–∞–π–¥–µ–Ω–∞ —Ü–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è!";
                    } else {
                        statusChange = -3;
                        gameState.inventory.HP = 0;
                        message = "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫! **-3 –∫ —Å—Ç–∞—Ç—É—Å—É**. –í—ã –ø–æ–≥–∏–±–ª–∏.";
                        gameOver(message);
                    }
                } else if (actionCode === 'SafeHP') {
                    if (gameState.inventory.T >= 5) {
                        gameState.inventory.T -= 5;
                        gameState.inventory.HP += 3;
                        message = "–°–ø–æ–∫–æ–π–Ω—ã–π –¥–µ–Ω—å: **-5 –ü–æ—á–≤—ã**, **+3 HP** (–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ).";
                    } else {
                        statusChange = -1;
                        message = "–ù–µ—á–µ–º –ø–∏—Ç–∞—Ç—å—Å—è. **-1 –∫ —Å—Ç–∞—Ç—É—Å—É**.";
                    }
                }
            } else if (gameState.currentRound === 5) { // –®—Ç–æ—Ä–º
                 const hasComponent = gameState.inventory[actionCode] > 0;
                 if (hasComponent) {
                     gameState.inventory[actionCode]--;
                     statusChange = 3; 
                     message = `–ó–∞—â–∏—Ç–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º **${RESOURCES[actionCode].name}** —É—Å–ø–µ—à–Ω–∞. **+3 –∫ —Å—Ç–∞—Ç—É—Å—É**!`;
                 } else {
                     gameState.inventory.HP -= 4;
                     statusChange = -2;
                     message = "–ù–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –¥–ª—è –∑–∞—â–∏—Ç—ã! –®—Ç–æ—Ä–º –ø–æ–≤—Ä–µ–¥–∏–ª –±–∞–∑—É. **-4 HP**, **-2 –∫ —Å—Ç–∞—Ç—É—Å—É**.";
                 }
            } else if (gameState.currentRound === 6) { // –û–±–º–µ–Ω (–ù–∞–∂–∞—Ç–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–û–±–º–µ–Ω")
                 // –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ
                 simulateConversation();
                 return;
            } else if (gameState.currentRound === 7) {
                assembleBeacon();
                return;
            }

            if (message) updateLog(`‚úÖ –î–µ–π—Å—Ç–≤–∏–µ —É—Å–ø–µ—à–Ω–æ. ${message}`);
            
            if (gameState.inventory.HP <= 0) {
                 gameOver("–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ä–∏—Å–∫–æ–≤! –ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —É–ø–∞–ª–æ –¥–æ –Ω—É–ª—è.");
                 return;
            }

            if (statusChange !== 0) {
                 gameState.historyLog.push({ round: gameState.currentRound, statusChange: statusChange, details: `–î–µ–π—Å—Ç–≤–∏–µ ${actionCode}` });
            }
            gameState.status = `–ü–æ—Å–ª–µ–¥–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ: ${message}`;
            loadRound(gameState.currentRound);
            updateUI();
        }

        // --- –§–ò–ù–ê–õ ---
        function assembleBeacon() {
            if (!takeAction()) return; 
            
            const required = { P: 1, G: 1, C: 1 };
            let canAssemble = true;

            for (const res in required) {
                if (gameState.inventory[res] < required[res]) {
                    updateLog(`üõë –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ${RESOURCES[res].name} (1 —à—Ç) –¥–ª—è —Å–±–æ—Ä–∫–∏ –ú–∞—è–∫–∞.`, true);
                    canAssemble = false;
                    break;
                }
            }

            if (canAssemble) {
                gameState.inventory.P -= 1;
                gameState.inventory.G -= 1;
                gameState.inventory.C -= 1;
                gameState.inventory.S = 1;
                updateLog(`üéâ **–ú–∞—è–∫ –°–ø–∞—Å–µ–Ω–∏—è –°–æ–±—Ä–∞–Ω!** –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—á–∞ —Å–∏–≥–Ω–∞–ª–∞.`);
                updateUI();
                
                // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
                document.getElementById('action-area').innerHTML = `<h3 style="color: #2ecc71;">${getFinalMessage()}</h3>`;
                document.getElementById('round-title').textContent = "üõ∞Ô∏è –§–ò–ù–ê–õ –ú–ò–°–°–ò–ò";
                document.getElementById('actions-remaining').textContent = 0;
            }
        }

        function calculateFinalScore() {
            const assemblyBonus = gameState.inventory.S > 0 ? 10 : 0; 
            const historyScore = gameState.historyLog.reduce((sum, log) => sum + log.statusChange, 0);
            return assemblyBonus + historyScore;
        }

        function getFinalMessage() {
            const score = calculateFinalScore();
            if (gameState.inventory.S === 0) return `‚ùå –ü—Ä–æ–≤–∞–ª –º–∏—Å—Å–∏–∏! –ú–∞—è–∫ –Ω–µ —Å–æ–±—Ä–∞–Ω. –°—á–µ—Ç: **${score}**`;
            if (score >= 15) return `üåü –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –£–°–ü–ï–•! –°—á–µ—Ç: **${score}**. –í—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç–µ—Å—å –≥–µ—Ä–æ–µ–º!`;
            if (score >= 8) return `‚úÖ –£–°–ü–ï–•! –°—á–µ—Ç: **${score}**. –°–∏–≥–Ω–∞–ª –ø—Ä–∏–Ω—è—Ç. –í—ã –≤—ã–∂–∏–ª–∏.`;
            return `‚ö†Ô∏è –ù–ò–ó–ö–ò–ô –£–°–ü–ï–•! –°—á–µ—Ç: **${score}**. –ú–∞—è–∫ —Å–æ–±—Ä–∞–Ω, –Ω–æ —Å–ª–∞–±—ã–π —Å–∏–≥–Ω–∞–ª.`;
        }

        // --- –ó–ê–ì–†–£–ó–ö–ê –†–ê–£–ù–î–û–í ---

        function getRoundDescription(round) {
            switch(round) {
                case 1: return `<h3>–¶–µ–ª—å: –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –°–±–æ—Ä</h3><p>–ß—Ç–æ–±—ã –¥–æ–±—ã—Ç—å —Ä–µ—Å—É—Ä—Å, –ø–æ–ø—Ä–æ—Å–∏—Ç–µ –í–µ–¥—É—â–µ–≥–æ –≤—ã–¥–∞—Ç—å –≤–∞–º **—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ** (—Å–º. –≤–∞—à—É —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é). –ó–∞–¥–∞–Ω–∏–µ ‚Äî —ç—Ç–æ 1 –¥–µ–π—Å—Ç–≤–∏–µ.</p><p>–ë–æ–Ω—É—Å: **${RESOURCES[GROUP_BONUSES[gameState.group]].name}** (+10 –µ–¥. –≤–º–µ—Å—Ç–æ +5).</p><hr><p>–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –í–µ–¥—É—â–µ–≥–æ: <code>–ó–ê–î–ê–ù–ò–ï E</code>, <code>–ó–ê–î–ê–ù–ò–ï W</code>, <code>–ó–ê–î–ê–ù–ò–ï T</code>, <code>–ó–ê–î–ê–ù–ò–ï M</code>, <code>–ó–ê–î–ê–ù–ò–ï K</code>.</p>`;
                case 2: return `<h3>–¶–µ–ª—å: –°–≤–æ–±–æ–¥–Ω—ã–π –°–±–æ—Ä (–õ–∏–º–∏—Ç)</h3><p>–ò—Å—Å–ª–µ–¥—É–π—Ç–µ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ —Å–æ–±–∏—Ä–∞–π—Ç–µ —Ä–µ—Å—É—Ä—Å—ã. –í—ã –º–æ–∂–µ—Ç–µ —Å–æ–±—Ä–∞—Ç—å –¥–æ **15 –µ–¥–∏–Ω–∏—Ü** –ª—é–±–æ–≥–æ –±–∞–∑–æ–≤–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ –∑–∞ –æ–¥–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ.</p><hr><p>–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –í–µ–¥—É—â–µ–≥–æ: <code>–°–ë–û–† E 10</code>, <code>–°–ë–û–† T 5</code> (–≥–¥–µ 10 –∏ 5 ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ).</p>`;
                case 3: return `<h3>–¶–µ–ª—å: –û–±—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ñ–∏–∑–Ω–∏ (–ë–∞–∑–æ–≤–æ–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ)</h3><p>–ü–æ—Å—Ç—Ä–æ–π—Ç–µ –æ–¥–∏–Ω –∏–∑ –±–∞–∑–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤, —á—Ç–æ–±—ã –∑–∞–∫—Ä–µ–ø–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏. –¢—Ä–∞—Ç–∏—Ç—Å—è 1 –¥–µ–π—Å—Ç–≤–∏–µ.</p>`;
                case 4: return `<h3>–¶–µ–ª—å: –†–∏—Å–∫ –∏ –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</h3><p>–í—ã–±–µ—Ä–∏—Ç–µ: —Ä–∏—Å–∫–Ω—É—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ–º —Ä–∞–¥–∏ –±–æ–ª—å—à–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –∏–ª–∏ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ HP.</p>`;
                case 5: return `<h3>–¶–µ–ª—å: –®—Ç–æ—Ä–º –∏ –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ</h3><p>–ù–∞–¥–≤–∏–≥–∞–µ—Ç—Å—è –º–æ—â–Ω—ã–π —à—Ç–æ—Ä–º. –í—ã–±–µ—Ä–∏—Ç–µ, –∫–∞–∫–æ–π –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å –¥–ª—è –∑–∞—â–∏—Ç—ã.</p>`;
                case 6: return `<h3>–¶–µ–ª—å: –§–∏–Ω–∞–ª—å–Ω–∞—è –¢–æ—Ä–≥–æ–≤–ª—è</h3><p>–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∞–∑–∞. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –¥—Ä—É–≥–∏–º–∏ –≥—Ä—É–ø–ø–∞–º–∏ —á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª —Å–≤—è–∑–∏ –∏ –ø—Ä–æ–≤–µ–¥–∏—Ç–µ –æ–±–º–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É **"–ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –û–±–º–µ–Ω"**.</p>`;
                case 7: return `<h3>–¶–µ–ª—å: –°–±–æ—Ä–∫–∞ –ú–∞—è–∫–∞ –∏ –§–∏–Ω–∞–ª</h3><p>–í–∞–º —Ç—Ä–µ–±—É–µ—Ç—Å—è 1 **–ú–∏–∫—Ä–æ-–ü–æ–ª–∏–≤ (P)**, 1 **–¢–µ—Ä–º–æ-–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä (G)** –∏ 1 **–ì–µ—Ä–º–æ-–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä (C)**.</p>`;
            }
        }

        function loadRound(round) {
            const desc = document.getElementById('round-description');
            const actions = document.getElementById('action-area');
            actions.innerHTML = '';
            desc.innerHTML = getRoundDescription(round);

            if (round === 1 || round === 2) {
                 actions.innerHTML = `<button disabled style="background: #3e4451;">–î–µ–π—Å—Ç–≤–∏—è: –≤–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã –≤ –∫–æ–Ω—Å–æ–ª—å –í–µ–¥—É—â–µ–≥–æ.</button>`;
            } else if (round === 3) {
                 actions.innerHTML = `
                     <button onclick="applyRoundAction('P')">–ë–∞–∑–æ–≤–∞—è –ø–∏—â–∞ (-3T, -3W) (–ü–æ–ª–∏–≤)</button>
                     <button onclick="applyRoundAction('G')">–ë–∞–∑–æ–≤–æ–µ —Ç–µ–ø–ª–æ (-3E, -3K) (–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä)</button>
                     <button onclick="applyRoundAction('C')">–ë–∞–∑–æ–≤–æ–µ —É–±–µ–∂–∏—â–µ (-3M, -3T) (–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä)</button>
                 `;
            } else if (round === 4) {
                 actions.innerHTML = `
                     <p>–î–æ—Å—Ç—É–ø–Ω–æ: ${RESOURCES.T.icon} T (${gameState.inventory.T})</p>
                     <button onclick="applyRoundAction('RiskHP')" style="background: #e74c3c;">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –†–∏—Å–∫ (-3 HP, +2 –°—Ç–∞—Ç—É—Å)</button>
                     <button onclick="applyRoundAction('SafeHP')" ${gameState.inventory.T < 5 ? 'disabled' : ''}>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (-5 T, +3 HP)</button>
                 `;
            } else if (round === 5) {
                 actions.innerHTML = `
                     <p>–î–æ—Å—Ç—É–ø–Ω–æ: ${RESOURCES.P.icon} P (${gameState.inventory.P}), ${RESOURCES.G.icon} G (${gameState.inventory.G}), ${RESOURCES.C.icon} C (${gameState.inventory.C})</p>
                     <button onclick="applyRoundAction('P')" ${gameState.inventory.P < 1 ? 'disabled' : ''}>–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å –ü–æ–ª–∏–≤ (-1 P, +3 –°—Ç–∞—Ç—É—Å)</button>
                     <button onclick="applyRoundAction('G')" ${gameState.inventory.G < 1 ? 'disabled' : ''}>–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä (-1 G, +3 –°—Ç–∞—Ç—É—Å)</button>
                     <button onclick="applyRoundAction('C')" ${gameState.inventory.C < 1 ? 'disabled' : ''}>–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä (-1 C, +3 –°—Ç–∞—Ç—É—Å)</button>
                 `;
            } else if (round === 6) {
                 actions.innerHTML = `
                     <button onclick="simulateConversation()" style="background: #c678dd;">–ù–∞—á–∞—Ç—å –ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã (–û—Ç–∫—Ä—ã–≤–∞–µ—Ç –æ–±–º–µ–Ω)</button>
                     <button disabled style="background: #3e4451;">–û–±–º–µ–Ω: —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å –í–µ–¥—É—â–µ–≥–æ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤.</button>
                 `;
            } else if (round === 7) {
                actions.innerHTML = `<button onclick="assembleBeacon()" style="background: #2ecc71;">üöÄ –°–æ–±—Ä–∞—Ç—å –ú–∞—è–∫ –°–ø–∞—Å–µ–Ω–∏—è</button>`;
            }
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
             updateLog("–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.");
        });
    </script>
</body>
</html>
