<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üëΩ –ü—Ä–æ–µ–∫—Ç ¬´–ê—Ä–µ—Å-VI¬ª: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –°–∏–º—É–ª—è—Ç–æ—Ä</title>
    <style>
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
        body { font-family: 'Space Mono', monospace; line-height: 1.6; margin: 0; background-color: #0d1a26; color: #a9e8f5; display: flex; justify-content: center; padding: 20px; }
        .container { max-width: 900px; width: 100%; background-color: #1a2a3a; padding: 40px; border-radius: 15px; box-shadow: 0 0 30px #00e0ff; border: 2px solid #00e0ff; }
        h1 { color: #ff6b6b; text-align: center; border-bottom: 3px solid #ff6b6b; padding-bottom: 15px; margin-bottom: 30px; }
        h2 { color: #7fdbff; border-bottom: 1px solid #7fdbff; padding-bottom: 5px; margin-top: 30px; }
        h3 { color: #f0e68c; margin-top: 20px; }
        .status-panel { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 15px; background-color: #2a3d54; border-radius: 8px; margin-bottom: 25px; border: 1px solid #7fdbff; }
        .status-item { text-align: center; font-size: 1.1em; }
        .resource-value { font-size: 1.5em; font-weight: bold; color: #7fff00; }
        .resource-key { font-weight: normal; color: #a9e8f5; display: block; font-size: 0.8em; }

        /* –¢–∞–±–ª–∏—Ü—ã –ø–æ–∫—É–ø–æ–∫ */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #3a4f63; padding: 12px; text-align: left; }
        th { background-color: #3a4f63; color: #e0e0e0; }
        .input-controls { display: flex; align-items: center; justify-content: space-between; max-width: 150px; }
        .input-controls button { background-color: #ff6b6b; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; font-weight: bold; }
        .input-controls button:hover { background-color: #e65a5a; }
        .purchase-row input { width: 40px; text-align: center; background: #1a2a3a; color: #7fff00; border: 1px solid #ff6b6b; }

        /* –ü–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        .controls-area { margin-top: 20px; padding: 20px; background-color: #2a3d54; border-radius: 8px; }
        .event-alert { background-color: #8b0000; padding: 15px; border-radius: 8px; margin-top: 20px; color: white; font-weight: bold; border: 2px dashed #ff0000; }
        .event-info { background-color: #003366; padding: 15px; border-radius: 8px; margin-top: 20px; color: #a9e8f5; border: 2px dashed #00bfff; }
        .action-buttons button { background-color: #00bfff; color: #0d1a26; border: none; padding: 10px 20px; margin-right: 10px; cursor: pointer; border-radius: 6px; font-weight: bold; transition: background-color 0.3s; }
        .action-buttons button:hover { background-color: #7fdbff; }
        .next-round-button { background-color: #7fff00; color: #0d1a26; padding: 15px 30px; font-size: 1.2em; border: none; cursor: pointer; border-radius: 8px; margin-top: 20px; width: 100%; font-weight: bold; }
        .next-round-button:hover { background-color: #bfff00; }
        
        /* –°–∫—Ä—ã—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
        .hidden { display: none; }
        
        /* –°–º–∞–π–ª–∏–∫–∏ */
        .alien { font-size: 1.5em; margin-right: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1><span class="alien">üëΩ</span> –ü—Ä–æ–µ–∫—Ç ¬´–ê—Ä–µ—Å-VI¬ª: 7 –•–æ–¥–æ–≤ –∫ –°–ø–∞—Å–µ–Ω–∏—é <span class="alien">üõ∞Ô∏è</span></h1>
    
    <h2>üìä –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° –°–¢–ê–ù–¶–ò–ò (–•–æ–¥: <span id="current-round">1</span>/7)</h2>
    <div class="status-panel">
        <div class="status-item"><span class="resource-key">–î–µ–Ω–µ–≥ (–î)</span><span class="resource-value" id="status-money">20</span></div>
        <div class="status-item"><span class="resource-key">–ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ (–ñ)</span><span class="resource-value" id="status-hp">100</span></div>
        <div class="status-item"><span class="resource-key">–≠–Ω–µ—Ä–≥–∏—è (–≠)</span><span class="resource-value" id="status-energy">0</span></div>
        <div class="status-item"><span class="resource-key">–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–ö)</span><span class="resource-value" id="status-comp">0</span></div>
        <div class="status-item"><span class="resource-key">–ö–∏—Å–ª–æ—Ä–æ–¥ (–û)</span><span class="resource-value" id="status-oxygen">0</span></div>
        <div class="status-item"><span class="resource-key">–ï–¥–∞ (–ï)</span><span class="resource-value" id="status-food">0</span></div>
    </div>
    <p>–ù–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –®—Ç—Ä–∞—Ñ—ã: <span id="penalties-display">–ù–µ—Ç</span></p>

    <div id="game-area">
        </div>

    <div class="controls-area" id="purchase-area">
        <h2>üí∞ –ó–ê–ö–£–ü–ö–ê –†–ï–°–£–†–°–û–í</h2>
        <p>–í–∞—à –±—é–¥–∂–µ—Ç: <span id="purchase-money-available" style="color:#7fff00; font-weight:bold;">20 –î</span></p>
        <table>
            <thead>
                <tr>
                    <th>–†–µ—Å—É—Ä—Å (–°–æ–∫—Ä.)</th>
                    <th>–¶–µ–Ω–∞ –∑–∞ 1 –µ–¥.</th>
                    <th>–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –ø–æ–∫—É–ø–∫–∏</th>
                    <th>–ö–æ–ª-–≤–æ –¥–ª—è –ø–æ–∫—É–ø–∫–∏</th>
                </tr>
            </thead>
            <tbody>
                <tr class="purchase-row"><td>–≠–Ω–µ—Ä–≥–∏—è (–≠)</td><td>2</td><td>8</td><td><div class="input-controls"><button onclick="adjustPurchase('E', -1)">-</button><input type="number" id="buy-E" value="0" min="0" max="8" readonly><button onclick="adjustPurchase('E', 1)">+</button></div></td></tr>
                <tr class="purchase-row"><td>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–ö)</td><td>3</td><td>5</td><td><div class="input-controls"><button onclick="adjustPurchase('C', -1)">-</button><input type="number" id="buy-C" value="0" min="0" max="5" readonly><button onclick="adjustPurchase('C', 1)">+</button></div></td></tr>
                <tr class="purchase-row"><td>–ö–∏—Å–ª–æ—Ä–æ–¥ (–û)</td><td>4</td><td>5</td><td><div class="input-controls"><button onclick="adjustPurchase('O', -1)">-</button><input type="number" id="buy-O" value="0" min="0" max="5" readonly><button onclick="adjustPurchase('O', 1)">+</button></div></td></tr>
                <tr class="purchase-row"><td>–ï–¥–∞ (–ï)</td><td>3</td><td>4</td><td><div class="input-controls"><button onclick="adjustPurchase('F', -1)">-</button><input type="number" id="buy-F" value="0" min="0" max="4" readonly><button onclick="adjustPurchase('F', 1)">+</button></div></td></tr>
            </tbody>
        </table>
        <p style="text-align:right; font-size:1.1em;">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: <span id="total-cost" style="color:#ff6b6b; font-weight:bold;">0 –î</span></p>
        
        <div id="special-actions" class="hidden">
            <h2>‚öôÔ∏è –î–ï–ô–°–¢–í–ò–ï –†–ê–£–ù–î–ê (–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</h2>
            <div class="action-buttons">
                <button id="action-repair" onclick="performAction('REPAIR')" disabled>–ü–æ—á–∏–Ω–∏—Ç—å</button>
                <button id="action-optimize" onclick="performAction('OPTIMIZE')" disabled>–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≠</button>
                <button id="action-explore" onclick="performAction('EXPLORE')" disabled>–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –û—Ç—Å–µ–∫</button>
                <button id="action-money" onclick="performAction('MONEY')" disabled>–ê–≤–∞—Ä–∏–π–Ω—ã–π –°–±–æ—Ä (+10 –î)</button>
            </div>
            <p id="action-message" style="margin-top:10px; color:#f0e68c;"></p>
        </div>

        <button class="next-round-button" onclick="nextRound()">–ó–ê–ö–û–ù–ß–ò–¢–¨ –•–û–î –ò –†–ê–°–ß–ï–¢ <span class="alien">‚ñ∂Ô∏è</span></button>
    </div>
</div>

<script>
    // --- –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–´ ---
    const COSTS = { E: 2, C: 3, O: 4, F: 3 };
    const MAX_BUY = { E: 8, C: 5, O: 5, F: 4 };

    let state = {
        money: 20,
        hp: 100,
        energy: 0,
        comp: 0,
        oxygen: 0,
        food: 0,
        round: 1,
        
        // –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —à—Ç—Ä–∞—Ñ—ã –∏ —Å—Ç–∞—Ç—É—Å—ã –ø–æ–ª–æ–º–æ–∫
        penalties: {
            O_cost_multiplier: 1, // –•–æ–¥ 2: 2 (–¥–≤–æ–π–Ω–æ–π —Ä–∞—Å—Ö–æ–¥ –û)
            E_base_cost: 1,       // –•–æ–¥ 3: 2 (—É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ –≠)
            food_moral_penalty: 0, // –•–æ–¥ 4: -5 –ñ –∑–∞ 0 –ï
            signal_bonus: 0,      // –•–æ–¥ 6: +10 –ñ
        },
        
        // –¢–µ–∫—É—â–∞—è –ø–æ–∫—É–ø–∫–∞
        currentPurchase: { E: 0, C: 0, O: 0, F: 0 },
        // –õ–æ–≥–∏–∫–∞ —Ä–µ–º–æ–Ω—Ç–∞
        repairCost: 0,
        repairName: "",
        isCriticalRepair: false,
    };

    // --- –õ–û–ì–ò–ö–ê –ò–ù–¢–ï–†–§–ï–ô–°–ê ---

    function updateStatus() {
        document.getElementById('status-money').textContent = state.money.toFixed(0);
        document.getElementById('status-hp').textContent = state.hp.toFixed(0);
        document.getElementById('status-energy').textContent = state.energy.toFixed(1);
        document.getElementById('status-comp').textContent = state.comp.toFixed(0);
        document.getElementById('status-oxygen').textContent = state.oxygen.toFixed(0);
        document.getElementById('status-food').textContent = state.food.toFixed(0);
        document.getElementById('current-round').textContent = state.round;
        document.getElementById('purchase-money-available').textContent = state.money.toFixed(0) + ' –î';
        
        let penText = [];
        if (state.penalties.O_cost_multiplier > 1) penText.push('–ö–∏—Å–ª–æ—Ä–æ–¥ x2');
        if (state.penalties.E_base_cost > 1) penText.push('–≠–Ω–µ—Ä–≥–∏—è +1');
        if (state.penalties.food_moral_penalty > 0) penText.push('–ú–æ—Ä–∞–ª—å -5 –ñ');
        document.getElementById('penalties-display').textContent = penText.length ? penText.join(', ') : '–ù–µ—Ç';

        updatePurchaseCost();
        updateActions();
    }

    function adjustPurchase(resource, change) {
        const inputId = `buy-${resource}`;
        let value = parseInt(document.getElementById(inputId).value);
        let newValue = Math.max(0, Math.min(MAX_BUY[resource], value + change));

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—é–¥–∂–µ—Ç–∞
        const costChange = (newValue - value) * COSTS[resource];
        const currentTotalCost = calculateTotalCost();
        
        if (currentTotalCost + costChange <= state.money) {
            document.getElementById(inputId).value = newValue;
            state.currentPurchase[resource] = newValue;
            updatePurchaseCost();
        }
    }

    function calculateTotalCost() {
        let total = 0;
        for (const res in state.currentPurchase) {
            total += state.currentPurchase[res] * COSTS[res];
        }
        return total;
    }

    function updatePurchaseCost() {
        const cost = calculateTotalCost();
        document.getElementById('total-cost').textContent = cost.toFixed(0) + ' –î';
    }

    function updateActions() {
        // –£—Å–ª–æ–≤–∏–µ –¥–ª—è –ê–≤–∞—Ä–∏–π–Ω–æ–≥–æ –°–±–æ—Ä–∞
        document.getElementById('action-money').disabled = state.money > 5 || state.energy < 2 || state.comp < 1;
        document.getElementById('action-money').textContent = state.money <= 5 ? '–ê–≤–∞—Ä–∏–π–Ω—ã–π –°–±–æ—Ä (2 –≠, 1 –ö)' : '–ê–≤–∞—Ä–∏–π–Ω—ã–π –°–±–æ—Ä (–î > 5)';
        
        // –†–µ–º–æ–Ω—Ç
        const repairBtn = document.getElementById('action-repair');
        if (state.repairCost > 0) {
            repairBtn.textContent = `–ü–æ—á–∏–Ω–∏—Ç—å ${state.repairName} (${state.repairCost} –ö)`;
            repairBtn.disabled = state.comp < state.repairCost;
        } else {
            repairBtn.textContent = '–ü–æ—á–∏–Ω–∏—Ç—å (–ù–µ—Ç –ø–æ–ª–æ–º–æ–∫)';
            repairBtn.disabled = true;
        }

        // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
        document.getElementById('action-optimize').disabled = state.food < 3;
    }

    // --- –õ–û–ì–ò–ö–ê –†–ê–£–ù–î–û–í ---

    function getRoundContent(round) {
        document.getElementById('special-actions').classList.remove('hidden');
        document.getElementById('action-message').textContent = "";
        
        state.repairCost = 0;
        state.repairName = "";
        state.isCriticalRepair = false;

        switch (round) {
            case 1:
                return `<div class="event-info"><h3><span class="alien">üî≠</span> –ù–ê–ß–ê–õ–¨–ù–´–ô –†–ê–£–ù–î: –ü–µ—Ä–≤–∞—è –ü–∞–Ω–∏–∫–∞</h3><p>–í–∞—à–∞ —Ü–µ–ª—å: –∑–∞–∫—É–ø–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã (–≠, –û, –ï), —á—Ç–æ–±—ã –ø–µ—Ä–µ–∂–∏—Ç—å —ç—Ç–æ—Ç —Ö–æ–¥ –±–µ–∑ –ø–æ—Ç–µ—Ä—å –ñ. –ù–∞—á–∞–ª—å–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ –ñ: -5 (–±–∞–∑–∞) + -10 (–∑–∞ 0 –û) + -5 (–∑–∞ 0 –ï) = <span style="color:#ff6b6b;">-20 –ñ</span>.</p></div>`;
            case 2:
                state.repairCost = 3; state.repairName = '–ö–∏—Å–ª–æ—Ä–æ–¥ (x2)';
                document.getElementById('action-repair').onclick = () => performAction('REPAIR_OXYGEN');
                return `<div class="event-alert"><h3><span class="alien">üî•</span> –°–û–ë–´–¢–ò–ï: –°–±–æ–π –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ö–∏—Å–ª–æ—Ä–æ–¥–∞!</h3><p>–ü–æ–≤—Ä–µ–∂–¥–µ–Ω –≥–ª–∞–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä. ‚ùå **–ü–û–õ–û–ú–ö–ê:** –° —ç—Ç–æ–≥–æ —Ö–æ–¥–∞ **—Ä–∞—Å—Ö–æ–¥ –ö–∏—Å–ª–æ—Ä–æ–¥–∞ (–û) —É–¥–≤–∞–∏–≤–∞–µ—Ç—Å—è** (—Ç.–µ. 1 –µ–¥. –û –ø–æ–∫—Ä—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ 0.5 —Ö–æ–¥–∞). üõ†Ô∏è **–ü–û–ß–ò–ù–ö–ê:** –¢—Ä–µ–±—É–µ—Ç—Å—è **3 –ö**.</p></div>`;
            case 3:
                state.repairCost = 4; state.repairName = '–≠–Ω–µ—Ä–≥–æ—Å–µ—Ç—å (+1 –≠)';
                document.getElementById('action-repair').onclick = () => performAction('REPAIR_ENERGY');
                return `<div class="event-alert"><h3><span class="alien">‚ö°</span> –°–û–ë–´–¢–ò–ï: –ü–µ—Ä–µ–Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –≠–Ω–µ—Ä–≥–æ—Å–µ—Ç–∏!</h3><p>–ö–æ—Ä–æ—Ç–∫–æ–µ –∑–∞–º—ã–∫–∞–Ω–∏–µ. ‚ùå **–ü–û–õ–û–ú–ö–ê:** **–ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥ –≠–Ω–µ—Ä–≥–∏–∏ (–≠)** —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ **-1 –≠** –∑–∞ —Ö–æ–¥. (–ò—Ç–æ–≥–æ: -2 –≠ + –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏). üõ†Ô∏è **–ü–û–ß–ò–ù–ö–ê:** –¢—Ä–µ–±—É–µ—Ç—Å—è **4 –ö**.</p></div>`;
            case 4:
                document.getElementById('action-repair').disabled = true;
                return `<div class="event-info"><h3><span class="alien">üçé</span> –°–û–ë–´–¢–ò–ï: –ù–µ–¥–æ–≤–æ–ª—å—Å—Ç–≤–æ –ö–æ–º–∞–Ω–¥—ã!</h3><p>–ò–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –ï–¥—ã –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ. üìâ **–®–¢–†–ê–§:** –ï—Å–ª–∏ –≤ –∫–æ–Ω—Ü–µ —ç—Ç–æ–≥–æ —Ö–æ–¥–∞ —É –≤–∞—Å **0 –ï–¥—ã (–ï)**, –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ **–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —à—Ç—Ä–∞—Ñ -5 –ñ** (–Ω–∞—á–∏–Ω–∞—è —Å–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ö–æ–¥–∞, —Å—É–º–º–∏—Ä—É–µ—Ç—Å—è —Å –±–∞–∑–æ–≤—ã–º —à—Ç—Ä–∞—Ñ–æ–º). üõ†Ô∏è **–£–°–¢–†–ê–ù–ï–ù–ò–ï:** –û–±–µ—Å–ø–µ—á–∏—Ç—å –∑–∞–ø–∞—Å **–ï–¥—ã (–ï) ‚â• 1**.</p></div>`;
            case 5:
                state.repairCost = 2; state.repairName = '–ì–µ—Ä–º–µ—Ç–∏–∑–∞—Ü–∏—è (-15 –ñ)';
                state.isCriticalRepair = true;
                document.getElementById('action-repair').onclick = () => performAction('REPAIR_CRIT');
                return `<div class="event-alert"><h3><span class="alien">üí•</span> –°–û–ë–´–¢–ò–ï: –ú–∏–∫—Ä–æ–º–µ—Ç–µ–æ—Ä–∏—Ç!</h3><p>–ü—Ä–æ–±–æ–∏–Ω–∞ –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –æ—Ç—Å–µ–∫–µ. üìâ **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –®–¢–†–ê–§:** –ï—Å–ª–∏ –Ω–µ –ø–æ—á–∏–Ω–∏—Ç—å **–î–û** –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ö–æ–¥–∞, –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ **-15 –ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è (–ñ)** –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ. üõ†Ô∏è **–ü–û–ß–ò–ù–ö–ê:** –¢—Ä–µ–±—É–µ—Ç—Å—è **2 –ö** (—É—Å—Ç—Ä–∞–Ω—è–µ—Ç —É—Ä–æ–Ω).</p></div>`;
            case 6:
                document.getElementById('action-repair').disabled = true;
                document.getElementById('action-optimize').disabled = true;
                document.getElementById('action-explore').disabled = true;
                document.getElementById('action-money').disabled = true;

                document.getElementById('action-message').innerHTML = `
                    <p>üì° –¢–†–ï–ë–û–í–ê–ù–ò–ï: –î–ª—è –±–æ–Ω—É—Å–∞ –≤ –§–∏–Ω–∞–ª–µ –ø–æ—Ç—Ä–∞—Ç—å—Ç–µ **4 –≠** –∏ **2 –û**.</p>
                    <button onclick="performAction('SIGNAL')" style="background-color:gold;">–ü–û–î–î–ï–†–ñ–ê–¢–¨ –ú–ê–Ø–ö (4 –≠, 2 –û)</button>
                `;
                return `<div class="event-info"><h3><span class="alien">üì°</span> –°–û–ë–´–¢–ò–ï: –°–ª–∞–±—ã–π –°–∏–≥–Ω–∞–ª!</h3><p>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–ø–∞—Å–∞—Ç–µ–ª—å–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏! –ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –º–∞—è–∫ –¥–ª—è –Ω–∞–≤–µ–¥–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏—è <span style="color:#7fff00;">+10 –ñ</span> –≤ —Ñ–∏–Ω–∞–ª–µ.</p></div>`;
            case 7:
                document.getElementById('action-repair').disabled = true;
                state.hp -= 10; // –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π —à—Ç—Ä–∞—Ñ —Ä–∞—É–Ω–¥–∞ 7
                return `<div class="event-alert"><h3><span class="alien">üí®</span> –°–û–ë–´–¢–ò–ï: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ü–æ–ª–æ–º–∫–∞ –§–∏–ª—å—Ç—Ä–∞!</h3><p>‚ùå **–ù–ï–ò–ó–ë–ï–ñ–ù–û:** –ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥ **–ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è (–ñ)** –≤–æ–∑—Ä–∞—Å—Ç–∞–µ—Ç –Ω–∞ **-10 –ñ** –≤ —ç—Ç–æ–º –ø–æ—Å–ª–µ–¥–Ω–µ–º —Ö–æ–¥—É.</p></div>`;
            case 8:
                return finalScreen();
            default:
                return `–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.`;
        }
    }

    // --- –ì–õ–ê–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –ò–ì–†–´ (–ü–ï–†–ï–•–û–î –ú–ï–ñ–î–£ –†–ê–£–ù–î–ê–ú–ò) ---

    function nextRound() {
        if (state.hp <= 0) {
            document.getElementById('game-area').innerHTML = finalScreen();
            document.getElementById('purchase-area').classList.add('hidden');
            return;
        }

        // 1. –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ–∫—É–ø–∫–∏
        const cost = calculateTotalCost();
        if (state.money < cost) {
            alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –î–µ–Ω–µ–≥ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–∫—É–ø–∫–∏!");
            return;
        }
        state.money -= cost;

        // 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
        state.energy += state.currentPurchase.E;
        state.comp += state.currentPurchase.C;
        state.oxygen += state.currentPurchase.O;
        state.food += state.currentPurchase.F;

        // 3. –°–±—Ä–æ—Å —Ç–µ–∫—É—â–µ–π –ø–æ–∫—É–ø–∫–∏
        for (const res in state.currentPurchase) {
            state.currentPurchase[res] = 0;
            document.getElementById(`buy-${res}`).value = 0;
        }
        updatePurchaseCost();
        
        // 4. –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞—Å—Ö–æ–¥–∞
        const energyCost = state.penalties.E_base_cost;

        if (state.energy < energyCost) {
            state.hp = 0; // –ù–µ—Ö–≤–∞—Ç–∫–∞ —ç–Ω–µ—Ä–≥–∏–∏ - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è —Å–º–µ—Ä—Ç—å
            alert("‚ùå –ê–í–ê–†–ò–Ø: –ù–µ—Ö–≤–∞—Ç–∫–∞ –≠–Ω–µ—Ä–≥–∏–∏! –°—Ç–∞–Ω—Ü–∏—è –æ–±–µ—Å—Ç–æ—á–µ–Ω–∞. GAME OVER.");
        } else {
            state.energy -= energyCost;
            
            // –†–∞—Å—á–µ—Ç —à—Ç—Ä–∞—Ñ–æ–≤ –ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è
            let hp_deduction = 5; // –ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥ –ñ
            
            // –®—Ç—Ä–∞—Ñ –∑–∞ 0 –ö–∏—Å–ª–æ—Ä–æ–¥–∞
            if (state.oxygen <= 0) hp_deduction += 10;
            // –®—Ç—Ä–∞—Ñ –∑–∞ 0 –ï–¥—ã
            if (state.food <= 0) hp_deduction += 5;
            
            // –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —à—Ç—Ä–∞—Ñ –º–æ—Ä–∞–ª–∏ (—Å –•–æ–¥–∞ 4)
            if (state.penalties.food_moral_penalty > 0) hp_deduction += state.penalties.food_moral_penalty;

            // –†–∞—Å—Ö–æ–¥ –ö–∏—Å–ª–æ—Ä–æ–¥–∞ (—Å —É—á–µ—Ç–æ–º –ø–æ–ª–æ–º–∫–∏)
            if (state.oxygen > 0) {
                const oxygen_used = 1 * state.penalties.O_cost_multiplier;
                state.oxygen = Math.max(0, state.oxygen - oxygen_used);
            }
            
            // –§–∏–Ω–∞–ª—å–Ω—ã–π —à—Ç—Ä–∞—Ñ —Ä–∞—É–Ω–¥–∞ 7
            if (state.round === 7) hp_deduction += 10; 

            state.hp -= hp_deduction;

            // 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –ø–æ–ª–æ–º–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–æ—Ä–∞–ª—å–Ω—ã–π —à—Ç—Ä–∞—Ñ –•–æ–¥–∞ 4)
            if (state.round === 4 && state.food <= 0) {
                state.penalties.food_moral_penalty = 5;
                alert("‚ö†Ô∏è –ú–û–†–ê–õ–¨–ù–´–ô –£–†–û–ù: –ò–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –ï–¥—ã –≤ —ç—Ç–æ–º —Ä–∞—É–Ω–¥–µ, –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π —à—Ç—Ä–∞—Ñ -5 –ñ –Ω–∞—á–∏–Ω–∞—è —Å–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ö–æ–¥–∞!");
            }
        }

        // 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ GAME OVER
        if (state.hp <= 0) {
             document.getElementById('game-area').innerHTML = finalScreen();
             document.getElementById('purchase-area').classList.add('hidden');
             updateStatus();
             return;
        }

        // 7. –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞—É–Ω–¥—É
        state.round++;
        
        // 8. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        updateStatus();
        document.getElementById('game-area').innerHTML = getRoundContent(state.round);

        // –ï—Å–ª–∏ —ç—Ç–æ —Ñ–∏–Ω–∞–ª, —Å–∫—Ä—ã—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        if (state.round > 7) {
            document.getElementById('purchase-area').classList.add('hidden');
        }
    }

    // --- –õ–û–ì–ò–ö–ê –°–ü–ï–¶–ò–ê–õ–¨–ù–´–• –î–ï–ô–°–¢–í–ò–ô ---

    function performAction(actionType) {
        let msg = "";

        // –†–µ–º–æ–Ω—Ç
        if (actionType.startsWith('REPAIR')) {
            const cost = state.repairCost;
            if (state.comp < cost) {
                msg = "‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è —Ä–µ–º–æ–Ω—Ç–∞!";
            } else {
                state.comp -= cost;
                state.repairCost = 0;
                
                if (actionType === 'REPAIR_OXYGEN') {
                    state.penalties.O_cost_multiplier = 1;
                    msg = `‚úÖ –£—Å–ø–µ—à–Ω—ã–π —Ä–µ–º–æ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã –ö–∏—Å–ª–æ—Ä–æ–¥–∞! –®—Ç—Ä–∞—Ñ x2 –Ω–∞ –û —É—Å—Ç—Ä–∞–Ω–µ–Ω.`;
                } else if (actionType === 'REPAIR_ENERGY') {
                    state.penalties.E_base_cost = 1;
                    msg = `‚úÖ –£—Å–ø–µ—à–Ω—ã–π —Ä–µ–º–æ–Ω—Ç –≠–Ω–µ—Ä–≥–æ—Å–µ—Ç–∏! –®—Ç—Ä–∞—Ñ +1 –≠ —É—Å—Ç—Ä–∞–Ω–µ–Ω.`;
                } else if (actionType === 'REPAIR_CRIT') {
                    msg = `‚úÖ –£—Å–ø–µ—à–Ω–∞—è –≥–µ—Ä–º–µ—Ç–∏–∑–∞—Ü–∏—è –ü—Ä–æ–±–æ–∏–Ω—ã! –£—Ä–æ–Ω -15 –ñ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω.`;
                }
            }
        }
        
        // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≠–Ω–µ—Ä–≥–∏–∏
        else if (actionType === 'OPTIMIZE') {
            if (state.food < 3) {
                msg = "‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ï–¥—ã (3 –ï) –¥–ª—è —Å–≤–µ—Ä—Ö—É—Ä–æ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ç–µ—Ö–Ω–∏–∫–æ–≤!";
            } else {
                state.food -= 3;
                state.penalties.E_base_cost = Math.max(0.5, state.penalties.E_base_cost - 0.5);
                msg = `‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≠–Ω–µ—Ä–≥–∏–∏ —É—Å–ø–µ—à–Ω–∞! –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ –≠ —Å–Ω–∏–∂–µ–Ω –Ω–∞ 0.5.`;
            }
        }

        // –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –û—Ç—Å–µ–∫–∞
        else if (actionType === 'EXPLORE') {
            if (state.energy < 2) {
                msg = "‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≠–Ω–µ—Ä–≥–∏–∏ (2 –≠) –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è!";
            } else {
                state.energy -= 2;
                const result = Math.floor(Math.random() * 3);
                if (result === 0) { state.money += 5; msg = `‚úÖ –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: –ù–∞–π–¥–µ–Ω—ã –±—Ä–æ—à–µ–Ω–Ω—ã–µ –ø—Ä–∏–ø–∞—Å—ã! +5 –î.`; }
                else if (result === 1) { state.comp += 2; msg = `‚úÖ –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: –ù–∞–π–¥–µ–Ω—ã –∑–∞–ø–∞—Å–Ω—ã–µ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã! +2 –ö.`; }
                else { state.hp -= 5; msg = `‚ùå –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —É—Ç–µ—á–∫–∞ —Ä–∞–¥–∏–∞—Ü–∏–∏! -5 –ñ.`; }
            }
        }
        
        // –ê–≤–∞—Ä–∏–π–Ω—ã–π –°–±–æ—Ä
        else if (actionType === 'MONEY') {
            if (state.money > 5) {
                msg = "‚ùå –ö–∞–ø–∏—Ç–∞–ª > 5 –î. –≠—Ç–∞ –æ–ø—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.";
            } else if (state.energy < 2 || state.comp < 1) {
                msg = "‚ùå –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 2 –≠ –∏ 1 –ö –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Å–∫–∞—Ñ–∞–Ω–¥—Ä–∞.";
            } else {
                state.energy -= 2;
                state.comp -= 1;
                state.money += 10;
                msg = `‚úÖ –ê–≤–∞—Ä–∏–π–Ω—ã–π –°–±–æ—Ä —É—Å–ø–µ—à–µ–Ω! –ü–æ–ª—É—á–µ–Ω–æ +10 –î.`;
            }
        }

        // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ú–∞—è–∫–∞ (–•–æ–¥ 6)
        else if (actionType === 'SIGNAL') {
            if (state.energy < 4 || state.oxygen < 2) {
                msg = "‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ 4 –≠ –∏ 2 –û –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –º–∞—è–∫–∞!";
            } else {
                state.energy -= 4;
                state.oxygen -= 2;
                state.penalties.signal_bonus = 10;
                msg = `‚úÖ –ú–∞—è–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –í—ã –æ–±–µ—Å–ø–µ—á–∏–ª–∏ –±–æ–Ω—É—Å +10 –ñ –≤ —Ñ–∏–Ω–∞–ª–µ.`;
            }
        }

        document.getElementById('action-message').textContent = msg;
        updateStatus();
    }

    // --- –§–ò–ù–ê–õ–¨–ù–´–ô –≠–ö–†–ê–ù ---

    function finalScreen() {
        let final_hp = state.hp + state.penalties.signal_bonus;
        let result_text, result_style;

        if (final_hp <= 0) {
            result_text = `üíÄ –ö—Ä–∞—Ö. –°–ø–∞—Å–∞—Ç–µ–ª–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç –∑–∞–º–µ—Ä–∑—à—É—é —Å—Ç–∞–Ω—Ü–∏—é. –ú–∏—Å—Å–∏—è –ø—Ä–æ–≤–∞–ª–µ–Ω–∞.`;
            result_style = 'color: #ff0000; font-size: 2em;';
        } else if (final_hp <= 20) {
            result_text = `‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –í—ã–∂–∏–≤–∞–Ω–∏–µ. –í—ã –≤—ã–∂–∏–ª–∏ (–ñ: ${final_hp}), –Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ —Ç—è–∂–µ–ª–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏. –°—Ç–∞–Ω—Ü–∏—è –ø–æ—á—Ç–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∞.`;
            result_style = 'color: #ffaa00; font-size: 1.8em;';
        } else if (final_hp <= 40) {
            result_text = `‚úÖ –í—ã–∂–∏–≤–∞–Ω–∏–µ. –í—ã –ø—Ä–æ–¥–µ—Ä–∂–∞–ª–∏—Å—å (–ñ: ${final_hp}). –°–ø–∞—Å–∞—Ç–µ–ª–∏ –ø—Ä–∏–±—ã–≤–∞—é—Ç –≤–æ–≤—Ä–µ–º—è –∏ –Ω–∞—á–∏–Ω–∞—é—Ç —ç–≤–∞–∫—É–∞—Ü–∏—é.`;
            result_style = 'color: #7fdbff; font-size: 1.8em;';
        } else {
            result_text = `‚≠ê –£—Å–ø–µ—Ö. –í—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª–∏ —Å—Ç–∞–Ω—Ü–∏—é –≤ –æ—Ç–ª–∏—á–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (–ñ: ${final_hp}). –í—ã –∏ –∫–æ–º–∞–Ω–¥–∞ —ç–≤–∞–∫—É–∏—Ä–æ–≤–∞–Ω—ã, –∞ —Å—Ç–∞–Ω—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.`;
            result_style = 'color: #7fff00; font-size: 2em;';
        }

        return `
            <h2><span class="alien">üèÅ</span> –§–ò–ù–ê–õ: –ü—Ä–∏–±—ã—Ç–∏–µ –°–ø–∞—Å–∞—Ç–µ–ª–µ–π!</h2>
            <div class="event-info">
                <h3>–ò–¢–û–ì–û–í–´–ô –†–ê–°–ß–ï–¢</h3>
                <p>–ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª—å–Ω—ã–º –±–æ–Ω—É—Å–æ–º: ${state.hp.toFixed(0)}</p>
                <p>–ë–æ–Ω—É—Å –∑–∞ –ú–∞—è–∫ (–•–æ–¥ 6): +${state.penalties.signal_bonus} –ñ</p>
                <p style="font-size:1.5em; font-weight:bold;">–§–∏–Ω–∞–ª—å–Ω–æ–µ –ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ: <span style="color:#f0e68c;">${final_hp.toFixed(0)}</span></p>
            </div>
            <div class="event-alert" style="background-color: #2a3d54;">
                <p style="${result_style}">${result_text}</p>
            </div>
            <p style="text-align:center; margin-top:30px; color:#a9e8f5;">–°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É! –ö–æ–º–∞–Ω–¥–∏—Ä, –≤—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é –º–∏—Å—Å–∏—é.</p>
        `;
    }

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
    function initGame() {
        document.getElementById('game-area').innerHTML = getRoundContent(state.round);
        updateStatus();
    }

    initGame();

</script>

</body>
</html>
