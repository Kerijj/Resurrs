<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–£–ù–ö–ï–†-–°–ò–ì–ù–ê–õ: –°–ë–û–† –ò –ê–ù–ê–õ–ò–ó</title>
    <style>
        /* --- –û–°–ù–û–í–ù–´–ï –ù–ï–û–ù–û–í–´–ï –°–¢–ò–õ–ò --- */
        body {
            font-family: 'Consolas', 'Courier New', monospace;
            background-color: #0d0d0d;
            color: #00ff41; /* –Ø—Ä–∫–æ-–∑–µ–ª–µ–Ω—ã–π –Ω–µ–æ–Ω */
            margin: 0;
            padding: 20px;
            text-shadow: 0 0 5px #00ff41, 0 0 10px rgba(0, 255, 65, 0.5);
            line-height: 1.6;
        }
        h1, h2, h3, h4 {
            color: #00ffcc; /* –ë–∏—Ä—é–∑–æ–≤—ã–π –Ω–µ–æ–Ω */
            text-align: center;
            border-bottom: 2px solid #00ffcc;
            padding-bottom: 10px;
            margin-bottom: 20px;
            text-shadow: 0 0 8px #00ffcc, 0 0 15px rgba(0, 255, 204, 0.4);
        }
        #team-select, #game-container {
            max-width: 900px;
            margin: 0 auto;
            border: 2px solid #00ff41;
            padding: 30px;
            box-shadow: 0 0 20px #00ff41, 0 0 30px rgba(0, 255, 65, 0.3);
            background-color: rgba(0, 0, 0, 0.7);
        }
        
        /* --- –°–¢–ò–õ–ò –ö–ù–û–ü–û–ö --- */
        .btn, .choice-btn {
            background-color: transparent;
            color: #00ff41;
            border: 2px solid #00ff41;
            padding: 12px 25px;
            margin: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            font-size: 1.1em;
            text-shadow: 0 0 5px #00ff41;
            box-shadow: 0 0 5px #00ff41 inset, 0 0 5px #00ff41;
            text-transform: uppercase;
        }
        .btn:hover, .choice-btn:hover {
            background-color: rgba(0, 255, 65, 0.2);
            color: #0d0d0d;
            border-color: #ffcc00; 
            box-shadow: 0 0 15px #ffcc00, 0 0 20px rgba(255, 204, 0, 0.5);
        }
        .choice-btn.selected {
            border-color: #00ffcc;
            box-shadow: 0 0 15px #00ffcc;
            background-color: rgba(0, 255, 204, 0.1);
        }

        /* --- –ù–ê–í–ò–ì–ê–¶–ò–Ø –ò –¢–ê–ô–ú–ï–† --- */
        #round-nav {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .round-btn {
            background-color: transparent;
            color: #00ff41;
            border: 1px dashed #00ff41;
            padding: 10px 18px;
            margin: 5px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            text-shadow: 0 0 3px #00ff41;
        }
        .round-btn.active {
            color: #ffcc00;
            border-color: #ffcc00;
            box-shadow: 0 0 10px #ffcc00;
        }
        #timer-display {
            font-size: 3em;
            color: #ffcc00; 
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            border: 3px double #ffcc00;
            background-color: #331a00;
            text-shadow: 0 0 10px #ffcc00;
        }
        .round-objective {
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid #00ffcc;
            text-align: center;
            background-color: rgba(0, 255, 204, 0.05);
        }
        .card-list {
            list-style: none;
            padding: 0;
        }
        .card-list li {
            background-color: #1a1a1a;
            border-left: 5px solid #00ffcc;
            padding: 10px;
            margin-bottom: 8px;
            box-shadow: 0 0 5px rgba(0, 255, 204, 0.2);
        }
        .warning {
            color: #ff004c;
            font-weight: bold;
        }
        .success {
            color: #00ff41;
            font-weight: bold;
        }
        /* --- –ü–û–õ–Ø –í–í–û–î–ê --- */
        .input-area input[type="text"] {
            padding: 10px;
            margin-top: 10px;
            background-color: #0d0d0d;
            border: 2px solid #00ff41;
            color: #00ff41;
            font-family: inherit;
            font-size: 1.1em;
            text-transform: uppercase;
            box-shadow: 0 0 5px #00ff41;
            width: 70%;
            max-width: 300px;
            box-sizing: border-box; 
        }

    </style>
</head>
<body>

    <div id="team-select">
        <h1>[ –°–ò–°–¢–ï–ú–ê –í–´–ñ–ò–í–ê–ù–ò–Ø –ë–£–ù–ö–ï–†–ê ]</h1>
        <h2>–ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–í–Ø–ó–ò</h2>
        <div style="text-align: center; margin-top: 40px;">
            <button class="btn" onclick="selectTeam('Group 1')">–ì–†–£–ü–ü–ê 1: –°–ï–ö–¶–ò–Ø –ê–õ–¨–§–ê</button>
            <button class="btn" onclick="selectTeam('Group 2')">–ì–†–£–ü–ü–ê 2: –°–ï–ö–¶–ò–Ø –ë–ï–¢–ê</button>
            <button class="btn" onclick="selectTeam('Group 3')">–ì–†–£–ü–ü–ê 3: –°–ï–ö–¶–ò–Ø –ì–ê–ú–ú–ê</button>
        </div>
    </div>

    <div id="game-container" style="display:none;">
        <h1>–ë–£–ù–ö–ï–†: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –†–ï–ñ–ò–ú</h1>
        <h2 id="team-display" style="color: #ffcc00;"></h2>

        <div id="timer-display">
            <span id="timer-label">–í–†–ï–ú–Ø –ù–ê –†–ê–£–ù–î</span>
            <span id="time-left">05:00</span>
        </div>
        
        <div id="round-nav">
            <button class="round-btn active" data-round="1" onclick="showRound(1)">–†–ê–£–ù–î 1: –†–ï–°–£–†–°–´ üì¶</button>
            <button class="round-btn" data-round="2" onclick="showRound(2)">–†–ê–£–ù–î 2: –§–ò–õ–¨–¢–† üíß</button>
            <button class="round-btn" data-round="3" onclick="showRound(3)">–†–ê–£–ù–î 3: –°–í–Ø–ó–¨ üì°</button>
            <button class="round-btn" data-round="4" onclick="showRound(4)">–†–ê–£–ù–î 4: –í–´–•–û–î üå≤</button>
            <button class="round-btn" data-round="5" onclick="showRound(5)">–†–ê–£–ù–î 5: –§–ò–ù–ê–õ ü§ù</button>
        </div>

        <div id="round-content">
            </div>
    </div>

    <script>
        // --- –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–´ ---
        let currentTeam = null;
        let currentRound = 1;
        let timerInterval = null;

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫–æ–º–∞–Ω–¥—ã
        let teamProgress = {
            "Group 1": { 
                bonusResource: null, 
                filterAssembled: false, 
                antennaAssembled: false, 
                lostResources: 0, 
                routeChosen: false,
                routeResult: null 
            },
            "Group 2": { 
                bonusResource: null, 
                filterAssembled: false, 
                antennaAssembled: false, 
                lostResources: 0, 
                routeChosen: false,
                routeResult: null 
            },
            "Group 3": { 
                bonusResource: null, 
                filterAssembled: false, 
                antennaAssembled: false, 
                lostResources: 0, 
                routeChosen: false,
                routeResult: null 
            }
        };

        // --- –î–ê–ù–ù–´–ï –ò–ì–†–´ (–û–ë–ù–û–í–õ–ï–ù–ù–´–ô –†–ê–£–ù–î 4) ---
        const gameData = {
            "Group 1": {
                name: "–ì–†–£–ü–ü–ê 1: –°–ï–ö–¶–ò–Ø –ê–õ–¨–§–ê",
                1: { // –°–ë–û–† –†–ï–°–£–†–°–û–í
                    objective: "–°–ë–û–† –†–ï–°–£–†–°–û–í. –õ–æ–∫–∞—Ü–∏—è: –ö—É—Ö–Ω—è. –¶–µ–ª—å: –í—ã–±—Ä–∞—Ç—å –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –±–æ–Ω—É—Å–Ω—ã–π —Ä–µ—Å—É—Ä—Å (1 –∏–∑ 3).",
                    choices: ["üí° –û—Å—Ç—Ä—ã–π –Ω–æ–∂ (–¥–ª—è –∑–∞—â–∏—Ç—ã)", "ü•´ –î–æ–ø. —Å—É—Ö–ø–∞–π (–¥–ª—è —ç–Ω–µ—Ä–≥–∏–∏)", "üõ†Ô∏è –ù–∞–±–æ—Ä –æ—Ç–≤–µ—Ä—Ç–æ–∫ (–¥–ª—è —Ä–µ–º–æ–Ω—Ç–∞)"],
                    base_cards: ["üíß –í–æ–¥–∞ (10–ª)", "üíä –û–±–µ–∑–±–æ–ª–∏–≤–∞—é—â–µ–µ"],
                    next_round_btn: "–ü–ï–†–ï–ô–¢–ò –ö –†–ê–£–ù–î–£ 2"
                },
                2: { // –§–ò–õ–¨–¢–†
                    objective: "–°–ë–û–† –§–ò–õ–¨–¢–†–ê. –¶–µ–ª—å: –ü–æ–ª—É—á–∏—Ç—å –í–ï–†–•–ù–Æ–Æ —á–∞—Å—Ç—å —Å—Ö–µ–º—ã —Ñ–∏–ª—å—Ç—Ä–∞ (üî∫).",
                    puzzle_text: "–ó–ê–ì–ê–î–ö–ê: –ß—Ç–æ –≤—Å–µ–≥–¥–∞ —Ç–µ—á–µ—Ç, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–≤–∏–∂–µ—Ç—Å—è —Å –º–µ—Å—Ç–∞? (–û—Ç–≤–µ—Ç 4 –±—É–∫–≤—ã)",
                    answer: "–í–û–î–ê",
                    part: "üîπ –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å —Å—Ö–µ–º—ã —Ñ–∏–ª—å—Ç—Ä–∞ (üî∫)",
                    base_cards: ["üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–±–æ—Ä–∫–µ"],
                    next_round_btn: "–ü–ï–†–ï–ô–¢–ò –ö –†–ê–£–ù–î–£ 3"
                },
                3: { // –°–í–Ø–ó–¨
                    objective: "–°–ë–û–† –°–í–Ø–ó–ò. –¶–µ–ª—å: –°–æ–±—Ä–∞—Ç—å –ê–ù–¢–ï–ù–ù–£ üì°.",
                    puzzle_text: "–†–ï–ë–£–°: –ù—É–∂–Ω–æ —Å–ª–æ–≤–æ '–°–í–Ø–ó–¨'. –í–≤–µ–¥–∏—Ç–µ —Å–∏–Ω–æ–Ω–∏–º –∫ —Å–ª–æ–≤—É '–°–û–û–ë–©–ï–ù–ò–ï'. (–û—Ç–≤–µ—Ç 5 –±—É–∫–≤)",
                    answer: "–°–ò–ì–ù–ê–õ",
                    part: "üì° –ê–Ω—Ç–µ–Ω–Ω–∞ –¥–ª—è —Å–≤—è–∑–∏",
                    base_cards: ["üéõÔ∏è –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è", "üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–ì—Ä. 1)"],
                    next_round_btn: "–ü–ï–†–ï–ô–¢–ò –ö –†–ê–£–ù–î–£ 4"
                },
                4: { // –í–´–•–û–î –ù–ê –ü–û–í–ï–†–•–ù–û–°–¢–¨
                    objective: "–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –í–´–•–û–î. –ê–Ω–∞–ª–∏–∑: –í–∞—à–∏ –∑–∞–ø–∞—Å—ã –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–≤—è–∑–∏ (–†–∞—É–Ω–¥ 3). –í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç.",
                    routes: [
                        { name: "–ú–ê–†–®–†–£–¢ –ê: –ö–æ—Ä–æ—Ç–∫–∏–π –∏ –û–ø–∞—Å–Ω—ã–π ‚ö°", risk: 2, reward: "–ë—ã—Å—Ç—Ä—ã–π –≤—ã—Ö–æ–¥ (+5 –º–∏–Ω –≤ –†–∞—É–Ω–¥–µ 5)" },
                        { name: "–ú–ê–†–®–†–£–¢ –ë: –î–ª–∏–Ω–Ω—ã–π –∏ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π üõ°Ô∏è", risk: 0, reward: "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (-10 –º–∏–Ω –≤ –†–∞—É–Ω–¥–µ 5)" }
                    ],
                    next_round_btn: "–ü–ï–†–ï–ô–¢–ò –ö –§–ò–ù–ê–õ–£"
                },
                5: { objective: "–§–ò–ù–ê–õ: –°–¢–†–ê–¢–ï–ì–ò–Ø –°–ü–ê–°–ï–ù–ò–Ø", base_cards: ["ü§ù –û–±—ä–µ–¥–∏–Ω–∏—Ç—å—Å—è", "üèÉ‚Äç‚ôÇÔ∏è –ò–¥—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω–æ"], next_round_btn: "–ó–ê–í–ï–†–®–ò–¢–¨" }
            },
            "Group 2": {
                name: "–ì–†–£–ü–ü–ê 2: –°–ï–ö–¶–ò–Ø –ë–ï–¢–ê",
                1: { 
                    objective: "–°–ë–û–† –†–ï–°–£–†–°–û–í. –õ–æ–∫–∞—Ü–∏—è: –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è. –¶–µ–ª—å: –í—ã–±—Ä–∞—Ç—å –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –±–æ–Ω—É—Å–Ω—ã–π —Ä–µ—Å—É—Ä—Å (1 –∏–∑ 3).",
                    choices: ["üõ†Ô∏è –ú–æ—â–Ω–∞—è –¥—Ä–µ–ª—å (–¥–ª—è –ø—Ä–æ—Ö–æ–¥–∞)", "üîã –î–æ–ø. –±–∞—Ç–∞—Ä–µ—è (–¥–ª—è –ø–∏—Ç–∞–Ω–∏—è)", "üêü –°–µ—Ç–∫–∞ –¥–ª—è —Ä—ã–±—ã (–¥–ª—è –ø—Ä–æ–ø–∏—Ç–∞–Ω–∏—è)"],
                    base_cards: ["üíß –í–æ–¥–∞ (10–ª)", "üîå –ü—Ä–æ–≤–æ–¥–∞"],
                    next_round_btn: "–ü–ï–†–ï–ô–¢–ò –ö –†–ê–£–ù–î–£ 2"
                },
                2: { 
                    objective: "–°–ë–û–† –§–ò–õ–¨–¢–†–ê. –¶–µ–ª—å: –ü–æ–ª—É—á–∏—Ç—å –°–†–ï–î–ù–Æ–Æ —á–∞—Å—Ç—å —Å—Ö–µ–º—ã —Ñ–∏–ª—å—Ç—Ä–∞ (üü¶).",
                    puzzle_text: "–ó–ê–î–ê–ß–ö–ê: –°–∫–æ–ª—å–∫–æ –ª–∏—Ç—Ä–æ–≤ –≤ –æ–¥–Ω–æ–º –∫—É–±–∏—á–µ—Å–∫–æ–º –º–µ—Ç—Ä–µ? (–û—Ç–≤–µ—Ç —Ü–∏—Ñ—Ä–∞–º–∏)",
                    answer: "1000",
                    part: "üîπ –°—Ä–µ–¥–Ω—è—è —á–∞—Å—Ç—å —Å—Ö–µ–º—ã —Ñ–∏–ª—å—Ç—Ä–∞ (üü¶)",
                    base_cards: ["üìù –°—Ö–µ–º–∞ –Ω–∞—Å–æ—Å–∞"],
                    next_round_btn: "–ü–ï–†–ï–ô–¢–ò –ö –†–ê–£–ù–î–£ 3"
                },
                3: { 
                    objective: "–°–ë–û–† –°–í–Ø–ó–ò. –¶–µ–ª—å: –°–æ–±—Ä–∞—Ç—å –ö–ê–ë–ï–õ–¨ –ü–ò–¢–ê–ù–ò–Ø üîå.",
                    puzzle_text: "–†–ï–ë–£–°: –ö —Å–ª–æ–≤—É '–¢–û–ö' –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–æ–≤–æ '–ï–°–¢–¨'. –í–≤–µ–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–û—Ç–≤–µ—Ç 6 –±—É–∫–≤)",
                    answer: "–ö–ê–ë–ï–õ–¨",
                    part: "üîå –ö–∞–±–µ–ª—å –ø–∏—Ç–∞–Ω–∏—è",
                    base_cards: ["‚öôÔ∏è –ú–µ—Ö–∞–Ω–∏–∑–º –Ω–∞—Ç—è–∂–µ–Ω–∏—è", "üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–ì—Ä. 2)"],
                    next_round_btn: "–ü–ï–†–ï–ô–¢–ò –ö –†–ê–£–ù–î–£ 4"
                },
                4: { // –í–´–•–û–î –ù–ê –ü–û–í–ï–†–•–ù–û–°–¢–¨
                    objective: "–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –í–´–•–û–î. –ê–Ω–∞–ª–∏–∑: –í–∞—à–∏ –∑–∞–ø–∞—Å—ã –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–≤—è–∑–∏ (–†–∞—É–Ω–¥ 3). –í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç.",
                    routes: [
                        { name: "–ú–ê–†–®–†–£–¢ –ë: –î–ª–∏–Ω–Ω—ã–π –∏ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π üõ°Ô∏è", risk: 0, reward: "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (+10 –º–∏–Ω –≤ –†–∞—É–Ω–¥–µ 5)" },
                        { name: "–ú–ê–†–®–†–£–¢ –í: –°—Ä–µ–¥–Ω–∏–π, —Å –æ–±–≤–∞–ª–æ–º üöß", risk: 1, reward: "–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥" }
                    ],
                    next_round_btn: "–ü–ï–†–ï–ô–¢–ò –ö –§–ò–ù–ê–õ–£"
                },
                5: { objective: "–§–ò–ù–ê–õ: –°–¢–†–ê–¢–ï–ì–ò–Ø –°–ü–ê–°–ï–ù–ò–Ø", base_cards: ["ü§ù –û–±—ä–µ–¥–∏–Ω–∏—Ç—å—Å—è", "üèÉ‚Äç‚ôÄÔ∏è –ò–¥—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω–æ"], next_round_btn: "–ó–ê–í–ï–†–®–ò–¢–¨" }
            },
            "Group 3": {
                name: "–ì–†–£–ü–ü–ê 3: –°–ï–ö–¶–ò–Ø –ì–ê–ú–ú–ê",
                1: { 
                    objective: "–°–ë–û–† –†–ï–°–£–†–°–û–í. –õ–æ–∫–∞—Ü–∏—è: –°–∫–ª–∞–¥. –¶–µ–ª—å: –í—ã–±—Ä–∞—Ç—å –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –±–æ–Ω—É—Å–Ω—ã–π —Ä–µ—Å—É—Ä—Å (1 –∏–∑ 3).",
                    choices: ["üíä –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–ø—Ç–µ—á–∫–∞ (–¥–ª—è –ø–µ—Ä–≤–æ–π –ø–æ–º–æ—â–∏)", "üî• –ó–∞–ø–∞—Å —Ç–æ–ø–ª–∏–≤–∞ (–¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞)", "üó∫Ô∏è –ö–∞—Ä—Ç–∞ –º–µ—Å—Ç–Ω–æ—Å—Ç–∏ (–¥–ª—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏)"],
                    base_cards: ["üíß –í–æ–¥–∞ (10–ª)", "ü•´ –ï–¥–∞ (—Å—É—Ö–ø–∞–π)"],
                    next_round_btn: "–ü–ï–†–ï–ô–¢–ò –ö –†–ê–£–ù–î–£ 2"
                },
                2: { 
                    objective: "–°–ë–û–† –§–ò–õ–¨–¢–†–ê. –¶–µ–ª—å: –ü–æ–ª—É—á–∏—Ç—å –ù–ò–ñ–ù–Æ–Æ —á–∞—Å—Ç—å —Å—Ö–µ–º—ã —Ñ–∏–ª—å—Ç—Ä–∞ (üîª).",
                    puzzle_text: "–ó–ê–ì–ê–î–ö–ê: '–Ø –Ω–µ –∂–∏–≤—É, –Ω–æ —Ä–∞—Å—Ç—É. –£ –º–µ–Ω—è –Ω–µ—Ç –ª–µ–≥–∫–∏—Ö, –Ω–æ –º–Ω–µ –Ω—É–∂–µ–Ω –≤–æ–∑–¥—É—Ö'. (–û—Ç–≤–µ—Ç 6 –±—É–∫–≤)",
                    answer: "–û–ì–û–ù–¨",
                    part: "üîπ –ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å —Å—Ö–µ–º—ã —Ñ–∏–ª—å—Ç—Ä–∞ (üîª)",
                    base_cards: ["üìù –°—Ö–µ–º–∞ —Ç—Ä—É–±–æ–ø—Ä–æ–≤–æ–¥–∞"],
                    next_round_btn: "–ü–ï–†–ï–ô–¢–ò –ö –†–ê–£–ù–î–£ 3"
                },
                3: { 
                    objective: "–°–ë–û–† –°–í–Ø–ó–ò. –¶–µ–ª—å: –°–æ–±—Ä–∞—Ç—å –†–ï–ó–ï–†–í–ù–û–ï –ü–ò–¢–ê–ù–ò–ï üîã.",
                    puzzle_text: "–†–ï–ë–£–°: –ö —Å–ª–æ–≤—É '–≠–ù–ï–†–ì–ò–Ø' –ø–æ–¥–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–æ, –æ–±–æ–∑–Ω–∞—á–∞—é—â–µ–µ '–ó–ê–ü–ê–°'. (–û—Ç–≤–µ—Ç 7 –±—É–∫–≤)",
                    answer: "–†–ï–ó–ï–†–í",
                    part: "üîã –†–µ–∑–µ—Ä–≤–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ",
                    base_cards: ["üíæ –ú–∏–∫—Ä–æ—Å—Ö–µ–º–∞", "üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–ì—Ä. 3)"],
                    next_round_btn: "–ü–ï–†–ï–ô–¢–ò –ö –†–ê–£–ù–î–£ 4"
                },
                4: { // –í–´–•–û–î –ù–ê –ü–û–í–ï–†–•–ù–û–°–¢–¨
                    objective: "–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –í–´–•–û–î. –ê–Ω–∞–ª–∏–∑: –í–∞—à–∏ –∑–∞–ø–∞—Å—ã –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–≤—è–∑–∏ (–†–∞—É–Ω–¥ 3). –í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç.",
                    routes: [
                        { name: "–ú–ê–†–®–†–£–¢ –ê: –ö–æ—Ä–æ—Ç–∫–∏–π –∏ –û–ø–∞—Å–Ω—ã–π ‚ö°", risk: 2, reward: "–ë—ã—Å—Ç—Ä—ã–π –≤—ã—Ö–æ–¥ (-10 –º–∏–Ω –≤ –†–∞—É–Ω–¥–µ 5)" },
                        { name: "–ú–ê–†–®–†–£–¢ –í: –°—Ä–µ–¥–Ω–∏–π, —Å –æ–±–≤–∞–ª–æ–º üöß", risk: 1, reward: "–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥" }
                    ],
                    next_round_btn: "–ü–ï–†–ï–ô–¢–ò –ö –§–ò–ù–ê–õ–£"
                },
                5: { objective: "–§–ò–ù–ê–õ: –°–¢–†–ê–¢–ï–ì–ò–Ø –°–ü–ê–°–ï–ù–ò–Ø", base_cards: ["ü§ù –û–±—ä–µ–¥–∏–Ω–∏—Ç—å—Å—è", "üèÉ‚Äç‚ôÇÔ∏è –ò–¥—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω–æ"], next_round_btn: "–ó–ê–í–ï–†–®–ò–¢–¨" }
            }
        };

        // --- –§–£–ù–ö–¶–ò–ò –ò–ì–†–´ ---

        function selectTeam(teamId) {
            currentTeam = teamId;
            document.getElementById('team-select').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            document.getElementById('team-display').textContent = `[ –°–í–Ø–ó–¨ –£–°–¢–ê–ù–û–í–õ–ï–ù–ê: ${gameData[teamId].name} ]`;
            showRound(1); 
        }

        function startTimer(durationInSeconds) {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            let timer = durationInSeconds;
            const display = document.getElementById('time-left');
            const timerDiv = document.getElementById('timer-display');
            
            timerInterval = setInterval(function () {
                let minutes = parseInt(timer / 60, 10);
                let seconds = parseInt(timer % 60, 10);
                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;
                display.textContent = minutes + ":" + seconds;

                if (--timer < 0) {
                    clearInterval(timerInterval);
                    display.textContent = "–í–†–ï–ú–Ø –ò–°–¢–ï–ö–õ–û! üíÄ";
                    timerDiv.style.color = '#ff004c'; 
                } else if (timer <= 60 && timer > 0) {
                     timerDiv.style.color = '#ffcc00'; 
                } else {
                     timerDiv.style.color = '#00ffcc';
                }
            }, 1000);
        }
        
        // --- –§–£–ù–ö–¶–ò–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –ö–û–ù–¢–ï–ù–¢–ê –†–ê–£–ù–î–ê ---
        function showRound(roundNum) {
            if (!currentTeam || !gameData[currentTeam]) return; 

            currentRound = roundNum; 
            
            // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞. –†–∞—É–Ω–¥ 1 –∏ 4 - 5 –º–∏–Ω—É—Ç (300 —Å–µ–∫), –æ—Å—Ç–∞–ª—å–Ω—ã–µ - 10 –º–∏–Ω—É—Ç (600 —Å–µ–∫)
            const duration = (roundNum === 1 || roundNum === 4) ? 300 : 600;
            startTimer(duration); 

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.round-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.round-btn[data-round="${roundNum}"]`).classList.add('active');

            const data = gameData[currentTeam][roundNum];
            const progress = teamProgress[currentTeam];
            const contentDiv = document.getElementById('round-content');
            
            let html = `
                <h3 style="color:#ffcc00;">[ –¶–ï–õ–¨ –†–ê–£–ù–î–ê ${roundNum} ]</h3>
                
                <div class="round-objective">
                    ${data.objective}
                </div>
            `;

            // --- –†–ê–£–ù–î 1: –í–´–ë–û–† –†–ï–°–£–†–°–ê ---
            if (roundNum === 1) {
                html += '<h4 style="color:#00ffcc;">‚úÖ –í–´–ë–û–† –ë–û–ù–£–°–ù–û–ì–û –†–ï–°–£–†–°–ê:</h4>';
                if (progress.bonusResource) {
                    html += `<p class='success' style="text-align: center;">–ë–û–ù–£–°–ù–´–ô –†–ï–°–£–†–° –í–ó–Ø–¢: **${progress.bonusResource}**</p>`;
                } else {
                    html += '<div style="text-align: center;">';
                    data.choices.forEach(choice => {
                        html += `<button class="choice-btn" onclick="selectResource('${choice}')">${choice}</button>`;
                    });
                    html += `</div>`;
                }
            }

            // --- –†–ê–£–ù–î 2 & 3: –°–ë–û–† –ß–ê–°–¢–ò (–†–µ—à–µ–Ω–∏–µ –∑–∞–≥–∞–¥–∫–∏) ---
            if (roundNum === 2 || roundNum === 3) {
                const isAssembled = roundNum === 2 ? progress.filterAssembled : progress.antennaAssembled;
                
                html += `<h4 style="color:#ffcc00;">üîë –ò–°–ü–´–¢–ê–ù–ò–ï –ù–ê –°–ë–û–†–ö–£: ${data.puzzle_text}</h4>`;
                
                if (isAssembled) {
                    html += `<p class='success' style="text-align: center;">‚úÖ **${data.part}** –°–û–ë–†–ê–ù–ê.</p>`;
                } else {
                     html += `
                        <div class="input-area" style="text-align: center; margin-top: 15px;">
                            <strong>–í–í–ï–î–ò–¢–ï –ö–õ–Æ–ß–ï–í–û–ï –°–õ–û–í–û:</strong>
                            <input type="text" id="puzzle-input" placeholder="–û—Ç–≤–µ—Ç">
                            <button class="btn" onclick="checkPuzzleAnswer(${roundNum}, '${data.answer}', '${data.part}')">–ü–†–û–í–ï–†–ò–¢–¨ –ò –°–û–ë–†–ê–¢–¨</button>
                            <p id="puzzle-feedback" style="margin-top: 10px;"></p>
                        </div>
                    `;
                }
            }
            
            // --- –†–ê–£–ù–î 4: –í–´–ë–û–† –ú–ê–†–®–†–£–¢–ê ---
            if (roundNum === 4) {
                if (progress.routeChosen) {
                     html += `<p class='success' style="text-align: center;">‚úÖ –†–ï–®–ï–ù–ò–ï –ü–†–ò–ù–Ø–¢–û: **${progress.routeResult}**</p>`;
                } else {
                    const status = progress.antennaAssembled ? 'üü¢ –°–í–Ø–ó–¨ –£–°–¢–ê–ù–û–í–õ–ï–ù–ê (–®–∞–Ω—Å –Ω–∞ —É—Å–ø–µ—Ö –≤—ã—à–µ).' : 'üî¥ –°–í–Ø–ó–¨ –ü–û–¢–ï–†–Ø–ù–ê (–†–∏—Å–∫ –≤—ã—à–µ).';
                    
                    html += `<h4 style="color:#ffcc00;">üì° –°–¢–ê–¢–£–° –°–í–Ø–ó–ò: ${status}</h4>`;
                    html += '<h4 style="color:#00ffcc;">üó∫Ô∏è –í–´–ë–ï–†–ò–¢–ï –ú–ê–†–®–†–£–¢:</h4>';
                    html += '<div style="text-align: center;">';
                    
                    data.routes.forEach((route, index) => {
                         html += `<button class="choice-btn" onclick="selectRoute('${route.name}', ${route.risk})">${route.name} (${route.reward})</button>`;
                    });
                    html += '</div>';
                }
            }


            // --- –ö–ê–†–¢–û–ß–ö–ò –ò –ö–ù–û–ü–ö–ê –ü–ï–†–ï–•–û–î–ê ---

            let currentCards = [...data.base_cards];
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–±—Ä–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–∏ –≤ —Å–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫
            if (progress.bonusResource && roundNum !== 1) { currentCards.push(`‚≠ê –ë–æ–Ω—É—Å: ${progress.bonusResource}`); }
            if (progress.filterAssembled) { currentCards.push(gameData[currentTeam][2].part); }
            if (progress.antennaAssembled) { currentCards.push(gameData[currentTeam][3].part); }
            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è 4 —Ä–∞—É–Ω–¥–∞
            if (progress.routeResult && roundNum !== 4) { currentCards.push(`üó∫Ô∏è –ú–∞—Ä—à—Ä—É—Ç: ${progress.routeResult} (–ü–æ—Ç–µ—Ä—è–Ω–æ: ${progress.lostResources} üíß/ü•´)`); }

            html += `
                <h4 style="color:#00ffcc; margin-top: 30px;">üì¶ –í–ê–®–ò –ö–ê–†–¢–û–ß–ö–ò:</h4>
                <ul class="card-list">
            `;
            currentCards.forEach((card) => {
                html += `<li>${card}</li>`;
            });
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Ç–µ—Ä—è—Ö
            if (progress.lostResources > 0) {
                 html += `<li><span class="warning">‚ùå –ü–û–¢–ï–†–Ø–ù–û: ${progress.lostResources} –µ–¥–∏–Ω–∏—Ü —Ä–µ—Å—É—Ä—Å–æ–≤ –∏–∑-–∑–∞ –º–∞—Ä—à—Ä—É—Ç–∞.</span></li>`;
            }

            html += `</ul>`;
            
            // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞
            if (roundNum < 5) {
                // –£—Å–ª–æ–≤–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–Ω–æ–ø–∫–∏
                let isBlocked = false;
                if (roundNum === 1 && !progress.bonusResource) { isBlocked = true; }
                if (roundNum === 2 && !progress.filterAssembled) { isBlocked = true; }
                if (roundNum === 3 && !progress.antennaAssembled) { isBlocked = true; }
                if (roundNum === 4 && !progress.routeChosen) { isBlocked = true; }


                if (isBlocked) {
                    let message = '';
                    if (roundNum === 1) message = '*–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –±–æ–Ω—É—Å–Ω—ã–π —Ä–µ—Å—É—Ä—Å.*';
                    if (roundNum === 2) message = `*–°–Ω–∞—á–∞–ª–∞ —Å–æ–±–µ—Ä–∏—Ç–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é —á–∞—Å—Ç—å (–§–∏–ª—å—Ç—Ä).*`;
                    if (roundNum === 3) message = `*–°–Ω–∞—á–∞–ª–∞ —Å–æ–±–µ—Ä–∏—Ç–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é —á–∞—Å—Ç—å (–°–≤—è–∑—å).*`;
                    if (roundNum === 4) message = `*–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç.*`;

                    html += `<p class="warning" style="text-align: center;">${message}</p>`;
                } else {
                    html += `
                        <div style="text-align: center; margin-top: 30px;">
                            <button class="btn" onclick="nextRound()">
                                ${data.next_round_btn} (${roundNum + 1})
                            </button>
                        </div>
                    `;
                }
            } else {
                 html += `
                    <div style="text-align: center; margin-top: 30px;">
                         <p class="warning">–§–ò–ù–ê–õ! –ò–ì–†–ê –ó–ê–í–ï–†–®–ï–ù–ê. **${data.base_cards[0].includes('–û–±—ä–µ–¥–∏–Ω–∏—Ç—å—Å—è') ? '–û–ë–™–ï–î–ò–ù–ï–ù–ò–ï' : '–ê–í–¢–û–ù–û–ú–ù–´–ô –í–´–•–û–î'}**.</p>
                    </div>
                `;
                 clearInterval(timerInterval);
            }
            
            contentDiv.innerHTML = html;
        }

        // --- –§–£–ù–ö–¶–ò–ò –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ê ---

        // –†–ê–£–ù–î 1: –í—ã–±–æ—Ä —Ä–µ—Å—É—Ä—Å–∞
        function selectResource(choice) {
            if (!currentTeam || teamProgress[currentTeam].bonusResource) return;
            
            teamProgress[currentTeam].bonusResource = choice;
            alert(`‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: ${choice}. –†–µ—Å—É—Ä—Å –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≤–∞—à –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å!`);
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ—Ö–æ–¥–∞
            showRound(1); 
        }

        // –†–ê–£–ù–î 2 & 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ –∏ —Å–±–æ—Ä —á–∞—Å—Ç–∏
        function checkPuzzleAnswer(roundNum, correctAnswer, partName) {
            const input = document.getElementById('puzzle-input');
            const feedback = document.getElementById('puzzle-feedback');
            const userInput = (input.value || '').trim().toUpperCase();
            const correct = correctAnswer.toUpperCase();
            
            if (userInput === correct) {
                if (roundNum === 2) {
                    teamProgress[currentTeam].filterAssembled = true;
                } else if (roundNum === 3) {
                    teamProgress[currentTeam].antennaAssembled = true;
                }
                clearInterval(timerInterval);
                feedback.innerHTML = `<span class="success">‚úÖ –ö–û–î –ü–†–ò–ù–Ø–¢. **${partName}** –°–û–ë–†–ê–ù–ê.</span>`;
                alert(`–£–°–ü–ï–•! –ß–∞—Å—Ç—å —Å–æ–±—Ä–∞–Ω–∞. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É.`);

                showRound(roundNum); 
            } else {
                feedback.innerHTML = '<span class="warning">‚ùå –û–®–ò–ë–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –≤–≤–æ–¥.</span>';
                input.value = ''; 
            }
        }
        
        // --- –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –†–ê–£–ù–î 4 - –í—ã–±–æ—Ä –º–∞—Ä—à—Ä—É—Ç–∞ ---
        function selectRoute(routeName, baseRisk) {
            if (teamProgress[currentTeam].routeChosen) return;

            const progress = teamProgress[currentTeam];
            let finalRisk = baseRisk;
            let resultMessage = `–í—ã –≤—ã–±—Ä–∞–ª–∏ **${routeName}**.`;

            // –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∏—Å–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –°–í–Ø–ó–ò (–†–∞—É–Ω–¥ 3)
            if (!progress.antennaAssembled && baseRisk > 0) {
                // –ï—Å–ª–∏ –Ω–µ—Ç —Å–≤—è–∑–∏, —Ä–∏—Å–∫ –æ–ø–∞—Å–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞ —É–¥–≤–∞–∏–≤–∞–µ—Ç—Å—è
                finalRisk += baseRisk; 
                resultMessage += " **(‚ö†Ô∏è –°–í–Ø–ó–¨ –ü–û–¢–ï–†–Ø–ù–ê: –†–∏—Å–∫ —É–¥–≤–æ–µ–Ω!)**";
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Ç–µ—Ä–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
            if (finalRisk > 0) {
                // –®–∞–Ω—Å –ø–æ—Ç–µ—Ä–∏ —Ä–µ—Å—É—Ä—Å–∞ (1 –µ–¥–∏–Ω–∏—Ü–∞ –∑–∞ 1 —Ä–∏—Å–∫)
                const lostCount = Math.floor(Math.random() * (finalRisk + 1)); 
                progress.lostResources = lostCount;
                
                if (lostCount > 0) {
                    resultMessage += ` –í –ø—É—Ç–∏ –∏–∑-–∑–∞ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏/–ø–æ–º–µ—Ö –≤—ã **–ø–æ—Ç–µ—Ä—è–ª–∏ ${lostCount} –µ–¥–∏–Ω–∏—Ü** —Ä–µ—Å—É—Ä—Å–æ–≤ (–í–æ–¥–∞/–ï–¥–∞).`;
                } else {
                    resultMessage += " –í—ã –ø—Ä–æ—à–ª–∏ **–±–µ–∑ –ø–æ—Ç–µ—Ä—å**, –Ω–æ —Ä–∏—Å–∫ –±—ã–ª –≤—ã—Å–æ–∫.";
                }
            } else {
                resultMessage += " –ú–∞—Ä—à—Ä—É—Ç –æ–∫–∞–∑–∞–ª—Å—è **–ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑–æ–ø–∞—Å–Ω—ã–º**, –ø–æ—Ç–µ—Ä—å –Ω–µ—Ç.";
            }

            progress.routeChosen = true;
            progress.routeResult = routeName;
            
            alert(`‚úÖ –†–ï–®–ï–ù–ò–ï –ü–†–ò–ù–Ø–¢–û. ${resultMessage}`);
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ—Ö–æ–¥–∞
            showRound(4);
        }

        // –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–ï–†–ï–•–û–î–ê –ù–ê –°–õ–ï–î–£–Æ–©–ò–ô –†–ê–£–ù–î
        function nextRound() {
            if (currentRound < 5) {
                showRound(currentRound + 1);
            }
        }
    </script>
</body>
</html>
