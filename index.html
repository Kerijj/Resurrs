<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞—Ä—Å–∏–∞–Ω–∏–Ω: –≠–∫–æ–Ω–æ–º–∏–∫–∞ –í—ã–∂–∏–≤–∞–Ω–∏—è (–ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π –†–µ–∂–∏–º)</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
        body { 
            font-family: 'Roboto', sans-serif; 
            background: #000c19; 
            color: #d8e2f0; 
            padding: 25px; 
            line-height: 1.6;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 35px; 
            background: #0f1c2c; 
            border-radius: 18px; 
            border: 3px solid #e74c3c; 
            box-shadow: 0 10px 40px rgba(231, 76, 60, 0.3); 
        }
        h1 { color: #f1c40f; margin-top: 0; text-align: center; text-shadow: 0 0 5px rgba(241, 196, 15, 0.5); }
        h2 { color: #3498db; border-bottom: 2px solid #3e4451; padding-bottom: 15px; margin-top: 30px; }
        h3 { color: #e74c3c; }
        .intro, .round-content, #communication-panel { 
            margin-bottom: 25px; 
            padding: 25px; 
            border: 1px solid #3e4451; 
            border-radius: 12px; 
            background: #1e2127; 
        }
        
        /* –î–∏—Å–ø–ª–µ–π —Ä–µ—Å—É—Ä—Å–æ–≤ */
        .resources-display { 
            background: #282c34; 
            padding: 20px; 
            border-radius: 12px; 
            margin-top: 25px; 
            display: flex; 
            justify-content: space-between;
            align-items: center;
        }
        .status-info { flex: 1; margin-right: 30px;}
        .hp-bar { color: #e74c3c; font-weight: bold; font-size: 1.3em; }
        .actions-count { color: #f1c40f; font-weight: bold; font-size: 1.3em; }

        /* –ñ—É—Ä–Ω–∞–ª –∏ –∫–Ω–æ–ø–∫–∏ */
        .log-box { 
            margin-top: 20px; 
            background: #0f1c2c; 
            padding: 15px; 
            height: 180px; 
            overflow-y: scroll; 
            border-radius: 10px; 
            font-size: 0.9em; 
            border: 1px solid #3e4451;
        }
        button { 
            padding: 12px 20px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 6px; 
            font-weight: bold; 
            background: #3498db; 
            color: white; 
            transition: background 0.2s, opacity 0.2s; 
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
        }
        button:hover:not(:disabled) { background: #2980b9; }
        button:disabled { background: #555; cursor: not-allowed; opacity: 0.6; }

        /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
        .inventory-list { 
            list-style-type: none; 
            padding: 0; 
            display: flex; 
            flex-wrap: wrap; 
            gap: 15px;
        }
        .inventory-item { 
            padding: 10px 15px; 
            border-radius: 8px; 
            background: #1e2127;
            border: 1px solid #4b5263;
        }
        /* –§–æ—Ä–º—ã –∑–∞–¥–∞–Ω–∏–π */
        .task-form { 
            background: #282c34; 
            padding: 15px; 
            border-radius: 8px; 
            margin-top: 15px;
        }
        .task-form input, .trade-console input { 
            padding: 10px; 
            border-radius: 6px; 
            border: 1px solid #3498db; 
            background: #0f1c2c; 
            color: #d8e2f0; 
            margin-right: 10px; 
            width: 30%;
        }
        .trade-console {
            margin-top: 15px;
            padding: 15px;
            background: #3e4451;
            border-radius: 8px;
        }
        .craft-panel {
            margin-top: 15px;
            padding: 15px;
            background: #282c34;
            border-radius: 8px;
            border-left: 5px solid #2ecc71;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>üöÄ –ú–ê–†–°–ò–ê–ù–ò–ù: –≠–ö–û–ù–û–ú–ò–ö–ê –í–´–ñ–ò–í–ê–ù–ò–Ø</h1>
        <div id="game-area">
            
            <div class="intro" id="intro-screen">
                <h2>–í—ã–±–æ—Ä –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</h2>
                <p>–í–∞—à–∞ –≥—Ä—É–ø–ø–∞ - –ø–æ—Å–ª–µ–¥–Ω—è—è –Ω–∞–¥–µ–∂–¥–∞. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –∏ –±–æ–Ω—É—Å—ã.</p>
                
                <div class="group-select" style="display: flex; justify-content: space-around; flex-wrap: wrap;">
                    <button onclick="startGame('Technocrats')">üõ†Ô∏è –¢–µ—Ö–Ω–æ–∫—Ä–∞—Ç—ã (–≠–Ω–µ—Ä–≥–∏—è –∏ –õ–æ–≥–∏—Å—Ç–∏–∫–∞)</button>
                    <button onclick="startGame('Bioengineers')">üß™ –ë–∏–æ–∏–Ω–∂–µ–Ω–µ—Ä—ã (–í–æ–¥–∞ –∏ –ü–∏—â–∞)</button>
                    <button onclick="startGame('Constructors')">üß± –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã (–ñ–∏–ª—å–µ –∏ –ó–∞—â–∏—Ç–∞)</button>
                </div>
            </div>

            <div id="game-round" style="display:none;">
                <h2 class="current-round-title" id="round-title"></h2>
                
                <div class="round-content" id="round-description"></div>

                <div class="resources-display">
                    <div class="status-info">
                        <h3>–ì—Ä—É–ø–ø–∞: <span id="player-group-name"></span></h3>
                        <p>–ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ (HP): <span id="res-hp" class="hp-bar"></span></p>
                        <p>–î–µ–π—Å—Ç–≤–∏–π –æ—Å—Ç–∞–ª–æ—Å—å: <span id="actions-remaining" class="actions-count"></span> / 3</p>
                        <p id="group-status"></p>
                    </div>
                    <ul class="inventory-list" id="inventory-list-display"></ul>
                </div>
                
                <div id="craft-area" class="craft-panel" style="display: none;">
                    <h3>üõ†Ô∏è –°–±–æ—Ä–∫–∞ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–ö—Ä–∞—Ñ—Ç)</h3>
                    <p>–¢—Ä–µ–±—É–µ—Ç—Å—è 1 –¥–µ–π—Å—Ç–≤–∏–µ, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–∞—É–Ω–¥–∞, –∫—Ä–æ–º–µ –†–∞—É–Ω–¥–∞ 1.</p>
                    <button onclick="craftComponent('P')">–ö—Ä–∞—Ñ—Ç P (–ü–æ–ª–∏–≤: 8T + 5W + 3K)</button>
                    <button onclick="craftComponent('G')">–ö—Ä–∞—Ñ—Ç G (–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä: 8E + 5M + 3K)</button>
                    <button onclick="craftComponent('C')">–ö—Ä–∞—Ñ—Ç C (–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: 8M + 5E + 3T)</button>
                </div>

                <div class="action-area" id="action-area"></div>
                
                <div id="communication-panel" class="intro">
                    <h3>üì¢ –û–±—â–∏–π –∫–∞–Ω–∞–ª —Å–≤—è–∑–∏ (–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —á–∞—Å—Ç—å)</h3>
                    <p id="communication-message">–ö–∞–Ω–∞–ª —á–∏—Å—Ç. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç —Å –¥—Ä—É–≥–∏–º–∏ –≥—Ä—É–ø–ø–∞–º–∏...</p>
                    <button onclick="simulateConversation()" style="background: #e74c3c;">–ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –û–±—â–µ–Ω–∏–µ</button>
                    
                    <div id="trade-console" class="trade-console" style="display:none;">
                        <h4>–°–∏—Å—Ç–µ–º–∞ –æ–±–º–µ–Ω–∞ (–†–∞—É–Ω–¥ 6)</h4>
                        <p style="color: #f1c40f;">**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è "–¢–æ—Ä–≥–æ–≤–æ–≥–æ –†–µ–≥—É–ª—è—Ç–æ—Ä–∞" (–í–µ–¥—É—â–µ–≥–æ):** –í–≤–µ–¥–∏—Ç–µ –∏—Ç–æ–≥ —Å–¥–µ–ª–∫–∏.</p>
                        <input type="text" id="trade-res-code" placeholder="–ö–æ–¥ —Ä–µ—Å—É—Ä—Å–∞ (E, W, T, M, K)">
                        <input type="number" id="trade-amount" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ">
                        <button onclick="processTrade('OTDAT')" style="background: #e74c3c;">–û–¢–î–ê–¢–¨</button>
                        <button onclick="processTrade('POLUCHIT')" style="background: #2ecc71;">–ü–û–õ–£–ß–ò–¢–¨</button>
                    </div>
                </div>

                <div class="log-box">
                    **–ñ—É—Ä–Ω–∞–ª –ë–æ—Ä—Ç–∞**
                    <div id="game-log"></div>
                </div>
                
                <button onclick="checkNextRound()" style="background: #3498db; width: 100%; margin-top: 20px;">–ó–∞–≤–µ—Ä—à–∏—Ç—å –†–∞—É–Ω–¥ (–ü–µ—Ä–µ—Ö–æ–¥)</button>
            </div>
            
            <div id="game-over" style="display:none; text-align: center;">
                 <h2 style="color: #e74c3c;">üî¥ –ú–ò–°–°–ò–Ø –ü–†–û–í–ê–õ–ï–ù–ê</h2>
                 <p id="game-over-message" style="font-size: 1.5em;"></p>
            </div>
        </div>
    </div>

    <script>
        // --- –î–ê–ù–ù–´–ï –ò–ì–†–´ ---
        const RESOURCES = {
            E: { name: '–≠–Ω–µ—Ä–≥–æ—è—á–µ–π–∫–∞', code: 'E', icon: '‚ö°' },
            W: { name: '–í–æ–¥–∞ (–õ)', code: 'W', icon: 'üíß' },
            T: { name: '–ü–æ—á–≤–∞ (–ö–≥)', code: 'T', icon: '‚õ∞Ô∏è' },
            M: { name: '–ú–µ—Ç–∞–ª–ª–æ–ª–æ–º', code: 'M', icon: 'üî©' },
            K: { name: '–ü—Ä–æ–≤–æ–¥–∞/–ö–∞–±.', code: 'K', icon: 'üîó' },
            P: { name: '–ú–∏–∫—Ä–æ-–ü–æ–ª–∏–≤', code: 'P', icon: 'üíßüå±' }, 
            G: { name: '–¢–µ—Ä–º–æ-–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä', code: 'G', icon: '‚òÄÔ∏è' }, 
            C: { name: '–ì–µ—Ä–º–æ-–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä', code: 'C', icon: 'üì¶' }, 
            S: { name: '–ú–∞—è–∫ –°–ø–∞—Å–µ–Ω–∏—è', code: 'S', icon: ' –º–∞—è–∫' },
            HP: { name: '–ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ', code: 'HP', icon: 'üíî' }
        };
        
        const GROUP_BONUSES = {
            Technocrats: 'E', 
            Bioengineers: 'T', 
            Constructors: 'M' 
        };

        const ROUND_TITLES = [
            "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ú–∏—Å—Å–∏–∏",
            "–†–∞—É–Ω–¥ 1: –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –°–±–æ—Ä (–ó–∞–≥–∞–¥–∫–∏)",
            "–†–∞—É–Ω–¥ 2: –°–≤–æ–±–æ–¥–Ω—ã–π –°–±–æ—Ä (–õ–∏–º–∏—Ç –≤–µ—Å–∞)",
            "–†–∞—É–Ω–¥ 3: –û–±—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ñ–∏–∑–Ω–∏ (–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ)",
            "–†–∞—É–Ω–¥ 4: –†–∏—Å–∫ –∏ –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ",
            "–†–∞—É–Ω–¥ 5: –®—Ç–æ—Ä–º –∏ –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ",
            "–†–∞—É–Ω–¥ 6: –§–∏–Ω–∞–ª—å–Ω–∞—è –¢–æ—Ä–≥–æ–≤–ª—è (–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–∞—É–Ω–¥ —Å —Ä–µ–≥—É–ª—è—Ç–æ—Ä–æ–º)",
            "–†–∞—É–Ω–¥ 7: –°–±–æ—Ä–∫–∞ –ú–∞—è–∫–∞ –∏ –§–∏–Ω–∞–ª"
        ];
        
        const CRAFT_COSTS = {
            P: { T: 8, W: 5, K: 3 }, 
            G: { E: 8, M: 5, K: 3 }, 
            C: { M: 8, E: 5, T: 3 }  
        };

        // –ó–∞–¥–∞–Ω–∏—è –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä –Ω–µ –±—É–¥–µ–º)
        const THEMATIC_TASKS = {
            E: { question: "–ö–∞–∫–æ–π –º–µ—Ç–∞–ª–ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–æ–ª–Ω–µ—á–Ω—ã—Ö –ø–∞–Ω–µ–ª—è—Ö –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Å–≤–µ—Ç–∞ –≤ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ?", answer: "–ö–†–ï–ú–ù–ò–ô" },
            W: { question: "–ù–∞–∑–æ–≤–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —É–≥–ª–µ–∫–∏—Å–ª—ã–π –≥–∞–∑ –∏ –≤–æ–¥—É –≤ –≥–ª—é–∫–æ–∑—É –∏ –∫–∏—Å–ª–æ—Ä–æ–¥?", answer: "–§–û–¢–û–°–ò–ù–¢–ï–ó" },
            T: { question: "–ù–∞–∑–æ–≤–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–µ–æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –º–∞—Ä—Å–∏–∞–Ω—Å–∫–æ–π –ø–æ—á–≤—ã, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–¥–∞–µ—Ç –µ–π –∫—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç.", answer: "–û–ö–°–ò–î–ñ–ï–õ–ï–ó–ê" },
            M: { question: "–°–∞–º—ã–π –ø—Ä–æ—á–Ω—ã–π, –Ω–æ –ª–µ–≥–∫–∏–π —Å–ø–ª–∞–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ –∞–≤–∏–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏ –∏ –∫–æ—Å–º–∏—á–µ—Å–∫–∏—Ö –∞–ø–ø–∞—Ä–∞—Ç–∞—Ö.", answer: "–¢–ò–¢–ê–ù" },
            K: { question: "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π —Ç–æ–∫ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–π?", answer: "–ò–ù–í–ï–†–¢–û–†" },
        };

        let gameState = {
            group: null,
            inventory: { E: 3, W: 0, T: 3, M: 3, K: 0, P: 0, G: 0, C: 0, S: 0, HP: 15 }, 
            currentRound: 0,
            actionsTaken: 0,
            maxActions: 3,
            status: "–û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –≥—Ä—É–ø–ø—ã...",
            historyLog: [],
            conversationHistory: 0 
        };

        // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ô ---

        function updateLog(message, isError = false) {
            const logBox = document.getElementById('game-log');
            const prefix = isError ? '<span style="color: #e74c3c;">[–û–®–ò–ë–ö–ê]</span> ' : '';
            logBox.innerHTML += `<p>${prefix}${message}</p>`;
            logBox.scrollTop = logBox.scrollHeight;
        }

        function takeAction(actionType = "–¥–µ–π—Å—Ç–≤–∏–µ") {
            if (gameState.actionsTaken >= gameState.maxActions) {
                updateLog(`üõë –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π (3) –≤ —ç—Ç–æ–º —Ä–∞—É–Ω–¥–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ. (${actionType})`, true);
                return false;
            }
            gameState.actionsTaken++;
            document.getElementById('actions-remaining').textContent = gameState.maxActions - gameState.actionsTaken;
            return true;
        }

        function checkNextRound() {
            if (gameState.currentRound !== 7 && gameState.actionsTaken < gameState.maxActions) {
                updateLog("üõë –í—ã –µ—â–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –≤—Å–µ 3 –¥–µ–π—Å—Ç–≤–∏—è —ç—Ç–æ–≥–æ —Ä–∞—É–Ω–¥–∞. –ù–∞–∂–º–∏—Ç–µ –µ—â–µ —Ä–∞–∑, —á—Ç–æ–±—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å.", true);
                // –ü–æ–∑–≤–æ–ª—è–µ–º –∏–≥—Ä–æ–∫—É –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ä–∞—É–Ω–¥, –¥–∞–∂–µ –µ—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏—è –æ—Å—Ç–∞–ª–∏—Å—å
            }
            if (gameState.currentRound === 7) return; 

            // –°–ø–∏—Å–∞–Ω–∏–µ HP 
            const hpLoss = 3; 
            gameState.inventory.HP -= hpLoss;
            updateLog(`--- –ï–ñ–ï–î–ù–ï–í–ù–´–ô –†–ê–°–•–û–î ---`);
            updateLog(`üíî –ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ -${hpLoss} HP. –¢–µ–∫—É—â–∏–π HP: ${gameState.inventory.HP}`);

            if (gameState.inventory.HP <= 0) {
                gameOver("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ–π —Å–∏—Å—Ç–µ–º –∂–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è. –ú–∏—Å—Å–∏—è –æ–∫–æ–Ω—á–µ–Ω–∞.");
                return;
            }
            
            gameState.currentRound++;
            gameState.actionsTaken = 0; 
            document.getElementById('trade-console').style.display = 'none';
            updateLog(`=== –ü–µ—Ä–µ—Ö–æ–¥ –≤ ${ROUND_TITLES[gameState.currentRound]} ===`, true);
            gameState.status = "–†–∞—É–Ω–¥ –Ω–∞—á–∞—Ç. –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ.";
            loadRound(gameState.currentRound);
            updateUI();
        }

        function gameOver(message) {
            document.getElementById('game-round').style.display = 'none';
            document.getElementById('game-over').style.display = 'block';
            document.getElementById('game-over-message').textContent = message;
        }

        function startGame(groupName) {
            gameState.group = groupName;
            gameState.currentRound = 1;
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('game-round').style.display = 'block';
            document.getElementById('craft-area').style.display = 'block'; // –ö—Ä–∞—Ñ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —Å 1 —Ä–∞—É–Ω–¥–∞
            
            updateLog(`–ì—Ä—É–ø–ø–∞ –≤—ã–±—Ä–∞–Ω–∞ **${GROUP_NAMES[groupName]}**. –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è ${ROUND_TITLES[gameState.currentRound]}`);
            gameState.status = `–í–∞—à –±–æ–Ω—É—Å–Ω—ã–π —Ä–µ—Å—É—Ä—Å: ${RESOURCES[GROUP_BONUSES[groupName]].name}.`;
            updateUI();
            loadRound(1);
        }
        
        // --- UI –∏ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å ---

        function updateUI() {
            document.getElementById('player-group-name').textContent = gameState.group;
            const hpElement = document.getElementById('res-hp');
            hpElement.textContent = gameState.inventory.HP;
            
            if (gameState.inventory.HP <= 6) hpElement.style.color = '#e74c3c';
            else if (gameState.inventory.HP > 12) hpElement.style.color = '#2ecc71';
            else hpElement.style.color = '#f1c40f';
            
            document.getElementById('actions-remaining').textContent = gameState.maxActions - gameState.actionsTaken;
            document.getElementById('group-status').innerHTML = gameState.status;
            document.getElementById('round-title').textContent = ROUND_TITLES[gameState.currentRound];
            
            // –°–ø–∏—Å–æ–∫ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            const inventoryList = document.getElementById('inventory-list-display');
            let html = '';
            const orderedKeys = Object.keys(RESOURCES).filter(k => gameState.inventory[k] > 0 && k !== 'HP' && k !== 'S');
            
            orderedKeys.forEach(code => {
                const count = gameState.inventory[code];
                const res = RESOURCES[code];
                const isBonusGroup = GROUP_BONUSES[gameState.group] === code;
                
                html += `<li class="inventory-item">${res.icon} ${res.name}: ${count} ${isBonusGroup ? 'üåü' : ''}</li>`;
            });
            inventoryList.innerHTML = html || '<li class="inventory-item">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</li>';
        }
        
        // --- –õ–û–ì–ò–ö–ê –î–ï–ô–°–¢–í–ò–ô (–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è) ---

        function craftComponent(resCode) {
            if (gameState.currentRound < 2 && resCode !== GROUP_BONUSES[gameState.group]) {
                 updateLog("üõë –í –†–∞—É–Ω–¥–µ 1 —Ä–∞–∑—Ä–µ—à–µ–Ω –∫—Ä–∞—Ñ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–µ–≥–æ –±–æ–Ω—É—Å–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞.", true);
                 return;
            }
            if (!takeAction("–∫—Ä–∞—Ñ—Ç")) return;
            
            const cost = CRAFT_COSTS[resCode];
            let canCraft = true;

            for (const res in cost) {
                if (gameState.inventory[res] < cost[res]) {
                    updateLog(`üõë –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ${RESOURCES[res].name}. –¢—Ä–µ–±—É–µ—Ç—Å—è ${cost[res]}. –ö—Ä–∞—Ñ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.`, true);
                    canCraft = false;
                    break;
                }
            }

            if (canCraft) {
                for (const res in cost) {
                    gameState.inventory[res] -= cost[res];
                }
                gameState.inventory[resCode]++;
                updateLog(`üéâ –£—Å–ø–µ—à–Ω—ã–π –ö—Ä–∞—Ñ—Ç! –°–æ–∑–¥–∞–Ω **1 ${RESOURCES[resCode].name}**.`);
            }
            updateUI();
        }

        // –†1: –ó–∞–¥–∞–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –æ—Ç–≤–µ—Ç–∞
        function submitRound1Task(resCode) {
            const inputElement = document.getElementById(`task-input-${resCode}`);
            const answer = inputElement.value.trim().toUpperCase().replace(/\s/g, '');
            inputElement.value = ''; // –°–±—Ä–æ—Å –ø–æ–ª—è –≤–≤–æ–¥–∞
            
            if (!answer) {
                updateLog("–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ.", true);
                return;
            }
            
            if (!takeAction("–æ—Ç–≤–µ—Ç –Ω–∞ –∑–∞–≥–∞–¥–∫—É")) return;

            const correct = THEMATIC_TASKS[resCode].answer.replace(/\s/g, '');
            const isBonus = resCode === GROUP_BONUSES[gameState.group];
            const gain = isBonus ? 10 : 5;
            
            if (answer === correct) {
                 gameState.inventory[resCode] += gain;
                 updateLog(`üéâ **[–û–¢–í–ï–¢ –í–ï–†–ù–´–ô!]** –î–æ–±—ã—Ç–æ **+${gain} ${RESOURCES[resCode].name}**. ${isBonus ? "–ë–æ–Ω—É—Å üåü" : ""}`);
            } else {
                 updateLog(`‚ùå **[–û–¢–í–ï–¢ –ù–ï–í–ï–†–ù–´–ô]** –û—Ç–≤–µ—Ç "${answer}" –Ω–µ –ø—Ä–∏–Ω—è—Ç. –†–µ—Å—É—Ä—Å –Ω–µ –ø–æ–ª—É—á–µ–Ω.`, true);
            }
            updateUI();
        }
        
        // –†2: –°–≤–æ–±–æ–¥–Ω—ã–π —Å–±–æ—Ä
        function submitRound2Collect() {
             const resCode = document.getElementById('collect-res-code').value.trim().toUpperCase();
             const amount = parseInt(document.getElementById('collect-amount').value.trim());
             const MAX_COLLECT = 15;

             if (!resCode || isNaN(amount) || amount <= 0) {
                 updateLog("–£–∫–∞–∂–∏—Ç–µ —Ä–µ—Å—É—Ä—Å (E, W, T, M, K) –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ.", true);
                 return;
             }
             if (amount > MAX_COLLECT) {
                 updateLog(`üõë –ù–µ–ª—å–∑—è —Å–æ–±—Ä–∞—Ç—å –±–æ–ª–µ–µ ${MAX_COLLECT} –µ–¥–∏–Ω–∏—Ü –∑–∞ —Ä–∞–∑.`, true);
                 return;
             }
             if (!['E', 'W', 'T', 'M', 'K'].includes(resCode)) {
                 updateLog(`üõë –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –∫–æ–¥ —Ä–µ—Å—É—Ä—Å–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: E, W, T, M, K.`, true);
                 return;
             }
             
             if (!takeAction("—Å–±–æ—Ä")) return;
             
             gameState.inventory[resCode] += amount;
             updateLog(`‚õèÔ∏è –°–±–æ—Ä: **+${amount} ${RESOURCES[resCode].name}**.`);
             updateUI();
        }


        // –†6: –ü—Ä–æ—Ü–µ—Å—Å –æ–±–º–µ–Ω–∞ (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–∞—É–Ω–¥ –¥–ª—è "—Ä–µ–≥—É–ª—è—Ç–æ—Ä–∞")
        function processTrade(action) {
            if (gameState.currentRound !== 6) return;
            
            const resCode = document.getElementById('trade-res-code').value.trim().toUpperCase();
            const amount = parseInt(document.getElementById('trade-amount').value.trim());

            if (!resCode || isNaN(amount) || amount <= 0 || !RESOURCES[resCode]) {
                 updateLog("‚ö†Ô∏è –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ —Ä–µ—Å—É—Ä—Å–∞ –∏–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ.", true);
                 return;
            }
            
            document.getElementById('trade-res-code').value = '';
            document.getElementById('trade-amount').value = '';
            
            if (action === 'OTDAT') {
                if (gameState.inventory[resCode] >= amount) {
                    gameState.inventory[resCode] -= amount;
                    updateLog(`[–û–ë–ú–ï–ù/–û–¢–î–ê–¢–û–†] –û—Ç–¥–∞–Ω–æ **-${amount} ${RESOURCES[resCode].name}** (–æ–∂–∏–¥–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞).`);
                } else {
                    updateLog(`üõë –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ${RESOURCES[resCode].name} –¥–ª—è –æ—Ç–¥–∞—á–∏.`, true);
                }
            } else if (action === 'POLUCHIT') {
                gameState.inventory[resCode] += amount;
                updateLog(`[–û–ë–ú–ï–ù/–ü–û–õ–£–ß–ê–¢–ï–õ–¨] –ü–æ–ª—É—á–µ–Ω–æ **+${amount} ${RESOURCES[resCode].name}** (—Ä–µ—Å—É—Ä—Å –∑–∞—á–∏—Å–ª–µ–Ω).`);
            }
            
            updateUI();
        }

        // –û–±—â–µ–Ω–∏–µ (–¥–ª—è –≤—Å–µ—Ö —Ä–∞—É–Ω–¥–æ–≤)
        function simulateConversation() {
            const messages = [
                "–ì—Ä—É–ø–ø–∞ 1: '–£ –Ω–∞—Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –¥–µ—Ñ–∏—Ü–∏—Ç –í–æ–¥—ã! –ö—Ç–æ –º–æ–∂–µ—Ç –æ–±–º–µ–Ω—è—Ç—å –≠–Ω–µ—Ä–≥–æ—è—á–µ–π–∫–∏?'",
                "–ì—Ä—É–ø–ø–∞ 2: '–ù–∞—à–∏ –∑–∞–ø–∞—Å—ã –ú–µ—Ç–∞–ª–ª–æ–ª–æ–º–∞ –∏—Å—Å—è–∫–ª–∏. –ò—â–µ–º –í–æ–¥—É –∏–ª–∏ –ü–æ—á–≤—É!'",
                "–ì—Ä—É–ø–ø–∞ 3: '–ì–æ—Ç–æ–≤—ã –ø—Ä–æ–¥–∞—Ç—å –∏–∑–ª–∏—à–∫–∏ –ö–∞–±–µ–ª–µ–π –∑–∞ –¢–µ—Ä–º–æ-–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä (G). –°—Ä–æ—á–Ω–æ!'",
                "–ì—Ä—É–ø–ø–∞ 1: '–£ –Ω–∞—Å –µ—Å—Ç—å 5M –∏ 5K, –∏—â–µ–º T. –î–∞–≤–∞–π—Ç–µ –æ–±—Å—É–¥–∏–º –æ–±–º–µ–Ω!'",
                "–ì—Ä—É–ø–ø–∞ 2: '–ü–æ–Ω—è–ª, —Å–≤—è–∂–µ–º—Å—è. –£ –Ω–∞—Å –µ—Å—Ç—å 10T. –ù—É–∂–Ω—ã 2E.'"
            ];
            
            const message = messages[gameState.conversationHistory % messages.length];
            document.getElementById('communication-message').textContent = message;

            if (gameState.currentRound === 6) {
                 document.getElementById('trade-console').style.display = 'block';
                 updateLog(`üì¢ –û–¢–ö–†–´–¢–û –û–ö–ù–û –û–ë–ú–ï–ù–ê. –ù–∞—á–∏–Ω–∞–π—Ç–µ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã.`, true);
            }
            
            gameState.conversationHistory++;
        }
        
        // --- –õ–û–ì–ò–ö–ê –î–ï–ô–°–¢–í–ò–ô (3-7 —Ä–∞—É–Ω–¥—ã) ---

        function applyRoundAction(actionCode) {
            if (!takeAction("—Ü–µ–ª–µ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ")) return; 
            
            let statusChange = 0;
            let message = "";

            if (gameState.currentRound === 3) { // –û–±—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ)
                const costMap = {
                    'P': { T: 3, W: 3, name: RESOURCES.P.name }, 
                    'G': { E: 3, K: 3, name: RESOURCES.G.name }, 
                    'C': { M: 3, T: 3, name: RESOURCES.C.name }  
                };
                
                const component = costMap[actionCode];
                let canBuild = true;

                for (const res in component) {
                    if (res !== 'name' && gameState.inventory[res] < component[res]) {
                        updateLog(`üõë –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ${RESOURCES[res].name} –¥–ª—è ${component.name}.`, true);
                        canBuild = false;
                        break;
                    }
                }

                if (canBuild) {
                    for (const res in component) {
                        if (res !== 'name') gameState.inventory[res] -= component[res];
                    }
                    statusChange = 1;
                    message = `–°–æ–∑–¥–∞–Ω –±–∞–∑–æ–≤—ã–π **${component.name}**. +1 –∫ —Å—Ç–∞—Ç—É—Å—É –≤—ã–∂–∏–≤–∞–Ω–∏—è.`;
                } else {
                    // –ï—Å–ª–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –ø—Ä–æ–≤–∞–ª–µ–Ω–æ, –¥–µ–π—Å—Ç–≤–∏–µ –≤—Å–µ —Ä–∞–≤–Ω–æ –∑–∞—Å—á–∏—Ç–∞–Ω–æ
                    statusChange = -1; message = "–ü–æ–ø—ã—Ç–∫–∞ –ø—Ä–æ–≤–∞–ª–µ–Ω–∞. –ó–∞—Ç—Ä–∞—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ –∏ —ç–Ω–µ—Ä–≥–∏–∏. **-1 –∫ —Å—Ç–∞—Ç—É—Å—É**.";
                }
            } else if (gameState.currentRound === 4) { // –†–∏—Å–∫ –∏ –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
                if (actionCode === 'RiskHP') {
                    if (gameState.inventory.HP > 3) {
                        gameState.inventory.HP -= 3;
                        statusChange = 2; 
                        message = "–†–∏—Å–∫–æ–≤–∞–Ω–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: **-3 HP**, –Ω–æ **+2 –∫ —Å—Ç–∞—Ç—É—Å—É**. –ù–∞–π–¥–µ–Ω–∞ —Ü–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è!";
                    } else {
                        statusChange = -3;
                        gameState.inventory.HP = 0;
                        message = "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫! **-3 –∫ —Å—Ç–∞—Ç—É—Å—É**. –í—ã –ø–æ–≥–∏–±–ª–∏.";
                        gameOver(message);
                    }
                } else if (actionCode === 'SafeHP') {
                    if (gameState.inventory.T >= 5) {
                        gameState.inventory.T -= 5;
                        gameState.inventory.HP += 3;
                        message = "–°–ø–æ–∫–æ–π–Ω—ã–π –¥–µ–Ω—å: **-5 –ü–æ—á–≤—ã**, **+3 HP** (–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ).";
                    } else {
                        statusChange = -1;
                        message = "–ù–µ—á–µ–º –ø–∏—Ç–∞—Ç—å—Å—è. **-1 –∫ —Å—Ç–∞—Ç—É—Å—É**.";
                    }
                }
            } else if (gameState.currentRound === 5) { // –®—Ç–æ—Ä–º
                 const hasComponent = gameState.inventory[actionCode] > 0;
                 if (hasComponent) {
                     gameState.inventory[actionCode]--;
                     statusChange = 3; 
                     message = `–ó–∞—â–∏—Ç–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º **${RESOURCES[actionCode].name}** —É—Å–ø–µ—à–Ω–∞. **+3 –∫ —Å—Ç–∞—Ç—É—Å—É**!`;
                 } else {
                     gameState.inventory.HP -= 4;
                     statusChange = -2;
                     message = "–ù–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –¥–ª—è –∑–∞—â–∏—Ç—ã! –®—Ç–æ—Ä–º –ø–æ–≤—Ä–µ–¥–∏–ª –±–∞–∑—É. **-4 HP**, **-2 –∫ —Å—Ç–∞—Ç—É—Å—É**.";
                 }
            } else if (gameState.currentRound === 7) {
                assembleBeacon();
                return;
            }

            if (message) updateLog(`‚úÖ –î–µ–π—Å—Ç–≤–∏–µ —É—Å–ø–µ—à–Ω–æ. ${message}`);
            
            if (gameState.inventory.HP <= 0) {
                 gameOver("–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ä–∏—Å–∫–æ–≤! –ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —É–ø–∞–ª–æ –¥–æ –Ω—É–ª—è.");
                 return;
            }

            if (statusChange !== 0) {
                 gameState.historyLog.push({ round: gameState.currentRound, statusChange: statusChange, details: `–î–µ–π—Å—Ç–≤–∏–µ ${actionCode}` });
            }
            gameState.status = `–ü–æ—Å–ª–µ–¥–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ: ${message}`;
            loadRound(gameState.currentRound);
            updateUI();
        }

        // --- –§–ò–ù–ê–õ ---
        function assembleBeacon() {
            if (!takeAction("—Å–±–æ—Ä–∫–∞ –º–∞—è–∫–∞")) return; 
            
            const required = { P: 1, G: 1, C: 1 };
            let canAssemble = true;

            for (const res in required) {
                if (gameState.inventory[res] < required[res]) {
                    updateLog(`üõë –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ${RESOURCES[res].name} (1 —à—Ç) –¥–ª—è —Å–±–æ—Ä–∫–∏ –ú–∞—è–∫–∞.`, true);
                    canAssemble = false;
                    break;
                }
            }

            if (canAssemble) {
                gameState.inventory.P -= 1;
                gameState.inventory.G -= 1;
                gameState.inventory.C -= 1;
                gameState.inventory.S = 1;
                updateLog(`üéâ **–ú–∞—è–∫ –°–ø–∞—Å–µ–Ω–∏—è –°–æ–±—Ä–∞–Ω!** –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—á–∞ —Å–∏–≥–Ω–∞–ª–∞.`);
                updateUI();
                
                // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
                document.getElementById('action-area').innerHTML = `<h3 style="color: #2ecc71;">${getFinalMessage()}</h3>`;
                document.getElementById('round-title').textContent = "üõ∞Ô∏è –§–ò–ù–ê–õ –ú–ò–°–°–ò–ò";
                document.getElementById('actions-remaining').textContent = 0;
            }
        }

        function calculateFinalScore() {
            const assemblyBonus = gameState.inventory.S > 0 ? 10 : 0; 
            const historyScore = gameState.historyLog.reduce((sum, log) => sum + log.statusChange, 0);
            return assemblyBonus + historyScore;
        }

        function getFinalMessage() {
            const score = calculateFinalScore();
            if (gameState.inventory.S === 0) return `‚ùå –ü—Ä–æ–≤–∞–ª –º–∏—Å—Å–∏–∏! –ú–∞—è–∫ –Ω–µ —Å–æ–±—Ä–∞–Ω. –°—á–µ—Ç: **${score}**`;
            if (score >= 15) return `üåü –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –£–°–ü–ï–•! –°—á–µ—Ç: **${score}**. –í—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç–µ—Å—å –≥–µ—Ä–æ–µ–º!`;
            if (score >= 8) return `‚úÖ –£–°–ü–ï–•! –°—á–µ—Ç: **${score}**. –°–∏–≥–Ω–∞–ª –ø—Ä–∏–Ω—è—Ç. –í—ã –≤—ã–∂–∏–ª–∏.`;
            return `‚ö†Ô∏è –ù–ò–ó–ö–ò–ô –£–°–ü–ï–•! –°—á–µ—Ç: **${score}**. –ú–∞—è–∫ —Å–æ–±—Ä–∞–Ω, –Ω–æ —Å–ª–∞–±—ã–π —Å–∏–≥–Ω–∞–ª.`;
        }


        // --- –ó–ê–ì–†–£–ó–ö–ê –†–ê–£–ù–î–û–í –° –§–û–†–ú–ê–ú–ò ---

        function getRoundDescription(round) {
            const bonusCode = GROUP_BONUSES[gameState.group];
            
            switch(round) {
                case 1: 
                    return `
                        <h3>–¶–µ–ª—å: –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –°–±–æ—Ä (–ó–∞–≥–∞–¥–∫–∏)</h3>
                        <p>–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ—Å—É—Ä—Å, –≤–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç –Ω–∞ –∑–∞–≥–∞–¥–∫—É. –ó–∞–¥–∞–Ω–∏–µ ‚Äî —ç—Ç–æ 1 –¥–µ–π—Å—Ç–≤–∏–µ.</p>
                        <p>–ë–æ–Ω—É—Å –∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: **+10 –µ–¥.** —Å–≤–æ–µ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ (üåü) –∏–ª–∏ **+5 –µ–¥.** –¥—Ä—É–≥–∏—Ö.</p>
                        <hr>
                        <div class="task-form">
                            ${Object.keys(RESOURCES).filter(k => ['E', 'W', 'T', 'M', 'K'].includes(k)).map(code => `
                                <h4>–ó–∞–¥–∞–Ω–∏–µ –Ω–∞ ${RESOURCES[code].name} (${code}) ${code === bonusCode ? 'üåü' : ''}:</h4>
                                <p>${THEMATIC_TASKS[code].question}</p>
                                <input type="text" id="task-input-${code}" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç">
                                <button onclick="submitRound1Task('${code}')">–û—Ç–≤–µ—Ç–∏—Ç—å (–ó–∞—á–µ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ)</button>
                            `).join('')}
                        </div>
                    `;
                case 2: 
                    document.getElementById('craft-area').style.display = 'block';
                    return `
                        <h3>–¶–µ–ª—å: –°–≤–æ–±–æ–¥–Ω—ã–π –°–±–æ—Ä (–õ–∏–º–∏—Ç –≤–µ—Å–∞)</h3>
                        <p>–ò—Å—Å–ª–µ–¥—É–π—Ç–µ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ —Å–æ–±–∏—Ä–∞–π—Ç–µ —Ä–µ—Å—É—Ä—Å—ã. –í—ã –º–æ–∂–µ—Ç–µ —Å–æ–±—Ä–∞—Ç—å –¥–æ **15 –µ–¥–∏–Ω–∏—Ü** –ª—é–±–æ–≥–æ –±–∞–∑–æ–≤–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ –∑–∞ –æ–¥–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ. –¢—Ä–∞—Ç–∏—Ç—Å—è 1 –¥–µ–π—Å—Ç–≤–∏–µ.</p>
                        <hr>
                        <div class="task-form">
                            <h4>–§–æ—Ä–º–∞ —Å–±–æ—Ä–∞ (1 –¥–µ–π—Å—Ç–≤–∏–µ):</h4>
                            <input type="text" id="collect-res-code" placeholder="–ö–æ–¥ —Ä–µ—Å—É—Ä—Å–∞ (E, W, T, M, K)" style="width: 25%;">
                            <input type="number" id="collect-amount" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (–¥–æ 15)" style="width: 25%;">
                            <button onclick="submitRound2Collect()">–ó–∞–ø—Ä–æ—Å–∏—Ç—å –°–±–æ—Ä (–ó–∞—á–µ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ)</button>
                        </div>
                    `;
                case 3: 
                    return `
                    <h3>–¶–µ–ª—å: –û–±—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ñ–∏–∑–Ω–∏ (–ë–∞–∑–æ–≤–æ–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ)</h3>
                    <p>–ü–æ—Å—Ç—Ä–æ–π—Ç–µ –æ–¥–∏–Ω –∏–∑ –±–∞–∑–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤, —á—Ç–æ–±—ã –∑–∞–∫—Ä–µ–ø–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏. –¢—Ä–∞—Ç–∏—Ç—Å—è 1 –¥–µ–π—Å—Ç–≤–∏–µ.</p>
                    <ul style="list-style: none; padding: 0;">
                        <li>**üíßüå± –ú–∏–∫—Ä–æ-–ü–æ–ª–∏–≤ (P)**: -3 ‚õ∞Ô∏è –ü–æ—á–≤–∞, -3 üíß –í–æ–¥–∞</li>
                        <li>**‚òÄÔ∏è –¢–µ—Ä–º–æ-–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä (G)**: -3 ‚ö° –≠–Ω–µ—Ä–≥–æ—è—á–µ–π–∫–∞, -3 üîó –ö–∞–±–µ–ª–∏</li>
                        <li>**üì¶ –ì–µ—Ä–º–æ-–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä (C)**: -3 üî© –ú–µ—Ç–∞–ª–ª–æ–ª–æ–º, -3 ‚õ∞Ô∏è –ü–æ—á–≤–∞</li>
                    </ul>
                `;
                case 4: return `<h3>–¶–µ–ª—å: –†–∏—Å–∫ –∏ –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</h3><p>–í—ã–±–µ—Ä–∏—Ç–µ: —Ä–∏—Å–∫–Ω—É—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ–º —Ä–∞–¥–∏ –±–æ–ª—å—à–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –∏–ª–∏ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ HP.</p>`;
                case 5: return `<h3>–¶–µ–ª—å: –®—Ç–æ—Ä–º –∏ –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ</h3><p>–ù–∞–¥–≤–∏–≥–∞–µ—Ç—Å—è –º–æ—â–Ω—ã–π —à—Ç–æ—Ä–º. –í—ã–±–µ—Ä–∏—Ç–µ, –∫–∞–∫–æ–π –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å –¥–ª—è –∑–∞—â–∏—Ç—ã.</p>`;
                case 6: 
                    document.getElementById('trade-console').style.display = 'block';
                    return `<h3>–¶–µ–ª—å: –§–∏–Ω–∞–ª—å–Ω–∞—è –¢–æ—Ä–≥–æ–≤–ª—è (–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–∞—É–Ω–¥ —Å —Ä–µ–≥—É–ª—è—Ç–æ—Ä–æ–º)</h3><p>üó£Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç —Å –¥—Ä—É–≥–∏–º–∏ –≥—Ä—É–ø–ø–∞–º–∏ –∏ –¥–æ–≥–æ–≤–æ—Ä–∏—Ç–µ—Å—å –æ–± –æ–±–º–µ–Ω–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–µ **–°–∏—Å—Ç–µ–º–∞ –æ–±–º–µ–Ω–∞** –¥–ª—è –≤–≤–æ–¥–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫. –≠—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–∞—É–Ω–¥, –≥–¥–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –º–æ–¥–µ—Ä–∞—Ü–∏—è —Å–¥–µ–ª–æ–∫.</p>`;
                case 7: return `
                    <h3>–¶–µ–ª—å: –°–±–æ—Ä–∫–∞ –ú–∞—è–∫–∞ –∏ –§–∏–Ω–∞–ª</h3>
                    <p>–í–∞–º —Ç—Ä–µ–±—É–µ—Ç—Å—è 1 **–ú–∏–∫—Ä–æ-–ü–æ–ª–∏–≤ (P)**, 1 **–¢–µ—Ä–º–æ-–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä (G)** –∏ 1 **–ì–µ—Ä–º–æ-–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä (C)**. –≠—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ.</p>
                `;
            }
        }

        function loadRound(round) {
            const desc = document.getElementById('round-description');
            const actions = document.getElementById('action-area');
            actions.innerHTML = '';
            desc.innerHTML = getRoundDescription(round);
            
            // –°–∫—Ä—ã—Ç–∏–µ/–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ñ–æ—Ä–º
            document.getElementById('trade-console').style.display = (round === 6) ? 'block' : 'none';
            document.getElementById('craft-area').style.display = (round >= 2 || round === 1) ? 'block' : 'none'; // –ö—Ä–∞—Ñ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–≥–¥–∞, –∫—Ä–æ–º–µ R1 (–∑–∞–¥–∞–Ω–∏—è)

            // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π (3-7 —Ä–∞—É–Ω–¥—ã)
            if (round === 1 || round === 2) {
                 actions.innerHTML = `<p style="color: #f1c40f;">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º—ã –≤—ã—à–µ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π.</p>`;
            } else if (round === 3) {
                 actions.innerHTML = `
                     <button onclick="applyRoundAction('P')">–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –ë–∞–∑–æ–≤—É—é –ü–∏—â—É (-3T, -3W)</button>
                     <button onclick="applyRoundAction('G')">–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –ë–∞–∑–æ–≤–æ–µ –¢–µ–ø–ª–æ (-3E, -3K)</button>
                     <button onclick="applyRoundAction('C')">–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –ë–∞–∑–æ–≤–æ–µ –£–±–µ–∂–∏—â–µ (-3M, -3T)</button>
                 `;
            } else if (round === 4) {
                 actions.innerHTML = `
                     <p>–¢–µ–∫—É—â–∏–π HP: ${gameState.inventory.HP}. –î–æ—Å—Ç—É–ø–Ω–æ –ü–æ—á–≤—ã (T): ${gameState.inventory.T}</p>
                     <button onclick="applyRoundAction('RiskHP')" style="background: #e74c3c;">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –†–∏—Å–∫ (-3 HP, +2 –°—Ç–∞—Ç—É—Å)</button>
                     <button onclick="applyRoundAction('SafeHP')" ${gameState.inventory.T < 5 ? 'disabled' : ''}>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (-5 T, +3 HP)</button>
                 `;
            } else if (round === 5) {
                 actions.innerHTML = `
                     <p>–ó–∞—â–∏—Ç–∏—Ç—å, –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–≤ 1 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç. –î–æ—Å—Ç—É–ø–Ω–æ: P (${gameState.inventory.P}), G (${gameState.inventory.G}), C (${gameState.inventory.C})</p>
                     <button onclick="applyRoundAction('P')" ${gameState.inventory.P < 1 ? 'disabled' : ''}>–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å –ü–æ–ª–∏–≤ (-1 P, +3 –°—Ç–∞—Ç—É—Å)</button>
                     <button onclick="applyRoundAction('G')" ${gameState.inventory.G < 1 ? 'disabled' : ''}>–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä (-1 G, +3 –°—Ç–∞—Ç—É—Å)</button>
                     <button onclick="applyRoundAction('C')" ${gameState.inventory.C < 1 ? 'disabled' : ''}>–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä (-1 C, +3 –°—Ç–∞—Ç—É—Å)</button>
                 `;
            } else if (round === 6) {
                 actions.innerHTML = `<p style="color: #f1c40f;">–î–µ–π—Å—Ç–≤–∏—è —Ç—Ä–∞—Ç—è—Ç—Å—è –Ω–∞ –ö—Ä–∞—Ñ—Ç –∏–ª–∏ –û–±—â–µ–Ω–∏–µ. –û–±–º–µ–Ω –º–æ–¥–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å.</p>`;
            } else if (round === 7) {
                actions.innerHTML = `<button onclick="assembleBeacon()" style="background: #2ecc71;">üöÄ –°–æ–±—Ä–∞—Ç—å –ú–∞—è–∫ –°–ø–∞—Å–µ–Ω–∏—è</button>`;
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
             updateLog("–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.");
        });
    </script>
</body>
</html>
