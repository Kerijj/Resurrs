<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–≠–∫—Å–ø–µ–¥–∏—Ü–∏—è –ê—Ä–µ—Å 7: –ú–∞—Ä—Å–∏–∞–Ω—Å–∫–∏–π –ö–æ–¥–µ–∫—Å</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* –ú–∞—Ä—Å–∏–∞–Ω—Å–∫–∏–π –°—Ç–∏–ª—å */
        body { 
            font-family: 'Orbitron', sans-serif;
            background: #2c0b0b;
            color: #d1b4a6;
            padding: 20px; 
            line-height: 1.5;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%232c0b0b"/><circle cx="50" cy="50" r="10" fill="%236e3c3c" opacity="0.3"/></svg>');
        }
        .container { 
            max-width: 950px; 
            margin: 0 auto; 
            padding: 30px; 
            background: rgba(44, 11, 11, 0.9); 
            border: 3px solid #e74c3c; 
            border-radius: 15px; 
            box-shadow: 0 0 25px #c0392b; 
        }
        
        /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
        h1 { color: #f1c40f; text-align: center; text-shadow: 0 0 5px #f1c40f; }
        h2 { color: #3498db; border-bottom: 2px solid #e74c3c; padding-bottom: 10px; margin-top: 25px; }
        h3 { color: #2ecc71; margin-top: 15px; }
        
        /* –û—Å–Ω–æ–≤–Ω—ã–µ –±–ª–æ–∫–∏ */
        .intro, .round-content, .status-panel { 
            margin-bottom: 20px; 
            padding: 18px; 
            border: 1px solid #c0392b; 
            border-radius: 10px; 
            background: rgba(18, 5, 5, 0.7); 
        }

        /* –ü–∞–Ω–µ–ª—å –°—Ç–∞—Ç—É—Å–∞ */
        .status-panel { display: flex; justify-content: space-between; align-items: flex-start; }
        .info-block { flex: 1; margin-right: 20px; }
        
        /* –î–∏—Å–ø–ª–µ–π —Ä–µ—Å—É—Ä—Å–æ–≤ */
        .inventory-list { 
            list-style-type: none; 
            padding: 0; 
            display: flex; 
            flex-wrap: wrap; 
            gap: 12px;
            max-width: 60%;
        }
        .inventory-item { 
            padding: 8px 15px; 
            border-radius: 6px; 
            background: #e74c3c; 
            color: #2c0b0b; 
            font-weight: bold; 
            font-size: 0.95em;
            box-shadow: 0 0 8px #c0392b;
        }

        /* –ñ—É—Ä–Ω–∞–ª */
        .log-box { 
            margin-top: 20px; 
            background: #180505; 
            padding: 15px; 
            height: 120px; 
            overflow-y: scroll; 
            border-radius: 8px; 
            font-size: 0.8em; 
            border: 1px solid #c0392b;
        }
        .log-box p { margin: 3px 0; }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        button { 
            padding: 12px 20px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 8px; 
            font-weight: bold; 
            background: #3498db; 
            color: #d1b4a6; 
            transition: background 0.3s, transform 0.1s; 
            box-shadow: 0 4px #2980b9; 
        }
        button:hover:not(:disabled) { background: #2980b9; transform: translateY(1px); box-shadow: 0 3px #2980b9; }
        button:disabled { background: #604040; cursor: not-allowed; opacity: 0.7; box-shadow: none;}
        
        .group-select button { width: 30%; }

        /* –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫—É–ø–æ–∫ */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #180505; }
        th, td { border: 1px solid #c0392b; padding: 10px; text-align: left; }
        th { background: #6e3c3c; color: #f1c40f; }

        /* –ü–∞–Ω–µ–ª—å –í–µ–¥—É—â–µ–≥–æ */
        .mod-panel { 
            margin-top: 25px; 
            padding: 15px; 
            background: rgba(44, 11, 11, 0.9);
            border-radius: 8px; 
            border: 1px solid #3498db;
        }
        #mod-input { 
            padding: 10px; 
            border-radius: 4px; 
            border: 1px solid #7f8c8d; 
            margin-right: 10px; 
            background: #2c0b0b; 
            color: #d1b4a6; 
            width: 300px;
        }
        .final-message { 
            padding: 20px; 
            background: #2ecc71; 
            color: #2c0b0b; 
            border-radius: 10px; 
            font-size: 1.3em; 
            font-weight: bold;
            text-align: center;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>üëΩ –≠–∫—Å–ø–µ–¥–∏—Ü–∏—è –ê—Ä–µ—Å 7: –ú–∞—Ä—Å–∏–∞–Ω—Å–∫–∏–π –ö–æ–¥–µ–∫—Å</h1>
        <div id="game-area">
            
            <div class="intro" id="intro-screen">
                <h2>–ü—Ä–æ—Ç–æ–∫–æ–ª: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è</h2>
                <p>–í–∞—à –æ—Ä–±–∏—Ç–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å —Ä–∞–∑–±–∏–ª—Å—è. –í—ã - –ø–æ—Å–ª–µ–¥–Ω–∏–µ, –∫—Ç–æ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–∏–≥–Ω–∞–ª —Å–ø–∞—Å–µ–Ω–∏—è. –ú–∞—Ä—Å —Å—É—Ä–æ–≤. –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –≥—Ä—É–ø–ø—ã –¥–ª—è –Ω–∞—á–∞–ª–∞ –º–∏—Å—Å–∏–∏ –∏ –ø–æ–ª—É—á–∏—Ç–µ **100 –∫—Ä–µ–¥–∏—Ç–æ–≤** –Ω–∞ –∑–∞–∫—É–ø–∫—É –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.</p>
                
                <div class="group-select">
                    <button onclick="startGame('Technocrats')">üõ†Ô∏è –¢–µ—Ö–Ω–æ–∫—Ä–∞—Ç—ã (–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞)</button>
                    <button onclick="startGame('Bioengineers')">üß™ –ë–∏–æ–∏–Ω–∂–µ–Ω–µ—Ä—ã (–ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ)</button>
                    <button onclick="startGame('Constructors')">üß± –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã (–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)</button>
                </div>
            </div>

            <div id="game-round" style="display:none;">
                <h2 id="round-title"></h2>
                
                <div class="status-panel">
                    <div class="info-block">
                        <h3>–ì—Ä—É–ø–ø–∞: <span id="player-group-name"></span></h3>
                        <p>–ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ (HP): <span id="res-hp" style="color: #e74c3c; font-weight: bold;"></span></p>
                        <p>–ö—Ä–µ–¥–∏—Ç—ã (–ö–†): <span id="res-credits" style="color: #f1c40f; font-weight: bold;"></span></p>
                        <p>–î–µ–π—Å—Ç–≤–∏–π –æ—Å—Ç–∞–ª–æ—Å—å: <span id="actions-remaining" style="color: #3498db; font-weight: bold;"></span> / 3</p>
                    </div>
                    <div>
                        <h3>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å:</h3>
                        <ul class="inventory-list" id="inventory-list-display"></ul>
                    </div>
                </div>

                <div class="round-content" id="round-description"></div>

                <div class="action-area" id="action-area"></div>
                
                <div class="log-box">
                    **–ñ—É—Ä–Ω–∞–ª –ë–æ—Ä—Ç–æ–≤–æ–π –°–∏—Å—Ç–µ–º—ã**
                    <div id="game-log"></div>
                </div>

                <div class="mod-panel">
                    <h4>üì° –ü—Ä–æ—Ç–æ–∫–æ–ª –°–≤—è–∑–∏ (–í–µ–¥—É—â–∏–π)</h4>
                    <p>–î–ª—è –æ–±–º–µ–Ω–∞ –∏–ª–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: **–û–¢–î–ê–¢–¨/–ü–û–õ–£–ß–ò–¢–¨ [–∫–æ–¥] [–∫–æ–ª-–≤–æ]**</p>
                    <input type="text" id="mod-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –í–µ–¥—É—â–µ–≥–æ (–ö–†–ê–§–¢, –û–¢–î–ê–¢–¨/–ü–û–õ–£–ß–ò–¢–¨)">
                    <button onclick="processModCommand()">–í–≤–æ–¥ –ö–æ–º–∞–Ω–¥—ã</button>
                    <button onclick="checkNextRound()" style="background: #e74c3c;">–ó–∞–≤–µ—Ä—à–∏—Ç—å –¶–∏–∫–ª (–°–ø–∏—Å–∞–Ω–∏–µ HP)</button>
                </div>
            </div>
            
            <div id="game-over" style="display:none; text-align: center;">
                 <h2 style="color: #e74c3c;">üî¥ –°–ò–ì–ù–ê–õ –ü–û–¢–ï–†–Ø–ù</h2>
                 <p id="game-over-message" style="font-size: 1.2em;"></p>
            </div>
        </div>
    </div>

    <script>
        // --- –î–ê–ù–ù–´–ï –ò–ì–†–´ ---
        const RESOURCES = {
            // –ë–∞–∑–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã (5 —à—Ç)
            E: { name: '–≠–Ω–µ—Ä–≥–æ—è—á–µ–π–∫–∞', code: 'E', icon: '‚ö°', cost: 10 },
            B: { name: '–ë–∏–æ–º–∞—Å—Å–∞', code: 'B', icon: 'üå±', cost: 10 },
            S: { name: '–ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π –°–ø–ª–∞–≤', code: 'S', icon: 'üî©', cost: 10 },
            L: { name: '–ì–∏–¥—Ä–æ-–†–µ–∞–≥–µ–Ω—Ç', code: 'L', icon: 'üíß', cost: 15 },
            F: { name: '–ò–∑–æ–≤–æ–ª–æ–∫–Ω–æ', code: 'F', icon: 'üß∂', cost: 15 },
            
            // –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ/–ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã (4 —à—Ç)
            M: { name: '–ö—Ä–∏–æ-–ú–æ–¥—É–ª—å', code: 'M', icon: '‚ùÑÔ∏è', cost: 30 },
            W: { name: '–°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä –í–æ–¥—ã', code: 'W', icon: 'üåä', cost: 30 },
            K: { name: '–ì–µ—Ä–º–æ-–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä', code: 'K', icon: 'üì¶', cost: 30 },
            Z: { name: '–û–ø—Ç–∏—á. –ö–∞–±–µ–ª—å', code: 'Z', icon: 'üîó', cost: 30 }, 
            
            // –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ—Å—É—Ä—Å
            P: { name: '–ú–∞—è–∫ –°–ø–∞—Å–µ–Ω–∏—è', code: 'P', icon: 'üõ∞Ô∏è', cost: 0 },
            
            // –°—Ç–∞—Ç—É—Å
            HP: { name: '–ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ', code: 'HP', icon: '‚ù§Ô∏è', cost: 0 },
            CR: { name: '–ö—Ä–µ–¥–∏—Ç—ã', code: 'CR', icon: 'üí∞', cost: 0 }
        };
        
        const GROUP_NAMES = {
            Technocrats: 'üõ†Ô∏è –¢–µ—Ö–Ω–æ–∫—Ä–∞—Ç—ã', 
            Bioengineers: 'üß™ –ë–∏–æ–∏–Ω–∂–µ–Ω–µ—Ä—ã', 
            Constructors: 'üß± –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã'
        };

        const ROUND_TITLES = [
            "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ú–∏—Å—Å–∏–∏",
            "–†–∞—É–Ω–¥ 1: –ó–∞–∫—É–ø–∫–∞ –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è (–ü—Ä–æ—Ç–æ–∫–æ–ª)",
            "–†–∞—É–Ω–¥ 2: –ü–ª–∞–Ω–æ–≤–æ–µ –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ",
            "–†–∞—É–Ω–¥ 3: –ê–≤–∞—Ä–∏–π–Ω—ã–π –°–∏–≥–Ω–∞–ª",
            "–†–∞—É–Ω–¥ 4: –ú–∞—Ä—Å–∏–∞–Ω—Å–∫–∏–π –§–µ–Ω–æ–º–µ–Ω",
            "–†–∞—É–Ω–¥ 5: –£–≥—Ä–æ–∑–∞ –ü–µ—Å—á–∞–Ω–æ–π –ë—É—Ä–∏",
            "–†–∞—É–Ω–¥ 6: –ö–æ–Ω—Ç—Ä–∞–∫—Ç –∏ –î–æ—Å—Ç–∞–≤–∫–∞",
            "–†–∞—É–Ω–¥ 7: –§–∏–Ω–∞–ª—å–Ω–∞—è –°–±–æ—Ä–∫–∞"
        ];
        
        const CRAFT_COSTS = {
            M: { E: 3, B: 2 }, // –ö—Ä–∏–æ-–ú–æ–¥—É–ª—å: –≠–Ω–µ—Ä–≥–∏—è + –û—Ä–≥–∞–Ω–∏–∫–∞
            W: { B: 3, S: 2 }, // –°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä –í–æ–¥—ã: –û—Ä–≥–∞–Ω–∏–∫–∞ + –ú–µ—Ç–∞–ª–ª
            K: { S: 3, L: 2 }, // –ì–µ—Ä–º–æ-–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: –ú–µ—Ç–∞–ª–ª + –ö–∞—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä
            P: { M: 1, W: 1, K: 1, Z: 1 } // –ú–∞—è–∫: M+W+K+Z (–§–∏–Ω–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞, Z - –±–æ–Ω—É—Å–Ω—ã–π)
        };

        let gameState = {
            group: null,
            inventory: { 
                E: 0, B: 0, S: 0, L: 0, F: 0, 
                M: 0, W: 0, K: 0, Z: 0, P: 0, 
                HP: 15, CR: 100 
            }, 
            currentRound: 0,
            actionsTaken: 0,
            maxActions: 3,
            historyLog: [] // –î–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
        };

        // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ô ---

        function updateLog(message, isError = false) {
            const logBox = document.getElementById('game-log');
            const prefix = isError ? 'üõë' : 'üí¨';
            logBox.innerHTML += `<p>${prefix} ${message}</p>`;
            logBox.scrollTop = logBox.scrollHeight;
        }

        function takeAction() {
            if (gameState.actionsTaken >= gameState.maxActions) {
                updateLog("üõë –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π (3) –≤ —ç—Ç–æ–º —Ü–∏–∫–ª–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ.", true);
                return false;
            }
            gameState.actionsTaken++;
            document.getElementById('actions-remaining').textContent = gameState.maxActions - gameState.actionsTaken;
            return true;
        }

        function checkNextRound() {
            if (gameState.currentRound === 1) { // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –†–∞—É–Ω–¥ 1 (–∑–∞–∫—É–ø–∫–∞)
                if (gameState.inventory.CR > 0) {
                     updateLog("üõë –í—ã –Ω–µ –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏ –≤—Å–µ –∫—Ä–µ–¥–∏—Ç—ã. –≠—Ç–æ –≤–∞—à–∞ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–∫—É–ø–∏—Ç—å—Å—è.", true);
                     return;
                }
            } else if (gameState.currentRound !== 7 && gameState.actionsTaken < gameState.maxActions) {
                updateLog("üõë –í—ã –µ—â–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –≤—Å–µ 3 –¥–µ–π—Å—Ç–≤–∏—è —ç—Ç–æ–≥–æ —Ü–∏–∫–ª–∞.", true);
                return;
            }
            
            if (gameState.currentRound === 7) return; 

            // –°–ø–∏—Å–∞–Ω–∏–µ HP 
            const hpLoss = 3; 
            gameState.inventory.HP -= hpLoss;
            updateLog(`--- –ï–ñ–ï–î–ù–ï–í–ù–´–ô –†–ê–°–•–û–î ---`);
            updateLog(`üíî –ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ -${hpLoss} HP. –¢–µ–∫—É—â–∏–π HP: ${gameState.inventory.HP}`);

            if (gameState.inventory.HP <= 0) {
                gameOver("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ–π –∂–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è. –ú–∏—Å—Å–∏—è –ê—Ä–µ—Å 7 –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –ø—Ä–æ–≤–∞–ª–æ–º.");
                return;
            }
            
            // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞—É–Ω–¥—É
            gameState.currentRound++;
            gameState.actionsTaken = 0; // –°–±—Ä–æ—Å –¥–µ–π—Å—Ç–≤–∏–π
            updateLog(`=== –ü–µ—Ä–µ—Ö–æ–¥ –≤ ${ROUND_TITLES[gameState.currentRound]} ===`);
            loadRound(gameState.currentRound);
            updateUI();
        }

        function gameOver(message) {
            document.getElementById('game-round').style.display = 'none';
            document.getElementById('game-over').style.display = 'block';
            document.getElementById('game-over-message').textContent = message;
        }

        // --- UI –ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---

        function updateUI() {
            document.getElementById('player-group-name').textContent = GROUP_NAMES[gameState.group];
            document.getElementById('res-hp').textContent = gameState.inventory.HP;
            document.getElementById('res-credits').textContent = gameState.inventory.CR;
            document.getElementById('actions-remaining').textContent = gameState.maxActions - gameState.actionsTaken;
            
            // –°–ø–∏—Å–æ–∫ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            const inventoryList = document.getElementById('inventory-list-display');
            let html = '';
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º: –ë–∞–∑–æ–≤—ã–µ, –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ
            const orderedKeys = Object.keys(RESOURCES).filter(k => gameState.inventory[k] > 0 && k !== 'HP' && k !== 'CR' && k !== 'P').sort((a, b) => {
                const isBaseA = ['E', 'B', 'S', 'L', 'F'].includes(a);
                const isBaseB = ['E', 'B', 'S', 'L', 'F'].includes(b);
                if (isBaseA && !isBaseB) return -1;
                if (!isBaseA && isBaseB) return 1;
                return a.localeCompare(b);
            });
            
            orderedKeys.forEach(code => {
                const count = gameState.inventory[code];
                const res = RESOURCES[code];
                html += `<li class="inventory-item">${res.icon} ${res.name} (${count})</li>`;
            });
            inventoryList.innerHTML = html || '<li class="inventory-item" style="background: #c0392b;">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</li>';
        }

        function startGame(groupName) {
            gameState.group = groupName;
            gameState.currentRound = 1;
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('game-round').style.display = 'block';
            
            updateLog(`–ì—Ä—É–ø–ø–∞ –≤—ã–±—Ä–∞–Ω–∞ **${GROUP_NAMES[groupName]}**. –î–æ—Å—Ç—É–ø–µ–Ω –ü—Ä–æ—Ç–æ–∫–æ–ª –ó–∞–∫—É–ø–æ–∫ (100 –ö–†).`);
            updateUI();
            loadRound(1);
        }
        
        // --- –†–ê–£–ù–î 1: –ó–ê–ö–£–ü–ö–ê ---

        function buyResource(code) {
            const res = RESOURCES[code];
            if (gameState.currentRound !== 1) {
                updateLog("üõë –ó–∞–∫—É–ø–∫–∞ –≤–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –†–∞—É–Ω–¥–µ 1.", true);
                return;
            }
            if (gameState.inventory.CR < res.cost) {
                updateLog(`üõë –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–µ–¥–∏—Ç–æ–≤. –¢—Ä–µ–±—É–µ—Ç—Å—è ${res.cost} –ö–† –¥–ª—è –ø–æ–∫—É–ø–∫–∏ ${res.name}.`, true);
                return;
            }
            
            gameState.inventory.CR -= res.cost;
            gameState.inventory[code]++;
            updateLog(`‚úÖ –ö—É–ø–ª–µ–Ω 1 ${res.icon} ${res.name}. –û—Å—Ç–∞—Ç–æ–∫: ${gameState.inventory.CR} –ö–†.`);
            updateUI();
        }

        // --- –õ–û–ì–ò–ö–ê –í–ï–î–£–©–ï–ì–û ---

        function processModCommand() {
            const input = document.getElementById('mod-input').value.trim().toLowerCase();
            const words = input.split(' ');
            document.getElementById('mod-input').value = '';

            // 1. –ö–†–ê–§–¢ [–∫–æ–¥]
            if (words[0] === '–∫—Ä–∞—Ñ—Ç' && words.length === 2) {
                const resCode = words[1].toUpperCase();
                if (['M', 'W', 'K'].includes(resCode)) {
                    craftIntermediate(resCode);
                    return;
                }
            }

            // 2. –û–¢–î–ê–¢–¨ / –ü–û–õ–£–ß–ò–¢–¨ [–∫–æ–¥] [–∫–æ–ª-–≤–æ] (–ú–æ–¥–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–º–µ–Ω–∞)
            if ((words[0] === '–æ—Ç–¥–∞—Ç—å' || words[0] === '–ø–æ–ª—É—á–∏—Ç—å') && words.length === 3) {
                const action = words[0];
                const resCode = words[1].toUpperCase();
                const amount = parseInt(words[2]);

                if (RESOURCES[resCode] && !isNaN(amount) && amount > 0 && resCode !== 'HP' && resCode !== 'CR') {
                    if (action === '–æ—Ç–¥–∞—Ç—å') {
                        if (gameState.inventory[resCode] >= amount) {
                            gameState.inventory[resCode] -= amount;
                            updateLog(`[–í–ï–î–£–©–ò–ô] –ì—Ä—É–ø–ø–∞ –æ—Ç–¥–∞–ª–∞ **-${amount} ${RESOURCES[resCode].name}**`);
                        } else {
                            updateLog(`üõë –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ${RESOURCES[resCode].name} –¥–ª—è –æ—Ç–¥–∞—á–∏.`, true);
                        }
                    } else if (action === '–ø–æ–ª—É—á–∏—Ç—å') {
                        gameState.inventory[resCode] += amount;
                        updateLog(`[–í–ï–î–£–©–ò–ô] –ì—Ä—É–ø–ø–∞ –ø–æ–ª—É—á–∏–ª–∞ **+${amount} ${RESOURCES[resCode].name}**`);
                    }
                    updateUI();
                    return;
                }
            }
            
            if (input) updateLog("–ù–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –ü—Ä–æ—Ç–æ–∫–æ–ª –°–≤—è–∑–∏.", true);
        }

        // --- –õ–û–ì–ò–ö–ê –î–ï–ô–°–¢–í–ò–ô (–ö—Ä–∞—Ñ—Ç) ---

        function craftIntermediate(resCode) {
            const cost = CRAFT_COSTS[resCode];
            let canCraft = true;

            for (const res in cost) {
                if (gameState.inventory[res] < cost[res]) {
                    updateLog(`üõë –ö—Ä–∞—Ñ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω. –¢—Ä–µ–±—É–µ—Ç—Å—è ${cost[res]} ${RESOURCES[res].name}.`, true);
                    canCraft = false;
                    break;
                }
            }

            if (canCraft) {
                for (const res in cost) {
                    gameState.inventory[res] -= cost[res];
                }
                gameState.inventory[resCode]++;
                updateLog(`üéâ –ö—Ä–∞—Ñ—Ç —É—Å–ø–µ—à–µ–Ω! –°–æ–∑–¥–∞–Ω **1 ${RESOURCES[resCode].name}**. (–°–≤–æ–±–æ–¥–Ω—ã–π –ü—Ä–æ—Ç–æ–∫–æ–ª)`);
            }
            updateUI();
        }

        // --- –õ–û–ì–ò–ö–ê –î–ï–ô–°–¢–í–ò–ô (–†–∞—É–Ω–¥—ã 2-6) ---

        function applyRoundAction(actionCode) {
            if (gameState.currentRound === 1 || gameState.currentRound === 7) return;
            if (!takeAction()) return;
            
            let statusChange = 0;
            let message = "";
            let hpChange = 0;
            let resChange = {}; // –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
            
            const group = gameState.group;

            // --- –†–ê–£–ù–î 2: –ü–õ–ê–ù–û–í–û–ï –ò–°–°–õ–ï–î–û–í–ê–ù–ò–ï (–°–í–û–ï –ó–ê–î–ê–ù–ò–ï) ---
            if (gameState.currentRound === 2) { 
                if (group === 'Technocrats') {
                    // –¢–ï–•–ù–û–ö–†–ê–¢–´: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≠–Ω–µ—Ä–≥–æ—Å–∏—Å—Ç–µ–º—ã (–¶–µ–ª—å: E, Z)
                    if (actionCode === 'Opt_E') { 
                        if (gameState.inventory.E >= 1) { gameState.inventory.E--; resChange.Z = 1; statusChange = 1; message = "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≠–Ω–µ—Ä–≥–æ—è—á–µ–π–∫–∏. –ü–æ–ª—É—á–µ–Ω üîó –û–ø—Ç–∏—á. –ö–∞–±–µ–ª—å (Z). +1 –°—Ç–∞—Ç—É—Å."; }
                        else { hpChange = -1; message = "–°–±–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: –Ω–µ—Ç –≠–Ω–µ—Ä–≥–æ—è—á–µ–π–∫–∏. -1 HP."; }
                    } else if (actionCode === 'Rec_S') { // –°–ª—É—á–∞–π–Ω—ã–π —Å–±–æ—Ä
                        resChange.S = 2; message = "–ê–Ω–∞–ª–∏–∑ –ø–æ—á–≤—ã. –ü–æ–ª—É—á–µ–Ω üî© –ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π –°–ø–ª–∞–≤ (+2 S).";
                    }
                } else if (group === 'Bioengineers') {
                    // –ë–ò–û–ò–ù–ñ–ï–ù–ï–†–´: –ó–∞–ø—É—Å–∫ –ì–∏–¥—Ä–æ–ø–æ–Ω–∏–∫–∏ (–¶–µ–ª—å: B, L)
                    if (actionCode === 'Opt_B') { 
                        if (gameState.inventory.B >= 1) { gameState.inventory.B--; resChange.L = 1; statusChange = 1; message = "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–∏–æ–º–∞—Å—Å—ã. –ü–æ–ª—É—á–µ–Ω üíß –ì–∏–¥—Ä–æ-–†–µ–∞–≥–µ–Ω—Ç (L). +1 –°—Ç–∞—Ç—É—Å."; }
                        else { hpChange = -1; message = "–°–±–æ–π –≥–∏–¥—Ä–æ–ø–æ–Ω–∏–∫–∏: –Ω–µ—Ç –ë–∏–æ–º–∞—Å—Å—ã. -1 HP."; }
                    } else if (actionCode === 'Rec_F') { // –°–ª—É—á–∞–π–Ω—ã–π —Å–±–æ—Ä
                        resChange.F = 2; message = "–°–±–æ—Ä —Ä–µ–¥–∫–æ–π –º–∞—Ä—Å–∏–∞–Ω—Å–∫–æ–π —Ñ–ª–æ—Ä—ã. –ü–æ–ª—É—á–µ–Ω–æ üß∂ –ò–∑–æ–≤–æ–ª–æ–∫–Ω–æ (+2 F).";
                    }
                } else if (group === 'Constructors') {
                    // –ö–û–ù–°–¢–†–£–ö–¢–û–†–´: –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –ë–∞–∑—ã (–¶–µ–ª—å: S, F)
                    if (actionCode === 'Opt_S') { 
                        if (gameState.inventory.S >= 1) { gameState.inventory.S--; resChange.F = 1; statusChange = 1; message = "–£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏. –ü–æ–ª—É—á–µ–Ω–æ üß∂ –ò–∑–æ–≤–æ–ª–æ–∫–Ω–æ (F). +1 –°—Ç–∞—Ç—É—Å."; }
                        else { hpChange = -1; message = "–°–±–æ–π —É–∫—Ä–µ–ø–ª–µ–Ω–∏—è: –Ω–µ—Ç –°–ø–ª–∞–≤–∞. -1 HP."; }
                    } else if (actionCode === 'Rec_E') { // –°–ª—É—á–∞–π–Ω—ã–π —Å–±–æ—Ä
                        resChange.E = 2; message = "–ê–Ω–∞–ª–∏–∑ —Å–æ–ª–Ω–µ—á–Ω—ã—Ö –ø–∞–Ω–µ–ª–µ–π. –ü–æ–ª—É—á–µ–Ω–∞ ‚ö° –≠–Ω–µ—Ä–≥–æ—è—á–µ–π–∫–∞ (+2 E).";
                    }
                }
            }
            // --- –†–ê–£–ù–î 3: –ê–í–ê–†–ò–ô–ù–´–ô –°–ò–ì–ù–ê–õ (–ü–û–¢–ï–†–Ø –†–ï–°–£–†–°–û–í –ò–õ–ò HP) ---
            else if (gameState.currentRound === 3) {
                 if (actionCode === 'L_Fix' && gameState.inventory.L >= 1) { 
                     gameState.inventory.L--; statusChange = 2; message = "–ü—Ä–∏–º–µ–Ω–µ–Ω üíß –ì–∏–¥—Ä–æ-–†–µ–∞–≥–µ–Ω—Ç (-1 L). –ü–æ–ª–æ–º–∫–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞, +2 –°—Ç–∞—Ç—É—Å."; 
                 } else if (actionCode === 'M_Fix' && gameState.inventory.M >= 1) { 
                     gameState.inventory.M--; hpChange = 2; message = "–ü—Ä–∏–º–µ–Ω–µ–Ω ‚ùÑÔ∏è –ö—Ä–∏–æ-–ú–æ–¥—É–ª—å (-1 M). –£–ª—É—á—à–µ–Ω–∞ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è, +2 HP."; 
                 } else { 
                     hpChange = -2; statusChange = -1; message = "–ù–µ—Ç –Ω—É–∂–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞. –ü–æ–ª–æ–º–∫–∞ –≤—ã–∑—ã–≤–∞–µ—Ç —É—Ç–µ—á–∫—É —Ç–µ–ø–ª–∞. -2 HP, -1 –°—Ç–∞—Ç—É—Å."; 
                 }
            }
            // --- –†–ê–£–ù–î 4: –ú–ê–†–°–ò–ê–ù–°–ö–ò–ô –§–ï–ù–û–ú–ï–ù (–í–´–ë–û–† –†–ò–°–ö–ê) ---
            else if (gameState.currentRound === 4) {
                 if (actionCode === 'K_Invest' && gameState.inventory.K >= 1) { 
                     gameState.inventory.K--; resChange.L = 3; message = "–ì–µ—Ä–º–µ—Ç–∏–∑–∞—Ü–∏—è –ö-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º (-1 K). –ó–∞—Ö–≤–∞—á–µ–Ω—ã üíß 3 –ì–∏–¥—Ä–æ-–†–µ–∞–≥–µ–Ω—Ç–∞ (L)."; 
                 } else if (actionCode === 'W_Invest' && gameState.inventory.W >= 1) { 
                     gameState.inventory.W--; statusChange = 2; message = "–ê–Ω–∞–ª–∏–∑ –°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä–æ–º –í–æ–¥—ã (-1 W). –ù–∞–π–¥–µ–Ω–∞ —Å—Ö–µ–º–∞ –º–∞—è–∫–∞, +2 –°—Ç–∞—Ç—É—Å."; 
                 } else { 
                     hpChange = -3; message = "–ü–æ–ø—ã—Ç–∫–∞ –±–µ–∑ –Ω—É–∂–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞. –°–µ—Ä—å–µ–∑–Ω–æ–µ –æ–±–ª—É—á–µ–Ω–∏–µ. -3 HP."; 
                 }
            }
            // --- –†–ê–£–ù–î 5: –£–ì–†–û–ó–ê –ë–£–†–ò (–ö–†–ê–§–¢ –ò–õ–ò –°–ë–û–†) ---
            else if (gameState.currentRound === 5) {
                 if (actionCode === 'Craft_M_W_K') {
                    // –ö—Ä–∞—Ñ—Ç M, W, K ‚Äî —ç—Ç–æ —Å–≤–æ–±–æ–¥–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ —Ç—Ä–∞—Ç–∏—Ç –ª–∏–º–∏—Ç!
                    updateLog("üí¨ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ü—Ä–æ—Ç–æ–∫–æ–ª –°–≤—è–∑–∏: **–ö–†–ê–§–¢ [M/W/K]**");
                    gameState.actionsTaken--; // –û—Ç–º–µ–Ω—è–µ–º —Ç—Ä–∞—Ç—É –¥–µ–π—Å—Ç–≤–∏—è
                    document.getElementById('actions-remaining').textContent = gameState.maxActions - gameState.actionsTaken;
                    return; 
                 } else if (actionCode === 'Gather_E_B_S') { 
                     resChange.E = 1; resChange.B = 1; resChange.S = 1; statusChange = 1; message = "–°–±–æ—Ä–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–µ—Ä–µ–¥ –±—É—Ä–µ–π. +1 E, +1 B, +1 S. +1 –°—Ç–∞—Ç—É—Å."; 
                 }
            }
            // --- –†–ê–£–ù–î 6: –ö–û–ù–¢–†–ê–ö–¢ –ò –î–û–°–¢–ê–í–ö–ê (–û–ë–ú–ï–ù –ò–õ–ò –§–ò–ù–ê–õ–¨–ù–´–ô –†–´–í–û–ö) ---
            else if (gameState.currentRound === 6) {
                 if (actionCode === 'Trade') {
                    // –û–±–º–µ–Ω —Å –í–µ–¥—É—â–∏–º ‚Äî —ç—Ç–æ —Å–≤–æ–±–æ–¥–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ!
                    updateLog("üí¨ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ü—Ä–æ—Ç–æ–∫–æ–ª –°–≤—è–∑–∏ –¥–ª—è –æ–±–º–µ–Ω–∞: **–û–¢–î–ê–¢–¨/–ü–û–õ–£–ß–ò–¢–¨ [–∫–æ–¥] [–∫–æ–ª-–≤–æ]**");
                    gameState.actionsTaken--; // –û—Ç–º–µ–Ω—è–µ–º —Ç—Ä–∞—Ç—É –¥–µ–π—Å—Ç–≤–∏—è
                    document.getElementById('actions-remaining').textContent = gameState.maxActions - gameState.actionsTaken;
                    return; 
                 } else if (actionCode === 'Final_Dash') { 
                     if (gameState.inventory.E >= 2) { 
                         gameState.inventory.E -= 2; statusChange = 3; message = "–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä—ã–≤–æ–∫ –Ω–∞ –ø–æ–ª–Ω–æ–π –º–æ—â–Ω–æ—Å—Ç–∏ (-2 E). +3 –°—Ç–∞—Ç—É—Å."; 
                     } else { 
                         hpChange = -3; statusChange = -1; message = "–ù–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è —Ä—ã–≤–∫–∞. -3 HP, -1 –°—Ç–∞—Ç—É—Å."; 
                     }
                 }
            }

            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
            gameState.inventory.HP += hpChange;
            if (statusChange !== 0) {
                 gameState.historyLog.push({ round: gameState.currentRound, statusChange: statusChange, details: `–î–µ–π—Å—Ç–≤–∏–µ ${actionCode}` });
            }
            for (const res in resChange) {
                gameState.inventory[res] = (gameState.inventory[res] || 0) + resChange[res];
            }
            
            if (message && message.includes("–£—Å–ø–µ—à–Ω–æ")) updateLog(`‚úÖ –î–µ–π—Å—Ç–≤–∏–µ —É—Å–ø–µ—à–Ω–æ. ${message}`);
            else updateLog(`‚úÖ –î–µ–π—Å—Ç–≤–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ. ${message}`);

            if (gameState.inventory.HP <= 0) {
                 gameOver("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ–π –∂–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è.");
                 return;
            }

            loadRound(gameState.currentRound); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ UI –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫
            updateUI();
        }

        // --- –§–ò–ù–ê–õ ---
        function assembleBeacon() {
            if (gameState.currentRound !== 7) return;
            if (!takeAction()) return; 
            
            const required = CRAFT_COSTS.P;
            let canAssemble = true;
            let finalMessage = "";

            for (const res in required) {
                if (gameState.inventory[res] < required[res]) {
                    canAssemble = false;
                    finalMessage += `–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç ${RESOURCES[res].icon} ${RESOURCES[res].name} (${required[res]}). `;
                }
            }

            if (canAssemble) {
                // –¢—Ä–∞—Ç–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
                gameState.inventory.M -= required.M;
                gameState.inventory.W -= required.W;
                gameState.inventory.K -= required.K;
                gameState.inventory.Z -= required.Z;
                gameState.inventory.P = 1;
                
                updateLog(`üéâ **–ú–∞—è–∫ –°–ø–∞—Å–µ–Ω–∏—è –°–æ–±—Ä–∞–Ω!** –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—á–∞ —Å–∏–≥–Ω–∞–ª–∞.`);
                
                const finalScore = calculateFinalScore();
                let resultText = "";

                if (finalScore >= 10) {
                    resultText = `üëΩ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –£–°–ü–ï–•! –°—á–µ—Ç: **${finalScore}**. –°–∏–≥–Ω–∞–ª –ø—Ä–∏–Ω—è—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ. –í–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–ø–∞—Å–µ–Ω–∞ –∏ –ø—Ä–∏–∑–Ω–∞–Ω–∞ –≥–µ—Ä–æ—è–º–∏!`;
                } else if (finalScore >= 5) {
                    resultText = `‚úÖ –£–°–ü–ï–•! –°—á–µ—Ç: **${finalScore}**. –°–∏–≥–Ω–∞–ª –ø—Ä–∏–Ω—è—Ç —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π. –í—ã –≤—ã–∂–∏–ª–∏, –Ω–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—Ä–µ–º—è –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã.`;
                } else {
                    resultText = `‚ö†Ô∏è –ù–ò–ó–ö–ò–ô –£–°–ü–ï–•! –°—á–µ—Ç: **${finalScore}**. –°–∏–≥–Ω–∞–ª –æ—á–µ–Ω—å —Å–ª–∞–±. –°–ø–∞—Å–∞—Ç–µ–ª—å–Ω–∞—è –º–∏—Å—Å–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞, –Ω–æ –≤–∞—à–µ –≤—ã–∂–∏–≤–∞–Ω–∏–µ –ø–æ–¥ –≤–æ–ø—Ä–æ—Å–æ–º.`;
                }
                
                document.getElementById('action-area').innerHTML = `<div class="final-message">${resultText}</div>`;
                document.getElementById('round-title').textContent = "üõ∞Ô∏è –§–ò–ù–ê–õ –ú–ò–°–°–ò–ò";
            } else {
                updateLog(`üõë –°–±–æ—Ä–∫–∞ –ú–∞—è–∫–∞ –ø—Ä–æ–≤–∞–ª–µ–Ω–∞: ${finalMessage}`, true);
            }
            updateUI();
        }

        function calculateFinalScore() {
            const assemblyBonus = gameState.inventory.P > 0 ? 5 : 0; 
            const historyScore = gameState.historyLog.reduce((sum, log) => sum + log.statusChange, 0);
            return assemblyBonus + historyScore;
        }


        // --- –ó–ê–ì–†–£–ó–ö–ê –†–ê–£–ù–î–û–í ---

        function getRoundDescription(round) {
            const group = gameState.group;
            
            switch(round) {
                case 1: 
                    return `
                        <h3>–ü—Ä–æ—Ç–æ–∫–æ–ª: –ó–∞–∫—É–ø–∫–∞ –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</h3>
                        <p>–í–∞–º –≤—ã–¥–µ–ª–µ–Ω–æ **100 –ö–†**. –í—ã –º–æ–∂–µ—Ç–µ –∑–∞–∫—É–ø–∏—Ç—å –ª—é–±—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã. –≠—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —ç—Ç–∞–ø –∑–∞–∫—É–ø–∫–∏.</p>
                        <table>
                            <tr><th>–†–µ—Å—É—Ä—Å</th><th>–ò–∫–æ–Ω–∫–∞</th><th>–ö–æ–¥</th><th>–¶–µ–Ω–∞ (–ö–†)</th><th>–í –Ω–∞–ª–∏—á–∏–∏</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th></tr>
                            <tr><td>–≠–Ω–µ—Ä–≥–æ—è—á–µ–π–∫–∞</td><td>‚ö°</td><td>E</td><td>10</td><td>${gameState.inventory.E}</td><td><button onclick="buyResource('E')" ${gameState.inventory.CR < 10 ? 'disabled' : ''}>–ö—É–ø–∏—Ç—å</button></td></tr>
                            <tr><td>–ë–∏–æ–º–∞—Å—Å–∞</td><td>üå±</td><td>B</td><td>10</td><td>${gameState.inventory.B}</td><td><button onclick="buyResource('B')" ${gameState.inventory.CR < 10 ? 'disabled' : ''}>–ö—É–ø–∏—Ç—å</button></td></tr>
                            <tr><td>–ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π –°–ø–ª–∞–≤</td><td>üî©</td><td>S</td><td>10</td><td>${gameState.inventory.S}</td><td><button onclick="buyResource('S')" ${gameState.inventory.CR < 10 ? 'disabled' : ''}>–ö—É–ø–∏—Ç—å</button></td></tr>
                            <tr><td>–ì–∏–¥—Ä–æ-–†–µ–∞–≥–µ–Ω—Ç</td><td>üíß</td><td>L</td><td>15</td><td>${gameState.inventory.L}</td><td><button onclick="buyResource('L')" ${gameState.inventory.CR < 15 ? 'disabled' : ''}>–ö—É–ø–∏—Ç—å</button></td></tr>
                            <tr><td>–ò–∑–æ–≤–æ–ª–æ–∫–Ω–æ</td><td>üß∂</td><td>F</td><td>15</td><td>${gameState.inventory.F}</td><td><button onclick="buyResource('F')" ${gameState.inventory.CR < 15 ? 'disabled' : ''}>–ö—É–ø–∏—Ç—å</button></td></tr>
                        </table>
                        <p style="margin-top: 15px; color: #f1c40f;">–û—Å—Ç–∞–ª–æ—Å—å –ö–†: ${gameState.inventory.CR}</p>
                    `;
                case 2: 
                    let desc2 = "<h3>–ú–∞—Ä—Å–∏–∞–Ω—Å–∫–∞—è –ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å: –ü–ª–∞–Ω–æ–≤–æ–µ –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</h3><p>–ù–∞—á–∞–ª—å–Ω—ã–π —ç—Ç–∞–ø —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö. –£ –≤–∞—Å –µ—Å—Ç—å 3 –¥–µ–π—Å—Ç–≤–∏—è. –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∏–ª–∏ –ø—Ä–æ–≤–µ–¥–∏—Ç–µ –æ–±—ã—á–Ω—ã–π —Å–±–æ—Ä.</p>";
                    if (group === 'Technocrats') { desc2 += "<p>**üõ†Ô∏è –¢–ï–•–ù–û–ö–†–ê–¢–´:** –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≠–Ω–µ—Ä–≥–æ—Å–∏—Å—Ç–µ–º—ã (—Ç—Ä–µ–±—É–µ—Ç E) –¥–∞–µ—Ç üîó –û–ø—Ç–∏—á. –ö–∞–±–µ–ª—å (Z), –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–∏.</p>"; }
                    else if (group === 'Bioengineers') { desc2 += "<p>**üß™ –ë–ò–û–ò–ù–ñ–ï–ù–ï–†–´:** –ó–∞–ø—É—Å–∫ –ì–∏–¥—Ä–æ–ø–æ–Ω–∏–∫–∏ (—Ç—Ä–µ–±—É–µ—Ç B) –¥–∞–µ—Ç üíß –ì–∏–¥—Ä–æ-–†–µ–∞–≥–µ–Ω—Ç (L) –¥–ª—è –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.</p>"; }
                    else if (group === 'Constructors') { desc2 += "<p>**üß± –ö–û–ù–°–¢–†–£–ö–¢–û–†–´:** –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –ë–∞–∑—ã (—Ç—Ä–µ–±—É–µ—Ç S) –¥–∞–µ—Ç üß∂ –ò–∑–æ–≤–æ–ª–æ–∫–Ω–æ (F) –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏.</p>"; }
                    return desc2;
                case 3: return "<h3>–ü—Ä–æ—Ç–æ–∫–æ–ª: –ê–≤–∞—Ä–∏–π–Ω—ã–π –°–∏–≥–Ω–∞–ª</h3><p>–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ª–æ–º–∫–∞ –≤ –º–æ–¥—É–ª–µ –∂–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è. –°—Ä–æ—á–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ —Ä–µ—Å—É—Ä—Å –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —É—Ç–µ—á–∫–∏ —Ç–µ–ø–ª–∞, –∏–Ω–∞—á–µ –ø–æ–Ω–µ—Å–µ—Ç–µ —É—Ä–æ–Ω.</p>";
                case 4: return "<h3>–ü—Ä–æ—Ç–æ–∫–æ–ª: –ú–∞—Ä—Å–∏–∞–Ω—Å–∫–∏–π –§–µ–Ω–æ–º–µ–Ω</h3><p>–û–±–Ω–∞—Ä—É–∂–µ–Ω –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç. –í–∞–º –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∏–∑ —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è –µ–≥–æ –∑–∞—Ö–≤–∞—Ç–∞ –∏–ª–∏ –∞–Ω–∞–ª–∏–∑–∞. –≠—Ç–æ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ!</p>";
                case 5: return "<h3>–ü—Ä–æ—Ç–æ–∫–æ–ª: –£–≥—Ä–æ–∑–∞ –ë—É—Ä–∏ (–ö—Ä–∞—Ñ—Ç)</h3><p>–ù–∞–¥–≤–∏–≥–∞–µ—Ç—Å—è –º–æ—â–Ω–∞—è –ø–µ—Å—á–∞–Ω–∞—è –±—É—Ä—è. –ö—Ä–∞—Ñ—Ç –º–æ–¥—É–ª–µ–π (M, W, K) ‚Äî —ç—Ç–æ —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, —á—Ç–æ–±—ã —É—Å–ø–µ—Ç—å —É–∫—Ä–µ–ø–∏—Ç—å –±–∞–∑—É. –ö—Ä–∞—Ñ—Ç **–Ω–µ —Ç—Ä–∞—Ç–∏—Ç** –ª–∏–º–∏—Ç —Ö–æ–¥–∞!</p><p>–î–ª—è –∫—Ä–∞—Ñ—Ç–∞: –≤–≤–µ–¥–∏—Ç–µ **–ö–†–ê–§–¢ [–∫–æ–¥]** –≤ –ü—Ä–æ—Ç–æ–∫–æ–ª –°–≤—è–∑–∏.</p>";
                case 6: return "<h3>–ü—Ä–æ—Ç–æ–∫–æ–ª: –ö–æ–Ω—Ç—Ä–∞–∫—Ç –∏ –î–æ—Å—Ç–∞–≤–∫–∞</h3><p>–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ü–∏–∫–ª –ø–µ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–æ–π. –í—ã –º–æ–∂–µ—Ç–µ –æ–±–º–µ–Ω—è—Ç—å –∏–∑–ª–∏—à–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å –≤–Ω–µ—à–Ω–∏–º –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º (**–í–µ–¥—É—â–∏–π**). –û–±–º–µ–Ω **–Ω–µ —Ç—Ä–∞—Ç–∏—Ç** –ª–∏–º–∏—Ç —Ö–æ–¥–∞, –∞ **–†—ã–≤–æ–∫** —Ç—Ä–µ–±—É–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏.</p>";
                case 7: return "<h3>–§–∏–Ω–∞–ª—å–Ω—ã–π –ü—Ä–æ—Ç–æ–∫–æ–ª: –°–±–æ—Ä–∫–∞ –ú–∞—è–∫–∞</h3><p>–≠—Ç–æ –≤–∞—à –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å. –û–±—ä–µ–¥–∏–Ω–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (**1 M, 1 W, 1 K**) –∏ –±–æ–Ω—É—Å–Ω—ã–π –∫–∞–±–µ–ª—å (**1 Z**) –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–∏–≥–Ω–∞–ª–∞ —Å–ø–∞—Å–µ–Ω–∏—è. –£ –≤–∞—Å 3 –ø–æ–ø—ã—Ç–∫–∏, –Ω–æ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —É—Å–ø–µ—à–Ω–∞—è —Å–±–æ—Ä–∫–∞.</p>";
            }
        }

        function loadRound(round) {
            const desc = document.getElementById('round-description');
            const actions = document.getElementById('action-area');
            actions.innerHTML = '';
            desc.innerHTML = getRoundDescription(round);
            const group = gameState.group;
            
            if (round === 1) {
                 // –ö–Ω–æ–ø–∫–∏ –∑–∞–∫—É–ø–∫–∏ —É–∂–µ –≤ getRoundDescription
                 return;
            } else if (round === 2) {
                 if (group === 'Technocrats') {
                     actions.innerHTML = `<button onclick="applyRoundAction('Opt_E')">üõ†Ô∏è –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≠–Ω–µ—Ä–≥–∏—é (-1 E, +1 Z, +1 –°—Ç–∞—Ç—É—Å)</button><button onclick="applyRoundAction('Rec_S')">üî© –û–±—ã—á–Ω—ã–π —Å–±–æ—Ä –°–ø–ª–∞–≤–∞ (+2 S)</button>`;
                 } else if (group === 'Bioengineers') {
                     actions.innerHTML = `<button onclick="applyRoundAction('Opt_B')">üß™ –ó–∞–ø—É—Å–∫ –ì–∏–¥—Ä–æ–ø–æ–Ω–∏–∫–∏ (-1 B, +1 L, +1 –°—Ç–∞—Ç—É—Å)</button><button onclick="applyRoundAction('Rec_F')">üß∂ –°–±–æ—Ä –§–ª–æ—Ä—ã (+2 F)</button>`;
                 } else if (group === 'Constructors') {
                     actions.innerHTML = `<button onclick="applyRoundAction('Opt_S')">üß± –£–∫—Ä–µ–ø–∏—Ç—å –ë–∞–∑—É (-1 S, +1 F, +1 –°—Ç–∞—Ç—É—Å)</button><button onclick="applyRoundAction('Rec_E')">‚ö° –°–±–æ—Ä —Å –ü–∞–Ω–µ–ª–µ–π (+2 E)</button>`;
                 }
            } else if (round === 3) {
                actions.innerHTML = `
                    <button onclick="applyRoundAction('L_Fix')" style="background: #e67e22;">üíß –£—Å—Ç—Ä–∞–Ω–∏—Ç—å —Ç–µ—á—å —Ä–µ–∞–≥–µ–Ω—Ç–æ–º (-1 L)</button>
                    <button onclick="applyRoundAction('M_Fix')" style="background: #3498db;">‚ùÑÔ∏è –û—Ö–ª–∞–¥–∏—Ç—å –ö—Ä–∏–æ-–ú–æ–¥—É–ª–µ–º (-1 M)</button>
                `;
            } else if (round === 4) {
                actions.innerHTML = `
                    <button onclick="applyRoundAction('K_Invest')" style="background: #9b59b6;">üì¶ –ó–∞—Ö–≤–∞—Ç –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º (-1 K)</button>
                    <button onclick="applyRoundAction('W_Invest')" style="background: #34495e;">üåä –ê–Ω–∞–ª–∏–∑ –í–æ–¥–æ–π (-1 W)</button>
                `;
            } else if (round === 5) {
                actions.innerHTML = `
                    <button onclick="applyRoundAction('Craft_M_W_K')" style="background: #27ae60;">üõ†Ô∏è –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: –ö—Ä–∞—Ñ—Ç (–≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞)</button>
                    <button onclick="applyRoundAction('Gather_E_B_S')" style="background: #f39c12;">üå™Ô∏è –°—Ä–æ—á–Ω—ã–π —Å–±–æ—Ä —Ä–µ—Å—É—Ä—Å–æ–≤ (+1 E, B, S)</button>
                `;
            } else if (round === 6) {
                actions.innerHTML = `
                    <button onclick="applyRoundAction('Trade')" style="background: #16a085;">ü§ù –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: –û–±–º–µ–Ω (–≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞)</button>
                    <button onclick="applyRoundAction('Final_Dash')" style="background: #c0392b;">üöÄ –§–∏–Ω–∞–ª—å–Ω—ã–π –†—ã–≤–æ–∫ (-2 E, +3 –°—Ç–∞—Ç—É—Å)</button>
                `;
            } else if (round === 7) {
                actions.innerHTML = `
                    <button onclick="assembleBeacon()" style="background: #f1c40f; color: #2c0b0b; font-size: 1.2em;">üõ∞Ô∏è –°–û–ë–†–ê–¢–¨ –ú–ê–Ø–ö –ò –ó–ê–í–ï–†–®–ò–¢–¨</button>
                `;
            }
        }

        document.getElementById('round-title').textContent = ROUND_TITLES[0];
    </script>
</body>
</html>
