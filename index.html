<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–≠–∫—Å–ø–µ–¥–∏—Ü–∏—è –ê—Ä–µ—Å 7: –≠–∫–æ–Ω–æ–º–∏–∫–∞ –í—ã–∂–∏–≤–∞–Ω–∏—è</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* –ë–∞–∑–æ–≤—ã–π —Å—Ç–∏–ª—å */
        body { 
            font-family: 'Montserrat', sans-serif; 
            background: #0d1117; /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω GitHub */
            color: #c9d1d9; /* –°–≤–µ—Ç–ª—ã–π —Ç–µ–∫—Å—Ç */
            padding: 20px; 
            line-height: 1.6;
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            padding: 30px; 
            background: #161b22; /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –±–ª–æ–∫–∞ */
            border-radius: 12px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5); 
        }
        
        /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
        h1 { color: #e74c3c; margin-top: 0; text-align: center; }
        h2 { color: #58a6ff; border-bottom: 1px solid #30363d; padding-bottom: 10px; margin-top: 20px; }
        h3 { color: #e74c3c; }
        
        /* –û—Å–Ω–æ–≤–Ω—ã–µ –±–ª–æ–∫–∏ */
        .intro, .round-content, #trade-dialogue { 
            margin-bottom: 25px; 
            padding: 20px; 
            border: 1px solid #30363d; 
            border-radius: 8px; 
            background: #0d1117; 
        }
        
        /* –î–∏—Å–ø–ª–µ–π —Ä–µ—Å—É—Ä—Å–æ–≤ */
        .resources-display { 
            background: #21262d; 
            padding: 15px; 
            border-radius: 8px; 
            margin-top: 20px; 
            display: flex; 
            justify-content: space-between;
            align-items: center;
        }
        .status-info { flex: 1; margin-right: 20px;}
        .resources-display h3 { color: #2ecc71; margin-top: 0; }
        .hp-bar { color: #e74c3c; font-weight: bold; font-size: 1.1em; }
        .actions-count { color: #f1c40f; font-weight: bold; font-size: 1.1em; }

        /* –ñ—É—Ä–Ω–∞–ª */
        .log-box { 
            margin-top: 20px; 
            background: #0d1117; 
            padding: 15px; 
            height: 150px; 
            overflow-y: scroll; 
            border-radius: 8px; 
            font-size: 0.85em; 
            border: 1px solid #30363d;
        }
        .log-box p { margin: 2px 0; }
        .log-box span { color: #e74c3c; } /* –°—Ç–∏–ª—å –¥–ª—è –æ—à–∏–±–æ–∫ */
        
        /* –ö–Ω–æ–ø–∫–∏ */
        button { 
            padding: 10px 18px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 5px; 
            font-weight: bold; 
            background: #3498db; 
            color: white; 
            transition: background 0.2s, opacity 0.2s; 
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        button:hover:not(:disabled) { background: #2980b9; }
        button:disabled { background: #555; cursor: not-allowed; opacity: 0.6; }
        
        .group-select button { width: 250px; }

        /* –ü–∞–Ω–µ–ª—å –í–µ–¥—É—â–µ–≥–æ */
        .mod-panel { 
            margin-top: 25px; 
            padding: 15px; 
            background: #21262d; 
            border-radius: 8px; 
        }
        #mod-input { 
            padding: 10px; 
            border-radius: 4px; 
            border: 1px solid #7f8c8d; 
            margin-right: 10px; 
            background: #0d1117; 
            color: #dcdcdc; 
            width: 300px;
        }
        
        /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
        .inventory-list { 
            margin-top: 10px; 
            list-style-type: none; 
            padding: 0; 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px;
        }
        .inventory-item { 
            padding: 8px 12px; 
            border-radius: 5px; 
            background: #30363d;
            font-size: 0.9em;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞—É–Ω–¥–∞ */
        .current-round-title { color: #f1c40f; font-size: 1.5em; }
        .trade-info { font-size: 0.9em; color: #9c9c9c; margin-top: 10px;}
    </style>
</head>
<body>

    <div class="container">
        <h1>üåå –≠–∫—Å–ø–µ–¥–∏—Ü–∏—è –ê—Ä–µ—Å 7: –≠–∫–æ–Ω–æ–º–∏–∫–∞ –í—ã–∂–∏–≤–∞–Ω–∏—è</h1>
        <div id="game-area">
            
            <div class="intro" id="intro-screen">
                <h2>–ù–∞—á–∞–ª–æ –ú–∏—Å—Å–∏–∏</h2>
                <p>–í—ã –ø–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–∂–∏–≤—à–∏–µ —á–ª–µ–Ω—ã —ç–∫—Å–ø–µ–¥–∏—Ü–∏–∏ –ê—Ä–µ—Å 7 –Ω–∞ –ö—Ä–∞—Å–Ω–æ–π –ø–ª–∞–Ω–µ—Ç–µ. –í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é –≥—Ä—É–ø–ø—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.</p>
                
                <div class="group-select">
                    <button onclick="startGame('Technocrats')">üõ†Ô∏è –¢–µ—Ö–Ω–æ–∫—Ä–∞—Ç—ã (–ò—Å—Ç–æ—á–Ω. –≠–Ω–µ—Ä–≥–∏–∏)</button>
                    <button onclick="startGame('Bioengineers')">üß™ –ë–∏–æ–∏–Ω–∂–µ–Ω–µ—Ä—ã (–û—Ä–≥. –ú–∞—Ç–µ—Ä–∏—è)</button>
                    <button onclick="startGame('Constructors')">üß± –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã (–ü—Ä–æ—á–Ω—ã–π –ú–µ—Ç–∞–ª–ª)</button>
                </div>
                <p style="margin-top: 20px;">–í–∞—à –≤—ã–±–æ—Ä –æ–ø—Ä–µ–¥–µ–ª–∏—Ç –≤–∞—à –±–æ–Ω—É—Å–Ω—ã–π —Ä–µ—Å—É—Ä—Å –≤ –†–∞—É–Ω–¥–µ 1.</p>
            </div>

            <div id="game-round" style="display:none;">
                <h2 class="current-round-title" id="round-title"></h2>
                
                <div class="round-content" id="round-description"></div>

                <div class="resources-display">
                    <div class="status-info">
                        <h3>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å: <span id="player-group-name"></span></h3>
                        <p>–ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ (HP): <span id="res-hp" class="hp-bar"></span></p>
                        <p>–î–µ–π—Å—Ç–≤–∏–π –æ—Å—Ç–∞–ª–æ—Å—å: <span id="actions-remaining" class="actions-count"></span> / 3</p>
                        <p id="group-status"></p>
                    </div>
                    <ul class="inventory-list" id="inventory-list-display"></ul>
                </div>

                <div id="trade-dialogue" style="display:none;">
                    <h3>ü§ù –ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã —Å –ü–µ—Ä–µ–∫—É–ø—â–∏–∫–æ–º</h3>
                    <p style="color: #f1c40f;">–í–≤–µ–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å –í–µ–¥—É—â–µ–≥–æ, —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ **–û–¢–î–ê–¢–¨ [–∫–æ–¥] [–∫–æ–ª-–≤–æ]** –∏ **–ü–û–õ–£–ß–ò–¢–¨ [–∫–æ–¥] [–∫–æ–ª-–≤–æ]**</p>
                    <p class="trade-info">–ù–∞–ø—Ä–∏–º–µ—Ä: <code>–û–¢–î–ê–¢–¨ S 1</code> –∏ <code>–ü–û–õ–£–ß–ò–¢–¨ B 1</code> (–≤–µ–¥—É—â–∏–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–±–µ –∫–æ–º–∞–Ω–¥—ã).</p>
                </div>

                <div class="action-area" id="action-area"></div>
                
                <div class="log-box">
                    **–ñ—É—Ä–Ω–∞–ª –°–æ–±—ã—Ç–∏–π (–í–µ–¥—É—â–µ–≥–æ –∏ –ò–≥—Ä–æ–∫–∞)**
                    <div id="game-log"></div>
                </div>

                <div class="mod-panel">
                    <h4>–ü–∞–Ω–µ–ª—å –í–µ–¥—É—â–µ–≥–æ (–í–≤–æ–¥ –∫–æ–º–∞–Ω–¥)</h4>
                    <input type="text" id="mod-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –í–µ–¥—É—â–µ–≥–æ (–ö–†–ê–§–¢, –ö–û–ù–¢–†–ê–ö–¢, –û–¢–î–ê–¢–¨/–ü–û–õ–£–ß–ò–¢–¨)">
                    <button onclick="processModCommand()">–í–≤–æ–¥ –ö–æ–º–∞–Ω–¥—ã</button>
                    <button onclick="checkNextRound()" style="background: #e74c3c;">–ó–∞–≤–µ—Ä—à–∏—Ç—å –†–∞—É–Ω–¥ (–°–ø–∏—Å–∞–Ω–∏–µ HP)</button>
                </div>
            </div>
            
            <div id="game-over" style="display:none; text-align: center;">
                 <h2 style="color: #e74c3c;">üî¥ –ú–ò–°–°–ò–Ø –ü–†–û–í–ê–õ–ï–ù–ê</h2>
                 <p id="game-over-message" style="font-size: 1.2em;"></p>
            </div>
        </div>
    </div>

    <script>
        // --- –î–ê–ù–ù–´–ï –ò–ì–†–´ ---
        const RESOURCES = {
            // –ë–∞–∑–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã (5 —à—Ç)
            E: { name: '–ò—Å—Ç–æ—á–Ω. –≠–Ω–µ—Ä–≥–∏–∏', code: 'E', icon: '‚ö°' },
            B: { name: '–û—Ä–≥. –ú–∞—Ç–µ—Ä–∏—è', code: 'B', icon: 'üå±' },
            S: { name: '–ü—Ä–æ—á–Ω—ã–π –ú–µ—Ç–∞–ª–ª', code: 'S', icon: 'üî©' },
            L: { name: '–ö–∞—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä L', code: 'L', icon: 'üß™' },
            F: { name: '–í–æ–ª–æ–∫–Ω–æ F', code: 'F', icon: 'üß∂' },
            
            // –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã (4 —à—Ç)
            M: { name: '–ö—Ä–∏–æ-–ú–æ–¥—É–ª—å', code: 'M', icon: '‚ùÑÔ∏è' },
            W: { name: '–°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä –í–æ–¥—ã', code: 'W', icon: 'üíß' },
            K: { name: '–ì–µ—Ä–º–æ-–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä', code: 'K', icon: 'üì¶' },
            Z: { name: '–û–ø—Ç–∏—á. –ö–∞–±–µ–ª—å', code: 'Z', icon: 'üîó' }, 
            
            P: { name: '–ú–∞—è–∫ –°–ø–∞—Å–µ–Ω–∏—è', code: 'P', icon: ' –º–∞—è–∫' },
            HP: { name: '–ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ', code: 'HP', icon: 'üíî' }
        };
        
        const GROUP_BONUSES = {
            Technocrats: 'E', 
            Bioengineers: 'B', 
            Constructors: 'S'
        };

        const GROUP_NAMES = {
            Technocrats: 'üõ†Ô∏è –¢–µ—Ö–Ω–æ–∫—Ä–∞—Ç—ã', 
            Bioengineers: 'üß™ –ë–∏–æ–∏–Ω–∂–µ–Ω–µ—Ä—ã', 
            Constructors: 'üß± –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã'
        };

        const ROUND_TITLES = [
            "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ú–∏—Å—Å–∏–∏",
            "–†–∞—É–Ω–¥ 1: –°–±–æ—Ä –ë–∞–∑–æ–≤—ã—Ö –≠–ª–µ–º–µ–Ω—Ç–æ–≤",
            "–†–∞—É–Ω–¥ 2: –ö—Ä–∞—Ñ—Ç –∏ –õ–æ–≥–∏—Å—Ç–∏–∫–∞",
            "–†–∞—É–Ω–¥ 3: –ì–µ–æ—Ç–µ—Ä–º–∞–ª—å–Ω–∞—è –ê–Ω–æ–º–∞–ª–∏—è",
            "–†–∞—É–Ω–¥ 4: –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –û—Å–∫–æ–ª–∫–∞",
            "–†–∞—É–Ω–¥ 5: –ü—ã–ª–µ–≤–∞—è –ë—É—Ä—è –∏ –ó–∞—â–∏—Ç–∞",
            "–†–∞—É–Ω–¥ 6: –§–∏–Ω–∞–ª—å–Ω—ã–π –ü–æ–¥—ä–µ–º –∏ –ö–û–ù–¢–†–ê–ö–¢",
            "–†–∞—É–Ω–¥ 7: –°–±–æ—Ä–∫–∞ –ú–∞—è–∫–∞ –∏ –§–∏–Ω–∞–ª"
        ];
        
        const CRAFT_COSTS = {
            M: { E: 3, B: 2 }, // –ö—Ä–∏–æ-–ú–æ–¥—É–ª—å: –≠–Ω–µ—Ä–≥–∏—è + –û—Ä–≥–∞–Ω–∏–∫–∞
            W: { B: 3, S: 2 }, // –°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä –í–æ–¥—ã: –û—Ä–≥–∞–Ω–∏–∫–∞ + –ú–µ—Ç–∞–ª–ª
            K: { S: 3, L: 2 }, // –ì–µ—Ä–º–æ-–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: –ú–µ—Ç–∞–ª–ª + –ö–∞—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä
            Z: { L: 3, F: 2 }  // –û–ø—Ç–∏—á. –ö–∞–±–µ–ª—å: –ö–∞—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä + –í–æ–ª–æ–∫–Ω–æ (–ë–û–ù–£–°)
        };

        let gameState = {
            group: null,
            // –ù–∞—á–∞–ª—å–Ω—ã–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å: E=2, B=2, S=2 (–±–∞–∑–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è —Å—Ç–∞—Ä—Ç–∞)
            inventory: { E: 2, B: 2, S: 2, L: 0, F: 0, M: 0, W: 0, K: 0, Z: 0, P: 0, HP: 15 }, 
            currentRound: 0,
            actionsTaken: 0,
            maxActions: 3,
            status: "–û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –≥—Ä—É–ø–ø—ã...",
            historyLog: [] // –î–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
        };

        // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ô ---

        function updateLog(message, isError = false) {
            const logBox = document.getElementById('game-log');
            const prefix = isError ? '<span style="color: #e74c3c;">[–û–®–ò–ë–ö–ê]</span> ' : '';
            logBox.innerHTML += `<p>${prefix}${message}</p>`;
            logBox.scrollTop = logBox.scrollHeight;
        }

        function takeAction() {
            if (gameState.actionsTaken >= gameState.maxActions) {
                updateLog("üõë –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π (3) –≤ —ç—Ç–æ–º —Ä–∞—É–Ω–¥–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ.", true);
                return false;
            }
            gameState.actionsTaken++;
            document.getElementById('actions-remaining').textContent = gameState.maxActions - gameState.actionsTaken;
            return true;
        }

        function checkNextRound() {
            // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–º–µ–Ω–∞
            if (document.getElementById('trade-dialogue').style.display === 'block') {
                updateLog("üõë –û–±–º–µ–Ω –∞–∫—Ç–∏–≤–µ–Ω! –ó–∞–≤–µ—Ä—à–∏—Ç–µ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã (–∑–∞–∫—Ä–æ–π—Ç–µ –¥–∏–∞–ª–æ–≥ –∫–æ–º–∞–Ω–¥–æ–π –≤–µ–¥—É—â–µ–≥–æ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏—Ç–µ –í–í–û–î).", true);
                return;
            }

            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π (–∫—Ä–æ–º–µ –†7)
            if (gameState.currentRound !== 7 && gameState.actionsTaken < gameState.maxActions) {
                updateLog("üõë –í—ã –µ—â–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –≤—Å–µ 3 –¥–µ–π—Å—Ç–≤–∏—è —ç—Ç–æ–≥–æ —Ä–∞—É–Ω–¥–∞.", true);
                return;
            }
            
            if (gameState.currentRound === 7) return; 

            // 3. –°–ø–∏—Å–∞–Ω–∏–µ HP 
            const hpLoss = 3; 
            gameState.inventory.HP -= hpLoss;
            updateLog(`--- –ï–ñ–ï–î–ù–ï–í–ù–´–ô –†–ê–°–•–û–î ---`);
            updateLog(`üíî –ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ -${hpLoss} HP. –¢–µ–∫—É—â–∏–π HP: ${gameState.inventory.HP}`);

            if (gameState.inventory.HP <= 0) {
                gameOver("–ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–≥–ª–æ –Ω—É–ª—è. –í–∞—à–∞ –≥—Ä—É–ø–ø–∞ –ø–æ–≥–∏–±–ª–∞ –Ω–∞ –ú–∞—Ä—Å–µ.");
                return;
            }
            
            // 4. –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞—É–Ω–¥—É
            gameState.currentRound++;
            gameState.actionsTaken = 0; // –°–±—Ä–æ—Å –¥–µ–π—Å—Ç–≤–∏–π
            document.getElementById('trade-dialogue').style.display = 'none';
            updateLog(`=== –ü–µ—Ä–µ—Ö–æ–¥ –≤ ${ROUND_TITLES[gameState.currentRound]} ===`, true);
            gameState.status = "–†–∞—É–Ω–¥ –Ω–∞—á–∞—Ç. –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ.";
            loadRound(gameState.currentRound);
            updateUI();
        }

        function gameOver(message) {
            document.getElementById('game-round').style.display = 'none';
            document.getElementById('game-over').style.display = 'block';
            document.getElementById('game-over-message').textContent = message;
        }

        // --- UI –ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---

        function updateUI() {
            document.getElementById('player-group-name').textContent = GROUP_NAMES[gameState.group];
            
            const hpElement = document.getElementById('res-hp');
            hpElement.textContent = gameState.inventory.HP;
            if (gameState.inventory.HP <= 6) {
                hpElement.style.color = '#ff0000'; // –ö—Ä–∞—Å–Ω—ã–π –ø—Ä–∏ –Ω–∏–∑–∫–æ–º HP
            } else if (gameState.inventory.HP > 12) {
                hpElement.style.color = '#2ecc71'; // –ó–µ–ª–µ–Ω—ã–π –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–º HP
            } else {
                 hpElement.style.color = '#f1c40f'; // –ñ–µ–ª—Ç—ã–π/–û—Ä–∞–Ω–∂–µ–≤—ã–π
            }
            
            document.getElementById('actions-remaining').textContent = gameState.maxActions - gameState.actionsTaken;
            
            // –°–ø–∏—Å–æ–∫ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            const inventoryList = document.getElementById('inventory-list-display');
            let html = '';
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ë–∞–∑–æ–≤—ã–µ, –∑–∞—Ç–µ–º –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ
            const orderedKeys = Object.keys(RESOURCES).filter(k => gameState.inventory[k] > 0 && k !== 'HP' && k !== 'P').sort((a, b) => {
                const isBaseA = ['E', 'B', 'S', 'L', 'F'].includes(a);
                const isBaseB = ['E', 'B', 'S', 'L', 'F'].includes(b);
                if (isBaseA && !isBaseB) return -1;
                if (!isBaseA && isBaseB) return 1;
                return a.localeCompare(b);
            });
            
            orderedKeys.forEach(code => {
                const count = gameState.inventory[code];
                const res = RESOURCES[code];
                const isBonusGroup = GROUP_BONUSES[gameState.group] === code;
                
                html += `<li class="inventory-item">${res.icon} ${res.name} (${count}) ${isBonusGroup ? 'üåü' : ''}</li>`;
            });
            inventoryList.innerHTML = html || '<li class="inventory-item">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</li>';
            
            document.getElementById('group-status').innerHTML = gameState.status;
            document.getElementById('round-title').textContent = ROUND_TITLES[gameState.currentRound];
        }

        function startGame(groupName) {
            gameState.group = groupName;
            gameState.currentRound = 1;
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('game-round').style.display = 'block';
            
            updateLog(`–ì—Ä—É–ø–ø–∞ –≤—ã–±—Ä–∞–Ω–∞ **${GROUP_NAMES[groupName]}**. –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è ${ROUND_TITLES[gameState.currentRound]}`);
            updateUI();
            loadRound(1);
        }
        
        // --- –õ–û–ì–ò–ö–ê –í–ï–î–£–©–ï–ì–û ---

        function processModCommand() {
            const input = document.getElementById('mod-input').value.trim().toLowerCase();
            const words = input.split(' ');
            document.getElementById('mod-input').value = '';

            // 1. –ö–†–ê–§–¢ [–∫–æ–¥]
            if (words[0] === '–∫—Ä–∞—Ñ—Ç' && words.length === 2) {
                const resCode = words[1].toUpperCase();
                if (['M', 'W', 'K', 'Z'].includes(resCode)) {
                    craftIntermediate(resCode);
                    return;
                }
            }

            // 2. –ö–û–ù–¢–†–ê–ö–¢ (–ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–±–º–µ–Ω–∞ –≤ –†6)
            if (input === '–∫–æ–Ω—Ç—Ä–∞–∫—Ç' && gameState.currentRound === 6) {
                updateLog("ü§ù **–ü–ï–†–ï–ö–£–ü–©–ò–ö –ê–ö–¢–ò–í–ò–†–û–í–ê–ù**. –í–≤–µ–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å: –û–¢–î–ê–¢–¨ [–∫–æ–¥] [–∫–æ–ª-–≤–æ] –∏ –ü–û–õ–£–ß–ò–¢–¨ [–∫–æ–¥] [–∫–æ–ª-–≤–æ].");
                document.getElementById('trade-dialogue').style.display = 'block';
                return;
            }
            
            // 3. –û–¢–î–ê–¢–¨ / –ü–û–õ–£–ß–ò–¢–¨ [–∫–æ–¥] [–∫–æ–ª-–≤–æ] (–ú–æ–¥–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–º–µ–Ω–∞)
            if ((words[0] === '–æ—Ç–¥–∞—Ç—å' || words[0] === '–ø–æ–ª—É—á–∏—Ç—å') && words.length === 3) {
                const action = words[0];
                const resCode = words[1].toUpperCase();
                const amount = parseInt(words[2]);

                if (RESOURCES[resCode] && !isNaN(amount) && amount > 0 && document.getElementById('trade-dialogue').style.display === 'block') {
                    if (action === '–æ—Ç–¥–∞—Ç—å') {
                        if (gameState.inventory[resCode] >= amount) {
                            gameState.inventory[resCode] -= amount;
                            updateLog(`[–û–ë–ú–ï–ù] –ì—Ä—É–ø–ø–∞ ${GROUP_NAMES[gameState.group]} –æ—Ç–¥–∞–ª–∞ **-${amount} ${RESOURCES[resCode].name}**`);
                        } else {
                            updateLog(`üõë –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ${RESOURCES[resCode].name} –¥–ª—è –æ—Ç–¥–∞—á–∏ (${amount} > ${gameState.inventory[resCode]}). –û–±–º–µ–Ω –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.`, true);
                        }
                    } else if (action === '–ø–æ–ª—É—á–∏—Ç—å') {
                        gameState.inventory[resCode] += amount;
                        updateLog(`[–û–ë–ú–ï–ù] –ì—Ä—É–ø–ø–∞ ${GROUP_NAMES[gameState.group]} –ø–æ–ª—É—á–∏–ª–∞ **+${amount} ${RESOURCES[resCode].name}**`);
                    }
                    updateUI();
                    return;
                }
            }
            
            if (input) updateLog("–ù–µ–≤–µ—Ä–Ω–∞—è –∏–ª–∏ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–∞—è –∫–æ–º–∞–Ω–¥–∞ –í–µ–¥—É—â–µ–≥–æ (–ö–†–ê–§–¢, –ö–û–ù–¢–†–ê–ö–¢, –û–¢–î–ê–¢–¨/–ü–û–õ–£–ß–ò–¢–¨).", true);
        }

        // --- –õ–û–ì–ò–ö–ê –î–ï–ô–°–¢–í–ò–ô ---

        function craftIntermediate(resCode) {
            const cost = CRAFT_COSTS[resCode];
            let canCraft = true;

            for (const res in cost) {
                if (gameState.inventory[res] < cost[res]) {
                    updateLog(`üõë –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ${RESOURCES[res].name}. –¢—Ä–µ–±—É–µ—Ç—Å—è ${cost[res]}. –ö—Ä–∞—Ñ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.`, true);
                    canCraft = false;
                    break;
                }
            }

            if (canCraft) {
                for (const res in cost) {
                    gameState.inventory[res] -= cost[res];
                }
                gameState.inventory[resCode]++;
                updateLog(`üéâ –ö—Ä–∞—Ñ—Ç —É—Å–ø–µ—à–µ–Ω! –°–æ–∑–¥–∞–Ω **1 ${RESOURCES[resCode].name}**. (–°–≤–æ–±–æ–¥–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ)`);
            }
            updateUI();
        }

        function applyRoundAction(actionCode) {
            // –ö—Ä–∞—Ñ—Ç –∏ –ê–∫—Ç–∏–≤–∞—Ü–∏—è –û–±–º–µ–Ω–∞ –Ω–µ —Ç—Ä–∞—Ç—è—Ç –¥–µ–π—Å—Ç–≤–∏–µ, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç—Ä–∞—Ç—è—Ç
            if (actionCode !== 'Trade' && gameState.currentRound !== 2) {
                 if (!takeAction()) return;
            }
            
            let statusChange = 0;
            let message = "";

            if (gameState.currentRound === 1) { // –°–±–æ—Ä —Ä–µ—Å—É—Ä—Å–æ–≤
                const bonusRes = GROUP_BONUSES[gameState.group];
                const isBonus = actionCode === bonusRes;
                const gain = isBonus ? 5 : 3; 
                
                gameState.inventory[actionCode] += gain;
                message = `–î–æ–±—ã—á–∞ ${RESOURCES[actionCode].name}: **+${gain}**. ${isBonus ? "–ë–æ–Ω—É—Å–Ω—ã–π –£—Å–ø–µ—Ö üåü" : "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –°–±–æ—Ä"}`;
            } else if (gameState.currentRound === 3) { // –ê–Ω–æ–º–∞–ª–∏—è
                const hasS = gameState.inventory.S > 0;
                const hasB = gameState.inventory.B > 0;

                if (actionCode === 'S' && hasS) {
                    gameState.inventory.S--; 
                    statusChange = 1;
                    message = `–£–∫—Ä–µ–ø–ª–µ–Ω –ø—É—Ç—å ${RESOURCES.S.name}: **-1 S**. –£—Å–ø–µ—à–Ω–æ–µ –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ: +1 –∫ —Å—Ç–∞—Ç—É—Å—É.`;
                } else if (actionCode === 'B' && hasB) {
                    gameState.inventory.B--; 
                    statusChange = 1;
                    message = `–°–æ–∑–¥–∞–Ω –û–±—Ö–æ–¥ —á–µ—Ä–µ–∑ ${RESOURCES.B.name}: **-1 B**. –£—Å–ø–µ—à–Ω–æ–µ –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ: +1 –∫ —Å—Ç–∞—Ç—É—Å—É.`;
                } else { // Risk –∏–ª–∏ –Ω–µ—Ç —Ä–µ—Å—É—Ä—Å–∞
                     statusChange = -2; 
                     gameState.inventory.HP -= 2;
                     message = "–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é! –†–µ—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ –Ω–∞—É–≥–∞–¥. **-2 –∫ —Å—Ç–∞—Ç—É—Å—É** –∏ **-2 HP**.";
                }
            } else if (gameState.currentRound === 4) { // –û—Å–∫–æ–ª–æ–∫
                const hasM = gameState.inventory.M > 0;
                const hasW = gameState.inventory.W > 0;
                const hasK = gameState.inventory.K > 0;
                
                if (actionCode === 'M' && hasM) { statusChange = 1; message = `–ò–∑—É—á–µ–Ω–∏–µ —Å ${RESOURCES.M.name}: **+1**. –û—Å–∫–æ–ª–æ–∫ ‚Äî —á–∞—Å—Ç—å –∞–Ω—Ç–µ–Ω–Ω—ã –ú–∞—è–∫–∞.`; }
                else if (actionCode === 'W' && hasW) { statusChange = -1; message = `–ê–Ω–∞–ª–∏–∑ ${RESOURCES.W.name} –±—ã–ª –Ω–µ–≤–µ—Ä–Ω—ã–º: **-1**.`; }
                else if (actionCode === 'K' && hasK) { statusChange = 2; message = `–ì–µ—Ä–º–µ—Ç–∏–∑–∞—Ü–∏—è –û—Å–∫–æ–ª–∫–∞ —Å ${RESOURCES.K.name}: **+2 –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É —Å—Ç–∞—Ç—É—Å—É!**`; }
                else {
                    statusChange = -1; message = "–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é! –†–µ—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ –Ω–∞—É–≥–∞–¥. **-1 –∫ —Å—Ç–∞—Ç—É—Å—É**.";
                }
            } else if (gameState.currentRound === 5) { // –ë—É—Ä—è
                const hasK = gameState.inventory.K > 0;
                
                if (actionCode === 'Defend') {
                    if (hasK) {
                         gameState.inventory.K--; // –¢—Ä–∞—Ç–∞ K –¥–ª—è –∑–∞—â–∏—Ç—ã
                         statusChange = 2; 
                         message = `–ó–∞—â–∏—Ç–∞ —Å ${RESOURCES.K.name} —É—Å–ø–µ—à–Ω–∞! **-1 K**, **+2 –∫ —Å—Ç–∞—Ç—É—Å—É**!`;
                    } else {
                         statusChange = -1; gameState.inventory.HP -= 1;
                         message = "–ó–∞—â–∏—Ç–∞ –ø—Ä–æ–≤–∞–ª–µ–Ω–∞! –ù–µ—Ç –ì–µ—Ä–º–æ-–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. **-1 –∫ —Å—Ç–∞—Ç—É—Å—É** –∏ **-1 HP**.";
                    }
                } else if (actionCode === 'Repair') {
                    if (gameState.inventory.E > 0 || gameState.inventory.B > 0) {
                         const usedResource = gameState.inventory.E > 0 ? 'E' : 'B';
                         gameState.inventory[usedResource]--;
                         gameState.inventory.HP += 3;
                         message = `–í—Ä–µ–º–µ–Ω–Ω—ã–π —Ä–µ–º–æ–Ω—Ç —Å ${RESOURCES[usedResource].name}: **-1 —Ä–µ—Å—É—Ä—Å, +3 HP**!`;
                    } else {
                         statusChange = -2; 
                         message = "–†–µ–º–æ–Ω—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω! –ù–µ—Ç E –∏–ª–∏ B. **-2 –∫ —Å—Ç–∞—Ç—É—Å—É**.";
                    }
                }
            } else if (gameState.currentRound === 6) { // –§–∏–Ω–∞–ª—å–Ω—ã–π –ü–æ–¥—ä–µ–º
                if (actionCode === 'Race') {
                    if (gameState.inventory.E > 0) {
                         gameState.inventory.E -= 1; statusChange = 1; 
                         message = "–†—ã–≤–æ–∫ –Ω–∞ —ç–Ω–µ—Ä–≥–∏–∏: **-1 E, +1 –∫ —Å—Ç–∞—Ç—É—Å—É**.";
                    } else {
                         statusChange = -2; gameState.inventory.HP -= 2;
                         message = "–†—ã–≤–æ–∫ –±–µ–∑ —ç–Ω–µ—Ä–≥–∏–∏! **-2 –∫ —Å—Ç–∞—Ç—É—Å—É** –∏ **-2 HP**.";
                    }
                } else if (actionCode === 'Safe') {
                     statusChange = 1; message = "–û—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: **+1 –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É —Å—Ç–∞—Ç—É—Å—É**.";
                } else if (actionCode === 'Trade') {
                     // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–±–º–µ–Ω–∞
                     document.getElementById('trade-dialogue').style.display = 'block';
                     message = "–°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ! –í–≤–µ–¥–∏—Ç–µ **–ö–û–ù–¢–†–ê–ö–¢** –≤ –ø–∞–Ω–µ–ª—å –≤–µ–¥—É—â–µ–≥–æ.";
                     updateLog(message);
                     updateUI();
                     return; 
                }
            }
            
            if (message) updateLog(`‚úÖ –î–µ–π—Å—Ç–≤–∏–µ —É—Å–ø–µ—à–Ω–æ. ${message}`);
            
            if (gameState.inventory.HP <= 0) {
                 gameOver("–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ä–∏—Å–∫–æ–≤! –ñ–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —É–ø–∞–ª–æ –¥–æ –Ω—É–ª—è.");
                 return;
            }

            if (statusChange !== 0) {
                 gameState.historyLog.push({ round: gameState.currentRound, statusChange: statusChange, details: `–î–µ–π—Å—Ç–≤–∏–µ ${actionCode}` });
            }
            gameState.status = `–ü–æ—Å–ª–µ–¥–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ: ${message}`;
            loadRound(gameState.currentRound); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ UI
            updateUI();
        }

        // --- –§–ò–ù–ê–õ ---
        function assembleBeacon() {
            if (!takeAction()) return; 
            
            const required = { M: 1, W: 1, K: 1 };
            let canAssemble = true;

            for (const res in required) {
                if (gameState.inventory[res] < required[res]) {
                    updateLog(`üõë –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ${RESOURCES[res].name} (${gameState.inventory[res]} –∏–∑ 1) –¥–ª—è —Å–±–æ—Ä–∫–∏ –ú–∞—è–∫–∞.`, true);
                    canAssemble = false;
                    break;
                }
            }

            if (canAssemble) {
                gameState.inventory.M -= 1;
                gameState.inventory.W -= 1;
                gameState.inventory.K -= 1;
                gameState.inventory.P = 1;
                updateLog(`üéâ **–ú–∞—è–∫ –°–ø–∞—Å–µ–Ω–∏—è –°–æ–±—Ä–∞–Ω!** –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—á–∞ —Å–∏–≥–Ω–∞–ª–∞.`);
                updateUI();
                
                // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
                document.getElementById('action-area').innerHTML = `<h3 style="color: #2ecc71;">${getFinalMessage()}</h3>`;
                document.getElementById('round-title').textContent = "üõ∞Ô∏è –§–ò–ù–ê–õ –ú–ò–°–°–ò–ò";
                document.getElementById('actions-remaining').textContent = 0;
            }
        }

        function calculateFinalScore() {
            const assemblyBonus = gameState.inventory.P > 0 ? 5 : 0; 
            const Z_bonus = gameState.inventory.Z > 0 ? 3 : 0; 
            const historyScore = gameState.historyLog.reduce((sum, log) => sum + log.statusChange, 0);
            return assemblyBonus + historyScore + Z_bonus;
        }

        function getFinalMessage() {
            const score = calculateFinalScore();
            if (gameState.inventory.P === 0) return `‚ùå –ü—Ä–æ–≤–∞–ª –º–∏—Å—Å–∏–∏! –ú–∞—è–∫ –Ω–µ —Å–æ–±—Ä–∞–Ω. –°–∏–≥–Ω–∞–ª –æ —Å–ø–∞—Å–µ–Ω–∏–∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω. –°—á–µ—Ç: **${score}**`;
            if (score >= 10) return `üåü –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –£–°–ü–ï–•! –°—á–µ—Ç: **${score}**. –í—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç–µ—Å—å –≥–µ—Ä–æ–µ–º! –ú–∏—Å—Å–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∏–¥–µ–∞–ª—å–Ω–æ.`;
            if (score >= 5) return `‚úÖ –£–°–ü–ï–•! –°—á–µ—Ç: **${score}**. –°–∏–≥–Ω–∞–ª –ø—Ä–∏–Ω—è—Ç. –í—ã –≤—ã–∂–∏–ª–∏, –Ω–æ –≤–∞—à–∞ –º–∏—Å—Å–∏—è –±—ã–ª–∞ –Ω–∞ –≥—Ä–∞–Ω–∏.`;
            return `‚ö†Ô∏è –ù–ò–ó–ö–ò–ô –£–°–ü–ï–•! –°—á–µ—Ç: **${score}**. –ú–∞—è–∫ —Å–æ–±—Ä–∞–Ω, –Ω–æ —Å–ª–∞–±—ã–π —Å–∏–≥–Ω–∞–ª. –í–∞—à–µ –≤—ã–∂–∏–≤–∞–Ω–∏–µ –ø–æ–¥ –≤–æ–ø—Ä–æ—Å–æ–º.`;
        }

        // --- –ó–ê–ì–†–£–ó–ö–ê –†–ê–£–ù–î–û–í ---

        function getRoundDescription(round) {
            switch(round) {
                case 1: return `<h3>–¶–µ–ª—å: –°–±–æ—Ä –ë–∞–∑–æ–≤—ã—Ö –≠–ª–µ–º–µ–Ω—Ç–æ–≤</h3><p>–í—ã–±–µ—Ä–∏—Ç–µ, –∫–∞–∫–æ–π —Ä–µ—Å—É—Ä—Å –≤—ã –±—É–¥–µ—Ç–µ –¥–æ–±—ã–≤–∞—Ç—å –≤ —ç—Ç–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ (–ª–∏–º–∏—Ç 3 –¥–µ–π—Å—Ç–≤–∏—è). –ö–∞–∂–¥—ã–π —Ä–µ—Å—É—Ä—Å –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é –∏–∫–æ–Ω–∫—É.</p><p>–í–∞—à–∞ –≥—Ä—É–ø–ø–∞ **${GROUP_NAMES[gameState.group]}** –ø–æ–ª—É—á–∞–µ—Ç **+5** —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—å–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ (üåü) –∏ **+3** –¥—Ä—É–≥–∏—Ö.</p>`;
                case 2: return `<h3>–¶–µ–ª—å: –ö—Ä–∞—Ñ—Ç –∏ –õ–æ–≥–∏—Å—Ç–∏–∫–∞ (–°–í–û–ë–û–î–ù–û–ï –î–ï–ô–°–¢–í–ò–ï)</h3><p>–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –ú–∞—è–∫–∞ (M, W, K) –∏–ª–∏ –±–æ–Ω—É—Å–Ω—ã–π –∫–∞–±–µ–ª—å (Z). –í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É **–ö–†–ê–§–¢ [–∫–æ–¥]** –≤ –ø–∞–Ω–µ–ª—å –í–µ–¥—É—â–µ–≥–æ. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ —Ç—Ä–∞—Ç–∏—Ç –ª–∏–º–∏—Ç —Ö–æ–¥–∞.</p><hr><h4>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –°—Ç–æ–∏–º–æ—Å—Ç—å</h4><ul class='task-list'><li>**‚ùÑÔ∏è M (–ö—Ä–∏–æ-–ú–æ–¥—É–ª—å):** 3 ${RESOURCES.E.icon} E + 2 ${RESOURCES.B.icon} B</li><li>**üíß W (–°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä –í–æ–¥—ã):** 3 ${RESOURCES.B.icon} B + 2 ${RESOURCES.S.icon} S</li><li>**üì¶ K (–ì–µ—Ä–º–æ-–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä):** 3 ${RESOURCES.S.icon} S + 2 ${RESOURCES.L.icon} L</li><li>**üîó Z (–û–ø—Ç–∏—á. –ö–∞–±–µ–ª—å):** 3 ${RESOURCES.L.icon} L + 2 ${RESOURCES.F.icon} F (–ë–æ–Ω—É—Å –∫ —Ñ–∏–Ω–∞–ª—É)</li></ul>`;
                case 3: return "<h3>–¶–µ–ª—å: –ì–µ–æ—Ç–µ—Ä–º–∞–ª—å–Ω–∞—è –ê–Ω–æ–º–∞–ª–∏—è</h3><p>–ù–∞ –≤–∞—à–µ–º –ø—É—Ç–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ–ø–∞—Å–Ω–∞—è –∞–Ω–æ–º–∞–ª–∏—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ—Å—É—Ä—Å –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è (+1 –°—Ç–∞—Ç—É—Å) –∏–ª–∏ —Ä–∏—Å–∫—É–π—Ç–µ.</p>";
                case 4: return "<h3>–¶–µ–ª—å: –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –û—Å–∫–æ–ª–∫–∞</h3><p>–ù–∞–π–¥–µ–Ω –º–µ—Ä—Ü–∞—é—â–∏–π –û–±–ª–æ–º–æ–∫ (—á–∞—Å—Ç—å —Å—Ç–∞—Ä–æ–π –∞–Ω—Ç–µ–Ω–Ω—ã). –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –æ–¥–∏–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –∏–ª–∏ –∑–∞—Ö–≤–∞—Ç–∞.</p>";
                case 5: return "<h3>–¶–µ–ª—å: –ü—ã–ª–µ–≤–∞—è –ë—É—Ä—è –∏ –ó–∞—â–∏—Ç–∞</h3><p>–ù–∞–¥–≤–∏–≥–∞–µ—Ç—Å—è –±—É—Ä—è. –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é: **–ó–∞—â–∏—Ç–∞** (–Ω—É–∂–µ–Ω K) –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –∏–ª–∏ **–†–µ–º–æ–Ω—Ç** (—Ç—Ä–∞—Ç–∏—Ç E/B) –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è HP.</p>";
                case 6: return "<h3>–¶–µ–ª—å: –§–∏–Ω–∞–ª—å–Ω—ã–π –ü–æ–¥—ä–µ–º</h3><p>–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä—ã–≤–æ–∫ –∫ —Ç–æ—á–∫–µ —Å–±–æ—Ä–∞. –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é. **–°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ (–û–±–º–µ–Ω)** –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Å–ª–æ–≤–æ–º **–ö–û–ù–¢–†–ê–ö–¢** –≤ –ø–∞–Ω–µ–ª–∏ –í–µ–¥—É—â–µ–≥–æ.</p>";
                case 7: return "<h3>–¶–µ–ª—å: –°–±–æ—Ä–∫–∞ –ú–∞—è–∫–∞ –∏ –§–∏–Ω–∞–ª</h3><p>–°–æ–±–µ—Ä–∏—Ç–µ 1 **M** 1 **W** 1 **K** –¥–ª—è –ø–æ–±–µ–¥—ã.</p>";
            }
        }

        function loadRound(round) {
            const desc = document.getElementById('round-description');
            const actions = document.getElementById('action-area');
            actions.innerHTML = '';
            desc.innerHTML = getRoundDescription(round);

            if (round === 1) {
                 actions.innerHTML = `
                     <button onclick="applyRoundAction('E')">${RESOURCES.E.icon} –î–æ–±—ã—Ç—å –ò—Å—Ç–æ—á–Ω –≠–Ω–µ—Ä–≥–∏–∏ (E)</button>
                     <button onclick="applyRoundAction('B')">${RESOURCES.B.icon} –î–æ–±—ã—Ç—å –û—Ä–≥ –ú–∞—Ç–µ—Ä–∏—é (B)</button>
                     <button onclick="applyRoundAction('S')">${RESOURCES.S.icon} –î–æ–±—ã—Ç—å –ü—Ä–æ—á–Ω—ã–π –ú–µ—Ç–∞–ª–ª (S)</button>
                     <button onclick="applyRoundAction('L')">${RESOURCES.L.icon} –î–æ–±—ã—Ç—å –ö–∞—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä L (L)</button>
                     <button onclick="applyRoundAction('F')">${RESOURCES.F.icon} –î–æ–±—ã—Ç—å –í–æ–ª–æ–∫–Ω–æ F (F)</button>
                 `;
            } else if (round === 2) {
                 actions.innerHTML = `<button disabled>–î–µ–π—Å—Ç–≤–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å –í–µ–¥—É—â–µ–≥–æ (–ö–†–ê–§–¢)</button>`;
            } else if (round === 3) {
                 actions.innerHTML = `
                     <p>–î–æ—Å—Ç—É–ø–Ω–æ: ${RESOURCES.S.icon} S (${gameState.inventory.S}), ${RESOURCES.B.icon} B (${gameState.inventory.B})</p>
                     <button onclick="applyRoundAction('S')">–£–∫—Ä–µ–ø–∏—Ç—å –ø—É—Ç—å (-1 S, +1 –°—Ç–∞—Ç—É—Å)</button>
                     <button onclick="applyRoundAction('B')">–û–±—Ö–æ–¥ (-1 B, +1 –°—Ç–∞—Ç—É—Å)</button>
                     <button onclick="applyRoundAction('Risk')" style="background: #a84f3c;">–†–∏—Å–∫–Ω—É—Ç—å (–ù–µ—Ç —Ä–µ—Å—É—Ä—Å–∞) (-2 HP, -2 –°—Ç–∞—Ç—É—Å–∞)</button>
                 `;
            } else if (round === 4) {
                 actions.innerHTML = `
                     <p>–î–æ—Å—Ç—É–ø–Ω–æ: ${RESOURCES.M.icon} M (${gameState.inventory.M}), ${RESOURCES.W.icon} W (${gameState.inventory.W}), ${RESOURCES.K.icon} K (${gameState.inventory.K})</p>
                     <button onclick="applyRoundAction('M')">–ò–∑—É—á–∏—Ç—å –ö—Ä–∏–æ-–ú–æ–¥—É–ª–µ–º (M, +1 –°—Ç–∞—Ç—É—Å)</button>
                     <button onclick="applyRoundAction('W')">–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä–æ–º (W, -1 –°—Ç–∞—Ç—É—Å)</button>
                     <button onclick="applyRoundAction('K')" style="background: #2ecc71;">–ì–µ—Ä–º–µ—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º (K, +2 –°—Ç–∞—Ç—É—Å–∞)</button>
                 `;
            } else if (round === 5) {
                 actions.innerHTML = `
                     <p>–î–æ—Å—Ç—É–ø–Ω–æ: ${RESOURCES.K.icon} K (${gameState.inventory.K}), ${RESOURCES.E.icon} E (${gameState.inventory.E}), ${RESOURCES.B.icon} B (${gameState.inventory.B})</p>
                     <button onclick="applyRoundAction('Defend')">–ó–∞—â–∏—Ç–∏—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ (-1 K, +2 –°—Ç–∞—Ç—É—Å–∞)</button>
                     <button onclick="applyRoundAction('Repair')" style="background: #f39c12;">–í—Ä–µ–º–µ–Ω–Ω—ã–π —Ä–µ–º–æ–Ω—Ç (-1 E/B, +3 HP)</button>
                 `;
            } else if (round === 6) {
                 actions.innerHTML = `
                     <p>–î–µ–π—Å—Ç–≤–∏–π –æ—Å—Ç–∞–ª–æ—Å—å: ${gameState.maxActions - gameState.actionsTaken} / 3</p>
                     <button onclick="applyRoundAction('Race')">–°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ (-1 E, +1 –°—Ç–∞—Ç—É—Å)</button>
                     <button onclick="applyRoundAction('Trade')" style="background: #8e44ad;">–°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ (–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –û–±–º–µ–Ω)</button>
                     <button onclick="applyRoundAction('Safe')">–û—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å (+1 –°—Ç–∞—Ç—É—Å)</button>
                 `;
            } else if (round === 7) {
                actions.innerHTML = `<button onclick="assembleBeacon()" style="background: #2ecc71;">üöÄ –°–æ–±—Ä–∞—Ç—å –ú–∞—è–∫ –°–ø–∞—Å–µ–Ω–∏—è</button>`;
            }
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', updateLog);
    </script>
</body>
</html>
